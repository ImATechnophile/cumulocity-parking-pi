/* devicemanagement_deviceNetwork 8.21.0 2018-01-30T22:08:28+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("c8y.deviceNetwork",[]).config(["c8yViewsProvider","gettext",function(e,n){"use strict";var a="devicemanagement_deviceNetwork/views/",t="/device/:deviceId";e.when(t,{templateUrl:a+"network.html",name:n("Network"),priority:500,icon:"globe",showIf:["$routeParams","c8yBase","c8yDevices",function(e,n,a){var t=e.deviceId;return a.detailCached(t).then(n.getResData).then(function(e){return!_.isUndefined(e.c8y_Network)})}],controller:["$scope","$routeParams","c8yBase","c8yDevices",function(e,n,a,t){e.device={},t.detailCached(n.deviceId).then(a.getResData).then(function(n){e.device=n})}]})}]),function(){"use strict";function e(e,n,a,t,s,c){function r(){i(),l()}function i(){e.$watch("device",function(e){_.update(e,"c8y_Network.c8y_LAN.enabled",d),_.update(e,"c8y_Network.c8y_DHCP.enabled",d)})}function d(e){return _.isBoolean(e)?e:Boolean(e)}function l(){t.getSystemOptionValue({category:"messaging",key:"provider"},!1).then(function(n){e.smsEnabled=!!n})}function o(e){return m(e)}function v(e){return m(e,"SMS")}function m(e,n){var t=e.c8y_Network.c8y_WAN,s={deviceId:e.id,description:c("Configure WAN settings"),deliveryType:n,c8y_Network:{c8y_WAN:{apn:t.apn,username:t.username,password:t.password,authType:t.authType}}};return a.create(s).then(_.partial(g,c("Sent operation to apply WAN settings.")))}function p(e){var n=e.c8y_Network.c8y_LAN,t={deviceId:e.id,description:c("Configure LAN settings"),c8y_Network:{c8y_LAN:{enabled:n.enabled?1:0,ip:n.ip,netmask:n.netmask}}};a.create(t).then(_.partial(g,c("Sent operation to apply LAN settings.")))}function u(e){var n=e.c8y_Network.c8y_DHCP,t={deviceId:e.id,description:c("Configure DHCP settings"),c8y_Network:{c8y_DHCP:{enabled:n.enabled?1:0,addressRange:n.addressRange,dns1:n.dns1,dns2:n.dns2,domainName:n.domainName}}};a.create(t).then(_.partial(g,c("Sent operation to apply DHCP settings.")))}function g(e){s.success(e)}function y(e){e.netmask=b(e.ip)}function b(e){if(e){var n=e.split("."),a=N(parseInt(n[0],10).toString(2),8),t=null;return _.forEach(w,function(e){a.substr(e.substr.start,e.substr.count)===e.leadingBits&&(t=e.netmask)}),t}}function N(e,n,a){return a=a||"0",e+="",e.length>=n?e:new Array(n-e.length+1).join(a)+e}var h={MAC:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/},f=[{value:"pap",label:"PAP"},{value:"chap",label:"CHAP"}],w=[{substr:{start:0,count:1},leadingBits:"0",netmask:"255.0.0.0"},{substr:{start:0,count:2},leadingBits:"10",netmask:"255.255.0.0"},{substr:{start:0,count:3},leadingBits:"110",netmask:"255.255.255.0"}];e.patterns=h,e.authTypes=f,e.invalid=angular.bind(n,n.invalid,e),e.onLanIpChanged=y,e.saveWANviaIP=o,e.saveWANviaSMS=v,e.saveLAN=p,e.saveDHCP=u,r()}angular.module("c8y.deviceNetwork").controller("deviceNetworkCtrl",["$scope","c8yBase","c8yDeviceControl","c8ySettings","c8yAlert","gettext",e])}(),function(){"use strict";function e(e){var n;n='<div ng-controller="deviceNetworkCtrl" class="deviceNetwork row">\n  <div class="col-sm-6 col-md-4">\n    <div class="card">\n      <div class="card-header">\n        <h4 class="card-title">{{\'WAN\' | translate}}</h4>\n      </div>\n      <hr>\n      <div class="card-block">\n        <form name="wanForm">\n          <div class="form-group">\n            <label for="simStatus">{{\'SIM status\' | translate}}</label>\n            <input id="simStatus" type="text" class="form-control" ng-model="device.c8y_Network.c8y_WAN.simStatus" disabled="disabled">\n          </div>\n          <div class="form-group">\n            <label for="apn">{{\'APN\' | translate}}</label>\n            <input id="apn" type="text" class="form-control" ng-model="device.c8y_Network.c8y_WAN.apn">\n          </div>\n          <div class="form-group">\n            <label for="user">{{\'User\' | translate}}</label>\n            <input id="user" type="text" class="form-control" ng-model="device.c8y_Network.c8y_WAN.username">\n          </div>\n          <div class="form-group">\n            <label for="password">{{\'Password\' | translate}}</label>\n            <input id="password" type="text" class="form-control" ng-model="device.c8y_Network.c8y_WAN.password">\n          </div>\n          <div class="form-group">\n            <label for="authType">{{\'Auth type\' | translate}}</label>\n            <div class="c8y-select-wrapper">\n              <select id="authType" class="form-control" ng-model="device.c8y_Network.c8y_WAN.authType" ng-options="authType.value as authType.label for authType in authTypes"></select>\n              <span></span>\n            </div>\n          </div>\n          <div class="card-footer separator">\n            <button class="btn btn-primary btn-block" ng-disabled="wanForm.$invalid" ng-click="saveWANviaIP(device)" translate>\n              Save changes\n            </button>\n            <button class="btn btn-primary btn-block" ng-disabled="wanForm.$invalid || !smsEnabled" ng-click="saveWANviaSMS(device)">\n              {{\'Save changes (SMS)\' | translate}}\n              <i ng-if="!smsEnabled" c8y-icon="question-circle" uib-tooltip="{{\'Messaging provider must be configured to send WAN settings to device via SMS\' | translate}}">\n              </i>\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n  <div class="col-sm-6 col-md-4">\n    <div class="card">\n      <div class="card-header">\n        <h4 class="card-title">{{\'LAN\' | translate}}</h4>\n      </div>\n      <hr>\n      <form name="lanForm" ng-submit="saveLAN(device)">\n        <div class="bg-gray-white">\n          <div class="card-block">\n            <div class="text-center">\n              <button type="button" class="btn" ng-model="device.c8y_Network.c8y_LAN.enabled" uib-btn-checkbox>\n                <i c8y-icon="minus-circle" class="text-danger" ng-show="!device.c8y_Network.c8y_LAN.enabled"></i>\n                <i c8y-icon="check-circle" class="text-success" ng-show="device.c8y_Network.c8y_LAN.enabled"></i>\n                <span ng-show="device.c8y_Network.c8y_LAN.enabled" translate>Enabled</span>\n                <span ng-show="!device.c8y_Network.c8y_LAN.enabled" translate>Disabled</span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="card-block">\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'lanForm\', \'name\')}">\n            <label for="name" class="not-editable">{{\'Name\' | translate}}</label>\n            <input id="name" name="name" type="text" class="form-control" ng-model="device.c8y_Network.c8y_LAN.name" disabled="disabled" required>\n          </div>\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'lanForm\', \'mac\')}">\n            <label for="mac" class="not-editable">{{\'MAC address\' | translate}}</label>\n            <input id="mac" name="mac" type="text" class="form-control" value="{{device.c8y_Network.c8y_LAN.mac|uppercase}}" placeholder="{{\'e.g. 12:AB:34:CD:56:EF\' | translate}}" ng-pattern="patterns.MAC" maxlength="17" required disabled="disabled">\n          </div>\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'lanForm\', \'ip\')}">\n            <label for="ip">{{\'IP Address\' | translate}}</label>\n            <input id="ip" name="ip" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_LAN.ip" ng-change="onLanIpChanged(device.c8y_Network.c8y_LAN)" placeholder="{{\'e.g. 192.168.0.1\' | translate}}" maxlength="15" required/>\n          </div>\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'lanForm\', \'netmask\')}">\n            <label for="netmaskLan">{{\'Subnet mask\' | translate}}</label>\n            <input id="netmaskLan" name="netmask" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_LAN.netmask" placeholder="{{\'e.g. 255.255.255.0\' | translate}}" maxlength="15" required>\n          </div>\n        </div>\n        <div class="card-footer separator">\n          <button class="btn btn-primary btn-block" ng-disabled="lanForm.$invalid" translate>Save changes</button>\n        </div>\n      </form>\n    </div>\n  </div>\n\n  <div class="clearfix visible-sm"></div>\n\n  <div class="col-sm-6 col-md-4">\n    <div class="card">\n      <div class="card-header">\n        <h4 class="card-title">{{\'DHCP\' | translate}}</h4>\n      </div>\n      <hr>\n      <form name="dhcpForm" ng-submit="saveDHCP(device)">\n        <div class="bg-gray-white">\n          <div class="card-block">\n            <div class="text-center">\n              <button type="button" class="btn" ng-model="device.c8y_Network.c8y_DHCP.enabled" uib-btn-checkbox ng-disabled="!device.c8y_Network.c8y_LAN.enabled">\n                <i c8y-icon="minus-circle" class="text-danger" ng-show="!device.c8y_Network.c8y_DHCP.enabled"></i>\n                <i c8y-icon="check-circle" class="text-success" ng-show="device.c8y_Network.c8y_DHCP.enabled"></i>\n                <span ng-show="device.c8y_Network.c8y_DHCP.enabled" translate>Enabled</span>\n                <span ng-show="!device.c8y_Network.c8y_DHCP.enabled" translate>Disabled</span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="card-block">\n          <div class="form-group">\n            <label for="addressRangeStart">{{\'Address range\' | translate}}</label>\n            <div class="row">\n              <div class="col-lg-6 col-sm-6" style="x-padding-left: 0" ng-class="{\'has-error\': invalid(\'dhcpForm\', \'addressRangeStart\')}">\n                <input id="addressRangeStart" name="addressRangeStart" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_DHCP.addressRange.start" ng-disabled="!device.c8y_Network.c8y_LAN.enabled" placeholder="{{\'e.g. 192.168.0.1\' | translate}}" maxlength="15" required/>\n              </div>\n              <div class="col-lg-6 col-sm-6" style="x-padding-right: 0" ng-class="{\'has-error\': invalid(\'dhcpForm\', \'addressRangeEnd\')}">\n                <input id="addressRangeEnd" name="addressRangeEnd" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_DHCP.addressRange.end" ng-disabled="!device.c8y_Network.c8y_LAN.enabled" placeholder="{{\'e.g. 192.168.0.10\' | translate}}" maxlength="15" required/>\n              </div>\n            </div>\n          </div>\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'dhcpForm\', \'dns2\')}">\n            <label for="dns1">{{\'DNS\' | translate}}</label>\n            <input id="dns1" name="dns1" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_DHCP.dns1" ng-disabled="!device.c8y_Network.c8y_LAN.enabled" placeholder="{{\'e.g. 192.168.0.1\' | translate}}" maxlength="15"/>\n          </div>\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'dhcpForm\', \'dns2\')}">\n            <label for="dns2">{{\'DNS 2\' | translate}}</label>\n            <input id="dns2" name="dns2" type="text" validate-ip class="form-control" ng-model="device.c8y_Network.c8y_DHCP.dns2" ng-disabled="!device.c8y_Network.c8y_LAN.enabled" placeholder="{{\'e.g. 192.168.0.2\' | translate}}" maxlength="15"/>\n          </div>\n          <div class="form-group">\n            <label for="domainName">{{\'Domain name\' | translate}}</label>\n            <input id="domainName" type="text" class="form-control" ng-model="device.c8y_Network.c8y_DHCP.domainName" ng-disabled="!device.c8y_Network.c8y_LAN.enabled">\n          </div>\n        </div>\n        <div class="card-footer separator">\n          <button class="btn btn-primary btn-block" ng-disabled="!device.c8y_Network.c8y_LAN.enabled || dhcpForm.$invalid" translate>Save changes</button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n',e.put("devicemanagement_deviceNetwork/views/network.html",n),e.put("/apps/devicemanagement/deviceNetwork/views/network.html",n)}angular.module("c8y.deviceNetwork").run(["$templateCache",e])}();