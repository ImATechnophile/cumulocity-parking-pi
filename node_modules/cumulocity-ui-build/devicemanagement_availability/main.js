/* devicemanagement_availability 8.21.0 2018-01-30T22:08:28+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("c8y.parts.availability",["nvd3ChartDirectives"]).config(["c8yViewsProvider","c8yNavigatorProvider","c8yTitleProvider","gettext",function(a,t,n,i){"use strict";var e="signal",r="devicemanagement_availability/views/",l={name:i("Service monitoring"),icon:e,templateUrl:r+"detail.html",controller:"availabilityReportCtrl",showIfPermissions:{allRoles:["ROLE_ALARM_READ","ROLE_INVENTORY_READ"]}},o="availability";t.addNavigation({parent:i("Devices"),name:i("Service monitoring"),icon:e,path:o,showIfPermissions:{allRoles:["ROLE_ALARM_READ","ROLE_INVENTORY_READ"]}}),a.when("/device/:deviceId",_.cloneDeep(l)),a.when("/"+o,_.cloneDeep(l)),n.addTitle("/"+o,{data:function(){return{title:i("Service monitoring")}}})}]),angular.module("c8y.parts.availability").controller("availabilityReportCtrl",["$scope","$routeParams","c8yBase","c8yAlarms","gettext",function(a,t,n,i,e){"use strict";function r(a,t,n){var i=n.data,e=i.availabilityStats,r=s(t,i),l=e?e.reduce(function(a,t){return a+=t.downtimeDuration},0):i.downtimeDuration,o=r-l;return L[a]={name:a,title:E[a],order:A.indexOf(a),data:[{key:"downtime",val:l},{key:"uptime",val:o}]},L[a]}function l(t,n){var i=n.data,e=i.availabilityStats,r=s(t),l=e.map(function(a){var t=a.downtimeDuration;return a.percent=(r-t)/r*100,a});return a.graphData=[{key:"Operability",values:o(l)}],a.graphData}function o(a){for(var t=10,n=100/t,i=[],e=function(a,t){return t.percent<=a&&t.percent>a-n},r=0;r<=t;r++){var l=r*n,o=a.filter(_.partial(e,l)).length;i.push([l,o])}return i}function s(a,t){var n=moment(a.dateFrom),i=moment(a.dateTo),e=i.diff(n,"seconds");return t&&t.availabilityStats&&(e*=t.availabilityStats.length),e}function c(a,t){return i.reports.downtimeDuration(a).then(angular.bind({},r,t,a))}function d(){var a=n.dateFullFormat,t={dateFrom:moment().subtract(1,"month").format(a),dateTo:moment().add(1,"day").format(a)};return i.reports.downtimeDuration(t).then(angular.bind({},l,t))}function v(a){var t=moment().add(1,"day"),i=moment().subtract(1,a),e=n.dateFullFormat;return{dateFrom:i.format(e),dateTo:t.format(e),id:T}}function u(a){var t=v(a);return c(t,a)}function p(){A.forEach(u)}function m(a){var t=_.find(a,function(a){return"uptime"===a.key}).val,n=_.find(a,function(a){return"downtime"===a.key}).val,i=t/(t+n);return 100*i}function h(a){var t=m(a),n=t>50?"text-success":"text-danger";return n}function y(){return function(a){return a.key}}function g(){return function(a){return a.val}}function f(){return function(a){return F[a.data.key]}}function b(){return function(a){return a}}function x(){return function(a){return a[0]}}function w(){return function(a){return a[1]}}function D(){return function(a){return a+"%"}}function k(){return function(){return F.uptime}}function G(){return function(a,t,n){return Math.round(n)+" devices"}}function R(){return _.values(L)}var T=t.deviceId,A=["day","week","month"],E={day:e("Last day"),week:e("Last week"),month:e("Last month")},L={},F={downtime:"#d9534f",uptime:"#5cb85c"},I=e("Availability percentage is based on the number of critical alarms raised and resolved."),O=e("Operability chart displays how many devices had their average availability on particular level in the last month.");a.intervals=L,a.getIntervalData=R,a.x=y,a.y=g,a.color=f,a.percentage=m,a.percentageClass=h,a.tooltip=b,a.xGraph=x,a.yGraph=w,a.xTickFormat=D,a.colorGraph=k,a.tooltipGraph=G,a.availabilityTooltip=I,a.operabilityTooltip=O,p(),T||d()}]),function(){"use strict";function a(a){var t;t='<div ng-if="graphData" class="">\n\n  <div class="card availabilityGraph">\n    <div class="card-header">\n      <h4 style="card-title" translate>Last month operability</h4>\n    </div>\n    <hr>\n    <div class="card-block">\n      <nvd3-multi-bar-chart data="graphData" id="availabilityGraph" height="200" width="900" x="xGraph()" y="yGraph()" xaxistickformat="xTickFormat()" color="colorGraph()" showxaxis="true" showyaxis="false" tooltips="{{\'true\' | translate}}" tooltipcontent="tooltipGraph()">\n        <svg></svg>\n      </nvd3-multi-bar-chart>\n      <div class="text-center">\n        <small>{{operabilityTooltip | translate}}</small>\n      </div>\n    </div>\n  </div>\n</div>\n',a.put("devicemanagement_availability/views/availability-graph.html",t),a.put("/apps/devicemanagement/availability/views/availability-graph.html",t),t='\n\n<div class="card welcome">\n  <div class="card-header">\n    <h4 class="card-title" translate>Availability</h4>\n  </div>\n  <hr>\n  <div class="row">\n    <div class="col-sm-4" ng-repeat="intervalData in getIntervalData() | orderBy:\'order\'">\n      <div class="card-block">\n        <h5 class="text-center">\n          <span ng-bind="intervalData.title | translate"></span>\n        </h5>\n\n        <div class="availabilityPie" style="position:relative">\n          <span class="percentage" ng-class="percentageClass(intervalData.data)">{{percentage(intervalData.data)|number:0}}%</span>\n          <nvd3-pie-chart style="" data="intervalData.data" id="interval{{$index}}" height="300" width="300" x="x()" y="y()" tooltips="{{\'true\' | translate}}" tooltipcontent="tooltip()" color="color()" donut="true" donutratio=".45">\n          <svg></svg>\n          </nvd3-pie-chart>\n        </div>\n\n      </div>\n    </div>\n\n  </div>\n  <div class="card-footer text-center">\n    <small>{{availabilityTooltip | translate}}</small>\n  </div>\n</div>\n',a.put("devicemanagement_availability/views/availability-pie.html",t),a.put("/apps/devicemanagement/availability/views/availability-pie.html",t),t='\n<div class="card-group">\n  <div ng-repeat="intervalData in getIntervalData() | orderBy:\'order\'" class="availabilityPie col-md-4 col-xs-12">\n    <div class="card">\n      <div class="card-header">\n        <h4 class="card-title">\n          <span ng-bind="intervalData.title | translate"></span>\n          <span translate>availability</span>\n        </h4>\n      </div>\n      <hr>\n      <div class="card-block">\n        <div style="position:relative">\n          <span class="percentage" ng-class="percentageClass(intervalData.data)">{{percentage(intervalData.data)|number:0}}%</span>\n          <nvd3-pie-chart data="intervalData.data" id="interval{{$index}}" height="500" width="600" x="x()" y="y()" tooltips="{{\'true\' | translate}}" tooltipcontent="tooltip()" color="color()" donut="true" donutratio=".55">\n          <svg></svg>\n          </nvd3-pie-chart>\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n  <div class="center-block text-center">\n    <small>{{availabilityTooltip | translate}}</small>\n  </div>\n</div>\n\n<div ng-if="graphData" class="">\n\n  <div class="card availabilityGraph">\n    <div class="card-header">\n      <h4 style="card-title" translate>Last month operability</h4>\n    </div>\n    <hr>\n    <div class="card-block">\n      <nvd3-multi-bar-chart data="graphData" id="availabilityGraph" height="300" width="1000" x="xGraph()" y="yGraph()" xaxistickformat="xTickFormat()" color="colorGraph()" showxaxis="true" showyaxis="false" tooltips="{{\'true\' | translate}}" tooltipcontent="tooltipGraph()">\n        <svg></svg>\n      </nvd3-multi-bar-chart>\n      <small>{{operabilityTooltip | translate}}</small>\n    </div>\n  </div>\n</div>\n',a.put("devicemanagement_availability/views/detail.html",t),a.put("/apps/devicemanagement/availability/views/detail.html",t)}angular.module("c8y.parts.availability").run(["$templateCache",a])}();