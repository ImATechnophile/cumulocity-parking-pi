/* administration_users 9.3.0 2018-03-26T16:24:18+00:00 796b68a031b1+ (release/9.3.0) tip */
!function(){"use strict";function e(e){e.initUi()}e.$inject=["c8yUserUiProvider"],angular.module("c8y.parts.users",["c8y.parts.aclManagement"]).config(e)}(),function(){"use strict";function e(e,n,t,s){function i(e){return"administration_users/views/"+e+".html"}function r(e){return"/users"+(e||"")}function a(){l(),o(),c()}function l(){e.addNavigation({parent:s("Accounts"),name:s("Users"),path:r().replace(/^\//,""),icon:p,priority:5e3,showIfPermissions:{anyRole:g}})}function o(){n.when(r(),{templateUrl:i("list")}),n.when(m,_.defaults({templateUrl:i("detail")},f)),n.when(r("/:userId"),_.defaults({templateUrl:i("detail")},f))}function c(){t.addTitle(r("/:userId"),{data:u})}function u(e,n){return e.when({title:n.userId})}function d(){return{ROUTE_NEW_USER:m}}u.$inject=["$q","$routeParams"];var p="user",g=["ROLE_USER_MANAGEMENT_READ","ROLE_USER_MANAGEMENT_ADMIN"],m=r("/new"),f={priority:1e3,icon:p,name:s("Profile / Global roles")};return{initUi:a,$get:d}}e.$inject=["c8yNavigatorProvider","c8yViewsProvider","c8yTitleProvider","gettext"],angular.module("c8y.parts.users").provider("c8yUserUi",e)}(),function(){"use strict";function e(e,n,t,s,i,r,a,l,o,c){function u(e){return n.users||(n.users=[]),e.forEach(function(e){e._tenantAdmin=s.hasRole(e,"ROLE_TENANT_ADMIN"),s.isTfaActive(e).then(function(n){e.tfaActive=n,e.tfaStatus=o(n?"TFA enabled":"TFA disabled")}),n.users.push(e)}),n.paging=e.paging,n.users.length}function d(){E(s.list().then(u))}function p(){n.paging.loading=!0,n.paging.next().then(u).finally(function(){n.paging.loading=!1})}function g(e){return e.enabled?"check-circle":"minus-circle"}function m(e){return e.enabled?"text-success":"text-danger"}function f(e){s.enable(e).then(function(){e.enabled=!0})}function v(e){s.disable(e).then(function(){e.enabled=!1})}function h(e){return e.enabled?"Enabled":"Disabled"}function b(e){i({title:o("Confirm delete?"),body:c.getString('Do you really want to remove user "{{userName}}"?',{userName:e.userName}),labels:{ok:o("Delete")},status:"danger"}).then(angular.bind(s,s.remove,e)).then(angular.bind(r,r.removeFromList,n.users,e))}function w(e){t.path("/users/"+e.id)}function y(){n.refreshLoading=!0,n.paging.refresh().then(function(e){return n.users=null,delete n.refreshLoading,e}).then(u)}function E(e){var n=e.then(function(e){return{title:o("Users"),subtitle:_.isUndefined(e)?"":c.getString("{{qty}} users",{qty:e})}});a.changeTitle(n)}function A(){s.current().then(function(e){n.isAdmin=s.isAdmin(e),n.loggedUserId=e.id})}function N(){s.isTfaAvailable().then(function(e){n.tfaAvailable=e})}n.loadNext=p,n.enabledIcon=g,n.enabledClass=m,n.enabledTooltip=h,n.activate=f,n.deactivate=v,n.groups=s.groups,n.navigateToDetail=w,n.onClickDelete=b,n.refresh=y,n.ROUTE_NEW_USER=l.ROUTE_NEW_USER,e.$on("userUpdated",function(){n.users=[],d()}),d(),A(),N()}e.$inject=["$rootScope","$scope","$location","c8yUser","c8yModal","c8yBase","c8yTitle","c8yUserUi","gettext","gettextCatalog"],angular.module("c8y.parts.users").controller("userListCtrl",e)}(),function(){"use strict";function e(e,n,t,s,i,r,a,l,o,c,u){function d(){h().then(p),b()}function p(){D?i.detail(D).then(function(e){return e.data}).then(g):(e.isNew=!0,g({enabled:!0}),P(u("New user")))}function g(n){I=n.email,n.devicePermissions=n.devicePermissions||{},e.user=n,e._groups={},e.password.showPassword=e.isNew,(n.groups&&n.groups.references||[]).forEach(function(n){var t=n.group.id;e._groups[t]=!0}),e.isNew&&f(),m()}function m(){return i.checkIfCurrent(e.user).then(function(n){n&&o.listByUser(e.user).then(function(n){e.user.applications=n}),e.showUserApps=!(i.hasRole(e.user,"ROLE_APPLICATION_MANAGEMENT_READ")||i.hasRole(e.user,"ROLE_APPLICATION_MANAGEMENT_ADMIN"))})}function f(){_.forEach(e.groups,function(n){_.includes(k,n.name)&&(e._groups[n.id]=!0)})}function v(n){e.groups=n}function h(e){return r.list(e).then(v)}function b(){return i.current().then(w)}function w(n){e.currentUser=n}function y(n){e.isNew||!e.password.showPassword&&!E(n)?U(e.user):c.askForPassword().then(A)}function E(e){return e.email!==I}function A(n){n?U(e.user):N()}function N(){a.danger(u("Current password invalid!")),p()}function U(n){e.saving=!0;var s=!n.id||n.groups?_.keys(e._groups).filter(function(n){return e._groups[n]}).map(function(e){return parseInt(e,10)}):null;try{i.save(n).then(function(e){var n=e.data;return D=n.id=n.userName,n}).then(function(e){return s?r.updateGroups(e,s):e}).then(angular.bind({},p)).then(_.partial(a.success,u("User successfully saved"))).then(function(){t.history.back()}).finally(function(){e.saving=!1})}catch(n){a.danger(n.message),e.saving=!1}}function P(e){e&&l.changeTitle({title:e})}function T(e){return i.hasRole(e,"ROLE_USER_MANAGEMENT_ADMIN")}function R(e,n){return!(!e||!n)&&(!n.id||(e.id===n.id?i.hasRole(e,"ROLE_USER_MANAGEMENT_OWN_ADMIN"):i.hasRole(e,"ROLE_USER_MANAGEMENT_ADMIN")))}function x(e,n){return!(!e||!n)&&e.id!==n.id}function M(){return!0}var I,D=n.userId,k=["business"];e.checkPassword=y,e.$watch("user.userName",P),e.canEditUser=R,e.canEditUserGroups=T,e.canActivateUser=x,e.forms={},e.password={},e.saving=!1,e.showAcl=M,d()}e.$inject=["$scope","$routeParams","$window","c8yBase","c8yUser","c8yUserGroup","c8yAlert","c8yTitle","c8yApplication","c8yUserUtil","gettext"],angular.module("c8y.parts.users").controller("userDetailCtrl",e)}(),angular.module("c8y.parts.users").controller("aclEditorCtrl",["$scope","$q","c8yInventory","c8yUser","gettextCatalog",function(e,n,t,s,i){"use strict";function r(){a(),l()}function a(){e.newPermission=e.newPermission||{},e.newPermission.deviceSearch=null,e.newPermission.device=null,e.newPermission.scopeType=null,e.newPermission.type=null,e.newPermission.permissionType=null}function l(){s.current().then(function(n){var t=s.hasRole(n,"ROLE_USER_MANAGEMENT_READ"),i=s.hasRole(n,"ROLE_USER_MANAGEMENT_ADMIN");e.allowView=h=t||i,e.allowEdit=b=i})}function o(e){return e&&null!==e&&""!==e}function c(e){return o(e.device)&&o(e.device.id)&&null!==e.scopeType&&o(e.type)&&null!==e.permissionType}function u(n){var t=n.device.id,s=p(n);e.acl[t]||(e.acl[t]=[]),_.includes(e.acl[t],s)||e.acl[t].push(s),a()}function d(n,t){e.acl[n]=e.acl[n].filter(function(e){return e!==t}),0===e.acl[n].length&&delete e.acl[n]}function p(e){return[e.scopeType.value,e.type,e.permissionType.value].join(":")}function g(e){var n=e.split(":");return[i.getString(n[0]),n[1],i.getString(n[2])].join(":")}function m(e){var n={pageSize:20};return e&&(n.text=e),t.list(n).then(function(e){return f(e)})}function f(e){return _.uniqBy(e,function(e){return e.id})}function v(n){e.newPermission.device=n}var h,b;e.isValidPermission=c,e.add=u,e.remove=d,e.allowView=h,e.allowEdit=b,e.getDevices=m,e.setDevice=v,e.translatePermissionString=g,r()}]),angular.module("c8y.parts.users").directive("aclEditor",function(){"use strict";return{restrict:"A",scope:{acl:"="},templateUrl:"administration_users/views/aclEditor.html",controller:"aclEditorCtrl"}}),function(){"use strict";function e(e){var n;n='<div>\n\n  <!-- INVENTORY_ROLES_DEACTIVATION\n  <div class="alert alert-warning">\n    <i c8y-icon="exclamation-triangle" class="fa-2x pull-left"></i>\n    <span translate>This feature is deprecated. Although it continues fully functional you should use the user roles available in administration app</span>\n    <a href="/apps/administration#roles" translate>Go to administration</a>\n  </div> -->\n\n    <div ng-show="allowEdit && newPermission">\n        <div class="row">\n            <div class="form-group col-lg-3">\n                <label>{{\'Managed object\' | translate}} *</label>\n                <input type="text" class="form-control" maxlength="100" ng-model="newPermission.deviceSearch" ng-model-options="{debounce: 300}" placeholder="{{\'Select managed object from list\' | translate}}" uib-typeahead="device.id+\' - \'+device.name for device in getDevices($viewValue)" typeahead-on-select="setDevice($item)" uib-tooltip="{{\'Enter starting fragment of device id or name to search\'| translate}}"/>\n            </div>\n            <c8y-device-permission data-scope="newPermission.scopeType" data-permission-type="newPermission.type" data-access="newPermission.permissionType" data-device="newPermission.device">\n            </c8y-device-permission>\n        </div>\n        <div class="pull-right">\n            <button type="button" class="btn btn-primary" ng-disabled="!isValidPermission(newPermission)" ng-click="add(newPermission)" translate>Add</button>\n        </div>\n    </div>\n\n    <table class="table table-condensed table-permissions" ng-show="allowView">\n        <thead>\n            <tr>\n                <th translate>Device</th>\n                <th translate>Permissions</th>\n                <th>&nbsp;</th>\n            </tr>\n        </thead>\n        <tbody ng-repeat="(deviceId, permissions) in acl">\n            <tr ng-repeat="permission in permissions track by $index">\n                <td ng-if="$first" style="width: 200px" rowspan="{{permissions.length}}">\n                    {{deviceId}}\n                </td>\n                <td>\n                    {{translatePermissionString(permission)}}\n                </td>\n                <td class="text-right">\n                    <button ng-show="allowEdit" class="btn btn-danger btn-xs showOnHover" title="{{\'Remove permission\' | translate}}" ng-click="remove(deviceId, permission)"><i c8y-icon="times"></i></button>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n',e.put("administration_users/views/aclEditor.html",n),e.put("/apps/administration/users/views/aclEditor.html",n),n='<div data-ng-controller="userDetailCtrl">\n  <form name="forms.userForm" role="form" ng-submit="checkPassword(user)" novalidate>\n    <div class="row">\n      <div class="col-lg-4">\n        <div c8y-edit-user user="user" forms="forms" password="password" disabled-edit="!canEditUser(currentUser, user)" hide-active="!canActivateUser(currentUser, user)" hide-language="true"></div>\n        <button ng-if="canEditUser(currentUser, user)" ng-class="{\'btn-save\': showPassword}" class="btn btn-primary" type="submit" ng-disabled="forms.userForm.$invalid || saving" translate>\n          Save\n        </button>\n      </div>\n      <div class="col-lg-8">\n        <div class="panel panel-clean">\n          <div class="panel-heading">\n              <i c8y-icon="users"></i> <translate>User groups</translate>\n          </div>\n          <ul class="list-group">\n            <li class="list-group-item word-break" ng-repeat="group in groups" ng-class="{\'list-group-item-success\': _groups[group.id]}">\n              <input type="checkbox" ng-model="_groups[group.id]" ng-disabled="!canEditUserGroups(currentUser)">\n              <i c8y-icon="check-circle" class="text-success pull-right" ng-show="_groups[group.id]"></i>\n              <span>{{group.name}}</span>\n            </li>\n          </ul>\n        </div>\n\n        <div class="panel panel-clean" ng-show="showAcl()">\n          <div class="panel-heading">\n              <i c8y-icon="key"></i> <translate>User permissions</translate>\n          </div>\n          <div acl-editor acl="user.devicePermissions"></div>\n        </div>\n\n        <div class="panel panel-clean" ng-show="showUserApps">\n          <div class="panel-heading">\n              <i c8y-icon="key"></i> <translate>Application access</translate>\n          </div>\n          <div application-access-editor allowed-applications="user.applications" disabled-edit="user.id === currentUser.id"></div>\n        </div>\n      </div>\n    </div>\n  </form>\n\n</div>\n',e.put("administration_users/views/detail.html",n),e.put("/apps/administration/users/views/detail.html",n),n='<div data-ng-controller="userListCtrl">\n  <div class="clearfix">\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n    <c8y-if-allowed any-role="[\'ROLE_USER_MANAGEMENT_ADMIN\']">\n      <a href="#{{ROUTE_NEW_USER}}" class="btn btn-link pull-right">\n        <i c8y-icon="plus"></i> {{\'Add user\' | translate}}\n      </a>\n    </c8y-if-allowed>\n  </div>\n\n  <table class="table table-hover">\n    <tr ng-repeat="user in users|orderBy:\'userName\'">\n      <td style="width:30px" class="text-center">\n        <i c8y-icon="{{enabledIcon(user)}}" data-ng-class="enabledClass(user)" uib-tooltip="{{enabledTooltip(user) | translate}}"></i>\n      </td>\n\n\n      <td data-ng-click="navigateToDetail(user)" class="interact word-break">\n        <span>{{user.userName}}</span>\n        <small class="text-muted" style="margin-right:10px">\n          {{user.firstName}} {{user.lastName}}\n        </small>\n        <small ng-show="user.email" class="text-muted">\n          <i c8y-icon="envelope-o"></i>\n          {{user.email}}\n        </small>\n      </td>\n\n      <td style="max-width: 250px" class="hidden-xs">\n        <span class="label label-info label-truncated" ng-repeat="ref in user.groups.references" style="margin-right: 3px" title="{{ref.group.name}}">{{ref.group.name}}</span>\n      </td>\n\n      <td ng-if="isAdmin" c8y-password-strength user="user" class="hidden-xs hidden-sm"></td>\n\n      <td ng-if="tfaAvailable">\n        <span class="label label-warning label-truncated" title="{{\'TFA status\' | translate}}" ng-bind="user.tfaStatus | translate" ng-hide="user.tfaActive">\n        </span>\n      </td>\n\n      <td class="text-right word-nobreak">\n        <c8y-if-allowed any-role="[\'ROLE_USER_MANAGEMENT_ADMIN\']">\n          <div ng-if="user.id !== loggedUserId && !user._tenantAdmin">\n            <button class="btn btn-primary btn-xs showOnHover" ng-show="user.enabled" title="{{\'Deactivate user\' | translate}}" data-ng-click="deactivate(user)" translate>\n              Deactivate\n            </button>\n            <button class="btn btn-primary btn-xs showOnHover" ng-hide="user.enabled" title="{{\'Activate user\' | translate}}" data-ng-click="activate(user)" translate>\n              Activate\n            </button>\n            <button class="btn btn-danger btn-xs showOnHover" title="{{\'Delete user\' | translate}}" data-ng-click="onClickDelete(user)">\n              <i c8y-icon="times"></i>\n            </button>\n          </div>\n        </c8y-if-allowed>\n      </td>\n    </tr>\n  </table>\n\n  <c8y-load-more></c8y-load-more>\n</div>\n',e.put("administration_users/views/list.html",n),e.put("/apps/administration/users/views/list.html",n),n='<div class="modal-header" ng-show="title">\n  <h3>{{title}}</h3>\n</div>\n<div class="modal-body">\n  <div class="form-group">\n    <label>{{\'Current password\' | translate}} *</label>\n    <input type="password" name="currentPassword" class="form-control" ng-model="password.currentPassword" required c8y-autocomplete="off">\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="checkPassword(password.currentPassword)" translate>Confirm</button>\n  <button class="btn btn-default" ng-click="dismiss()" translate>Cancel</button>\n</div>\n',e.put("administration_users/views/passwordConfirmation.html",n),e.put("/apps/administration/users/views/passwordConfirmation.html",n)}angular.module("c8y.parts.users").run(["$templateCache",e])}();