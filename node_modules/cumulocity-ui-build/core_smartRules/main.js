/* core_smartRules 8.21.0 2018-01-30T22:09:32+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("templates-angularcronjobs",["cronselection.html"]),angular.module("cronselection.html",[]).run(["$templateCache",function(e){e.put("cronselection.html",'<div class="cron-wrap">\n<span>Every: </span>\n\t<select class="cron-select" ng-model="myFrequency.base" ng-options="item.value as item.label for item in frequency"></select>\n\n\t<div class="select-options">\n\t\t<span ng-show="myFrequency.base == 4">on </span>\n\t\t<select ng-show="myFrequency.base == 4" class="cron-select day-value" ng-model="myFrequency.dayValue" ng-options="(value | dayName) for value in dayValue"></select>\n\t\t<span ng-show="myFrequency.base >= 5">on the </span>\n\t\t<select ng-show="myFrequency.base >= 5" class="cron-select day-of-month-value" ng-model="myFrequency.dayOfMonthValue" ng-options="(value | numeral) for value in dayOfMonthValue"></select>\n\t\t<span ng-show="myFrequency.base == 6">of </span>\n\t\t<select ng-show="myFrequency.base == 6" class="cron-select month-value" ng-model="myFrequency.monthValue" ng-options="(value | monthName) for value in monthValue"></select>\n\t\t<span ng-show="myFrequency.base >= 2">at </span>\n\t\t<select ng-show="myFrequency.base >= 3" class="cron-select hour-value" ng-model="myFrequency.hourValue" ng-options="value for value in hourValue"></select>\n\t\t<span ng-show="myFrequency.base >= 3"> : </span>\n\t\t<select ng-show="myFrequency.base >= 2" class="cron-select minute-value" ng-model="myFrequency.minuteValue" ng-options="value for value in minuteValue"></select>\n\t\t<span ng-show="myFrequency.base == 2"> past the hour</span>\n\t</div>\n</div>\n')}]),angular.module("angular-cron-jobs",["templates-angularcronjobs"]),angular.module("angular-cron-jobs",["templates-angularcronjobs"]),angular.module("angular-cron-jobs").directive("cronSelection",["cronService",function(e){return{restrict:"EA",replace:!0,transclude:!0,scope:{config:"=",output:"=?",init:"=?"},templateUrl:function(e,n){return n.template||"cronselection.html"},link:function(n){var t=void 0,r=!1;if(n.frequency=[{value:1,label:"Minute"},{value:2,label:"Hour"},{value:3,label:"Day"},{value:4,label:"Week"},{value:5,label:"Month"},{value:6,label:"Year"}],angular.isDefined(n.init)&&(t=angular.copy(n.init),n.myFrequency=e.fromCron(n.init)),n.$watch("init",function(a){angular.isDefined(a)&&a&&a!==t&&(r=!0,n.myFrequency=e.fromCron(a))}),"object"==typeof n.config&&!n.config.length){var a=Object.keys(n.config.options);for(var l in a){var i=a[l].replace(/^allow/,""),s=a[l];if(!n.config.options[s])for(var o in n.frequency)n.frequency[o]===i&&delete n.frequency[o]}}n.minuteValue=[0,5,10,15,20,25,30,35,40,45,50,55],n.hourValue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],n.dayOfMonthValue=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],n.dayValue=[0,1,2,3,4,5,6],n.monthValue=[1,2,3,4,5,6,7,8,9,10,11,12],n.$watch("myFrequency",function(t,a){!t||a&&t.base===a.base||r?t&&t.base&&a&&a.base&&(r=!1):(t&&t.base&&(t.base=parseInt(t.base)),t&&t.base&&t.base>=2&&(t.minuteValue=n.minuteValue[0]),t&&t.base&&t.base>=3&&(t.hourValue=n.hourValue[0]),t&&t.base&&4===t.base&&(t.dayValue=n.dayValue[0]),t&&t.base&&t.base>=5&&(t.dayOfMonthValue=n.dayOfMonthValue[0]),t&&t.base&&6===t.base&&(t.monthValue=n.monthValue[0])),n.output=e.setCron(t)},!0)}}}]).filter("numeral",function(){return function(e){switch(e){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";case 21:return"21st";case 22:return"22nd";case 23:return"23rd";case 31:return"31st";case null:return null;default:return e+"th"}}}).filter("monthName",function(){return function(e){var n={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"};return null!==e&&angular.isDefined(n[e])?n[e]:null}}).filter("dayName",function(){return function(e){var n={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"};return null!==e&&angular.isDefined(n[e])?n[e]:null}}),angular.module("angular-cron-jobs").factory("cronService",function(){var e={};return e.setCron=function(e){var n=["*","*","*","*","*"];return e&&e.base&&e.base>=2&&(n[0]=void 0!==typeof e.minuteValue?e.minuteValue:"*"),e&&e.base&&e.base>=3&&(n[1]=void 0!==typeof e.hourValue?e.hourValue:"*"),e&&e.base&&4===e.base&&(n[4]=e.dayValue),e&&e.base&&e.base>=5&&(n[2]=void 0!==typeof e.dayOfMonthValue?e.dayOfMonthValue:"*"),e&&e.base&&6===e.base&&(n[3]=void 0!==typeof e.monthValue?e.monthValue:"*"),n.join(" ")},e.fromCron=function(e){var n=e.replace(/\s+/g," ").split(" "),t={base:"1"};return"*"===n[0]&&"*"===n[1]&&"*"===n[2]&&"*"===n[3]&&"*"===n[4]?t.base=1:"*"===n[1]&&"*"===n[2]&&"*"===n[3]&&"*"===n[4]?t.base=2:"*"===n[2]&&"*"===n[3]&&"*"===n[4]?t.base=3:"*"===n[2]&&"*"===n[3]?t.base=4:"*"===n[3]&&"*"===n[4]?t.base=5:"*"===n[4]&&(t.base=6),"*"!==n[0]&&(t.minuteValue=parseInt(n[0])),"*"!==n[1]&&(t.hourValue=parseInt(n[1])),"*"!==n[2]&&(t.dayOfMonthValue=parseInt(n[2])),"*"!==n[3]&&(t.monthValue=parseInt(n[3])),"*"!==n[4]&&(t.dayValue=parseInt(n[4])),t},e}),function(){"use strict";angular.module("c8y.smartRules",["c8y.cockpit.dataPointExplorer","c8y.cockpit.map","leaflet-directive","angular-cron-jobs"]).constant("smartRulesTemplateBasePath","core_smartRules/views/")}(),function(){"use strict";function e(e,n,t,r,a,l,i,s,o,c,u,d,p,m,f,v,g){function h(){y(),K(),D()}function y(){return t.when().then(b).then(w).then(C).then(Y).then(R).catch(S)}function b(){ie.inProgress=!0}function R(){ie.inProgress=!1,ie.done=!0,ie.error=!1}function S(e){e.data&&e.data.message&&c.danger(e.data.message),ie.inProgress=!1,ie.done=!0,ie.error=!0}function w(){return x().then(I)}function x(){return m.list()}function I(e){_.forEach(e||[],function(e){ae[e.name]=e})}function C(){var n=re?f.listByContext(re):t.when([]),r=p.hasPermissions().then(function(e){return e?f.list():t.when([])});t.all({listByContext:n,list:r}).then(function(n){e.rules=A(_.concat(n.listByContext,n.list))})}function A(e){function n(e){var n=new RegExp(e+"/dashboard");return function(e){var t=_.get(e,"config.url","");return T(e)&&!n.test(t)}}var t=e;return re&&(t=_.reject(e,n(re))),t}function T(e){return"sendDashboardsViaEmail"===e.ruleTemplateName}function F(e){return!T(e)}function k(e){return O(e)?f.deactivate(e,re,!1).then(function(){c.success(g.getString('Rule "{{name}}" deactivated!',e))}):f.activate(e,re,!1).then(function(){c.success(g.getString('Rule "{{name}}" activated!',e))})}function E(n,r){var a=[];return _.forEach(r,function(t){var r=!_.find(e.ruleChildren[n.id],function(e){return e.id===t.id});r&&a.push(f.activate(n,t,!1))}),_.forEach(e.ruleChildren[n.id],function(e){var t=!_.find(r,function(n){return e.id===n.id});t&&a.push(f.deactivate(n,e,!1))}),t.all(a).then(C).then(Y).then(function(){c.success(g.getString('Rule "{{name}}" activated/deactivated for children!',n))})}function D(){"device"===oe.context&&a.getStaticLinkTemplate("devicemanagementDeviceDetails").then(function(e){ce=e})}function P(){var e={deviceId:re};return r(ce||"")(e)}function q(){f.addNewWithUI().then(y)}function $(e){f.editWithUI(e).then(y)}function M(e){f.cloneWithUI(e).then(y)}function N(n){o({title:v("Confirm delete?"),body:g.getString('Do you really want to remove rule "{{name}}" with the id {{id}}?',n),labels:{ok:v("Delete")},status:"danger"}).then(angular.bind(f,f.remove,n)).then(_.partial(_.pull,e.rules,n)).then(_.partial(_.unary(c.success),v("Smart Rule successfully removed!")))}function O(e){return f.hasSource(e,re)}function V(e){var t={activate:{"for group":v("Activate for this group"),"for device":v("Activate for this device"),"for object":v("Activate for this object")},deactivate:{"for group":v("Deactivate for this group"),"for device":v("Deactivate for this device"),"for object":v("Deactivate for this object")}},r=e.enabled&&O(e)?"deactivate":"activate",a=n.groupId?"group":"object";return a=n.deviceId?"device":a,t[r]["for "+a]}function U(e){var n=void 0,t=ae[e.ruleTemplateName];return t&&(n=g.getString(t.label.input)+" "+g.getString(t.label.output)),n}function j(e){var n=void 0,t=ae[e.ruleTemplateName];return t&&(n=t.paramGroups.input.icon),n}function L(e){var n=void 0,t=ae[e.ruleTemplateName];return t&&(n=t.paramGroups.output.icon),n}function G(e){return se[e.enabled].text}function B(e){return se[e.enabled].icon}function W(e){return se[e.enabled].cls}function K(){var e=u.getContext();null===e.context&&d.changeTitle({title:ue})}function z(){var e=u.getContext();return null!==e.context}function Y(){var n=u.getContext();return null===n.context?t.resolve():l.childAssets(n.id).then(function(n){e.children=n}).then(function(){e.ruleChildren={},_.forEach(e.rules,function(n){e.ruleChildren[n.id]=H(n)})})}function H(n){return _.filter(e.children,function(e){return f.hasSource(n,e)})}function J(){var e=le.canSeeSection;return _.isUndefined(e)&&(le.canSeeSection=Z().then(function(e){return le.canSeeSection=e,le.canSeeSection}),e=!1),e}function Z(){return a.checkIfModulesExist(["c8y.cockpit.config"])?p.shouldShowLocalSmartRules():t.when(!1)}function Q(n){var t=_.get(ae,_.get(n,"ruleTemplateName")+"._active"),r=le.canAddRules;if(n&&!t&&(r=!1),_.isUndefined(r)){var a;a=e.context?{adminMOs:[e.context.id]}:{allRoles:["ROLE_INVENTORY_ADMIN"],anyRole:["ROLE_SMARTRULE_ADMIN","ROLE_CEP_MANAGEMENT_ADMIN"]},le.canAddRules=s.isAllowed(a).then(function(e){return le.canAddRules=e,le.canAddRules}),r=!1}return r}function X(e){var n=le.rules=le.rules||{},t=n[e.id];return _.isUndefined(t)&&(n[e.id]=s.isAllowed({adminMOs:[e.id]}).then(function(t){return n[e.id]=t,n[e.id]}),t=!1),t}function ee(){var e=le.canInspect;return _.isUndefined(e)&&(le.canInspect=t.all({administrationAccess:ne(),eventProcessingAccess:te(),eventProcessingEnabled:f.eventProcessingEnabled()}).then(function(e){return le.canInspect=e.administrationAccess&&e.eventProcessingAccess&&e.eventProcessingEnabled,le.canInspect}),e=!1),e}function ne(){return i.listByUser().then(function(e){return!!_.find(e,{contextPath:"administration"})})}function te(){return s.isAllowed({anyRole:["ROLE_CEP_MANAGEMENT_READ","ROLE_CEP_MANAGEMENT_ADMIN"]})}var re=n.deviceId||n.groupId,ae={},le={},ie={done:!1,inProgress:!1},se={true:{text:v("Enabled"),icon:"check-circle",cls:"text-success"},false:{text:v("Disabled"),icon:"ban",cls:"text-warning"}},oe=u.getContext(),ce=void 0,ue=v("Global Smart Rules");_.assign(e,{isOpen:{},moId:re,loadingStatus:ie,refresh:y,paging:{refresh:y},ruleTemplates:ae,getLinkToDM:P,add:q,edit:$,clone:M,remove:N,hasSource:O,getChildrenEnabledForSmartRule:H,toggleRuleActivationForContextMO:k,toggleRuleActivationForChildrenMOs:E,tooltip:V,type:U,status:G,statusIcon:B,statusClass:W,showTitle:z,title:ue,context:oe,inputIcon:j,outputIcon:L,canAddRules:Q,canModify:X,canInspect:ee,canApplyOnChildren:F,canSeeSection:J}),h()}e.$inject=["$scope","$routeParams","$q","$interpolate","c8yBase","c8yInventory","c8yApplication","c8yPermissions","c8yModal","c8yAlert","c8yUiUtil","c8yTitle","c8ySmartRulesAvailability","smartRuleTemplatesSvc","smartRulesSvc","gettext","gettextCatalog"],angular.module("c8y.smartRules").controller("SmartRulesListCtrl",e)}(),function(){"use strict";function e(e,n,t,r,a,l,i,s){function o(){c()}function c(){u().then(d).then(p).then(m).then(f)}function u(){return l.list()}function d(e){return _.filter(e,function(e){return!e.hideFromList})}function p(e){var n,t;return n=_.keys(i),0===n.length?e:_.filter(e,function(e){return!!(e.contexts&&(t=_.keys(e.contexts),_.intersection(n,t).length>0))})}function m(e){e.forEach(function(e){y.push(e)})}function f(){1===y.length&&y[0]._active&&v(y[0])}function v(e){if(e._active)return a.createInstanceWithUI(e,g(e)).then(t.close)}function g(e){var n={},t=e.contexts&&_.intersection(_.keys(i),_.keys(e.contexts))||[];return _.forEach(t,function(t){var a={obj:i[t]},l={rule:n};_.forEach(e.contexts[t],function(e,n){var t=r("obj."+n),i=r("rule."+e),s=t(a);i.assign(l,s)})}),n}function h(){t.dismiss()}var y=[];n.ruleTemplates=y,n.cancel=h,n.createInstance=v,o()}angular.module("c8y.smartRules").controller("SmartRuleAddCtrl",["$q","$scope","$uibModalInstance","$parse","smartRulesSvc","smartRuleTemplatesSvc","context","c8ySettings",e])}(),function(){"use strict";function e(e,n,t,r,a,l,i,s,o,c,u,d,p){function m(){f(),v(),h(),y()}function f(){u&&u.id?S(d("Edit global Smart Rule")):(S(d("New global Smart Rule")),u=_.assign(s.getEmpty(),u||{})),e.rule=u}function v(){c?g(c):o.getTemplateForRule(u).then(g)}function g(n){e.ruleTemplate=c=n,e.rule.name||(e.rule.name=p.getString(e.ruleTemplate.description))}function h(){e.initialActivationCfg=F;var n=_.get(u,"c8y_Context",l.getContext());return a.detail(n.id).then(r.getResData).then(function(e){F.mo=e})}function y(){if(u&&u.id){var e;_.isEmpty(u.enabledSources)||(e=u.enabledSources.join(","),a.list({ids:e}).then(b)),_.isEmpty(u.disabledSources)||(e=u.disabledSources.join(","),a.list({ids:e}).then(R))}}function b(n){e.enabledSources=_.sortBy(n,"name")}function R(n){e.disabledSources=_.sortBy(n,"name")}function S(n){e.title=A=n}function w(){c.noTarget&&(F.withChildren={assets:!1,devices:!1}),t.when().then(I).then(angular.bind(s,s.save,u,c,F)).then(n.close,x).then(_.partial(_.unary(i.success),p.getString('Smart Rule "{{name}}" saved successfully!',{name:u.name}))).then(C)}function x(){return C(),t.reject()}function I(){k.inProgress=!0}function C(){k.inProgress=!1}var A,T="smartRuleForm",F={parent:null,mo:null,withChildren:{assets:!0,devices:!1}},k={inProgres:!1};e.hasChildAssets=angular.bind(a,a.hasChildAssets),e.getChildAssetsCount=angular.bind(a,a.getChildAssetsCount),e.ruleTemplate=c,e.rule=u,e.save=w,e.savingStatus=k,e.cancel=n.dismiss,e.invalid=angular.bind(r,r.invalid,e,T),m()}e.$inject=["$scope","$uibModalInstance","$q","c8yBase","c8yInventory","c8yUiUtil","c8yAlert","smartRulesSvc","smartRuleTemplatesSvc","ruleTemplate","rule","gettext","gettextCatalog"],angular.module("c8y.smartRules").controller("SmartRuleEditCtrl",e)}(),function(){"use strict";function e(e,n){function t(e){return n.getString(e.label)+(e.required?" *":"")}function r(e,n){return l(e,n,!1)}function a(e,n){return l(e,n,!0)}function l(e,t,r){var a=!_.isUndefined(e.config[t.property]),l=r&&_.isString(t.default),i=l?n.getString(t.default):t.default;return a?e.config[t.property]:i}e.placeholder=this.placeholder=t,e.currentValueOrDefault=this.currentValueOrDefault=r,e.currentValueOrTranslatedDefault=this.currentValueOrTranslatedDefault=a}angular.module("c8y.smartRules").controller("smartRuleParamInputCtrl",["$scope","gettextCatalog",e])}(),function(){"use strict";function e(e,n,t,r,a,l){function i(e){S.parentMoId=e.id||e,a.detailCached(S.parentMoId).then(r.getResData).then(function(e){R=S.childAssets=_.map(e.childAssets.references,"managedObject"),I=e.childAssets.references.length})}function s(e){w={},x={},_.forEach(e,function(e){w[e.id]=!0,x[e.id]=!0})}function o(n){n&&s(e.selectedChildAssets()),t(function(){S.dropdownOpeningFinished=n})}function c(e){return x[e.id]}function u(){_.forEach(f(),d)}function d(e){x[e.id]=!0}function p(){var e=f();if(e){var n=_.filter(e,c);return n.length===e.length}}function m(){_.forEach(f(),v)}function f(){return n("filter")(R,A.text)}function v(e){x[e.id]=!1}function g(e){x[e.id]=!x[e.id]}function h(){var e=y();return e===I?l.getString("All selected"):0===e?l.getString("None selected"):l.getPlural(e,"1 selected","{{$count}} selected",{})}function y(){return _.filter(w,_.identity).length}function b(){e.onSelectionConfirmed&&e.onSelectionConfirmed({selection:_.filter(R,c)}),C.open=!1}var R,S=this,w={},x={},I=null,C={open:!1},A={text:""};S.isSelected=c,S.selectAllVisible=u,S.select=d,S.deselectAllVisible=m,S.deselect=v,S.toggle=g,S.areAllVisibleSelected=p,S.getSelectedStatusText=h,S.apply=b,S.filterCfg=A,S.dropdownStatus=C,e.$watch("parentMo()",i),e.$watch("selectedChildAssets()",s),e.$watch("ctrl.dropdownStatus.open",o)}e.$inject=["$scope","$filter","$timeout","c8yBase","c8yInventory","gettextCatalog"],angular.module("c8y.smartRules").controller("c8yChildAssetsSelectorCtrl",e)}(),function(){"use strict";function e(e,n,t,r,a,l,i,s){function o(){var e,t=h.get(y);return e=t?r.when(t):n.get(g).then(a.getResData).then(function(e){return _.filter(e,function(e){return!_.includes(i.smartRules.exclude,e.name)})}).then(c).then(function(e){return h.put(y,e),e})}function c(e){var n=[];return e.forEach(function(e){n.push(p(e))}),r.all(n)}function u(e){return o().then(function(n){return _.find(n,{name:e.ruleTemplateName})})}function d(e){return o().then(function(n){return _.find(n,{name:e})}).then(p)}function p(e){return f(e.name).then(function(n){return e._active=n,r.when(e)})}function m(e){return f(e).then(function(e){return e?r.when():r.reject()})}function f(e){switch(e){case"sendDashboardsViaEmail":return v();case"onAlarmSendSms":return r.all([l.getSystemOptionValue({category:"messaging",key:"provider"},!1)]).then(function(e){return!_.isEmpty(e[0])});case"onAlarmTextToSpeechCall":return r.all([l.getSystemOptionValue({category:"messaging",key:"speech.provider"},!1)]).then(function(e){return!_.isEmpty(e[0])});case"onAlarmEscalateAlarm":return r.all([f("onAlarmSendSms"),f("onAlarmTextToSpeechCall")]).then(function(e){return e[0]||e[1]});default:return r.when(!0)}}function v(){return r.all({systemOption:l.getSystemOptionValue({category:"reportMailer",key:"available"},!1),featureActive:s.isAvailable({name:"feature-dashboard-mailer"})}).then(_.every)}var g=a.url("service/smartrule/smartrules/configurations"),h=e("smartRuleTemplates"),y="list";return _.get(window,"c8y.collections.smartrules",[]).length>0&&t.warn("In-memory definitions of smart rules are not supported right now."),{list:o,getTemplateForRule:u,getTemplateByName:d,mustBeAvailable:m,isAvailable:f}}e.$inject=["$cacheFactory","$http","$log","$q","c8yBase","c8ySettings","c8yConfig","c8yApplication"],angular.module("c8y.smartRules").factory("smartRuleTemplatesSvc",e)}(),function(){"use strict";function e(e,n,t,r,a,l,i,s,o,c){function u(e){var n=e||a.getContext(),t={type:W,name:"",enabled:!0,config:{}};return n.context&&n.id&&(t.c8y_Context=n,t.type=K),t}function d(){return n.get(B).then(t.getResData).then(_.property("rules")).then(m)}function p(e){return n.get(y({moId:e})).then(t.getResData).then(_.property("rules")).then(m)}function m(n){return e.all(_.map(n,function(e){return s.getTemplateForRule(e).then(function(n){return _.isUndefined(n)?null:e})})).then(_.flatten).then(_.filter)}function f(e){var r=h({id:e});return n.get(r).then(t.getResData)}function v(e,n,t){var r;return r=e.id?S(e):g(e,n,t)}function g(e,r,a){var l=h(e,!0);return b(e,r,a).then(_.partial(n.post,l)).then(t.getResData)}function h(e,n){var t=_.get(e,"c8y_Context.id"),r=n&&t,a=r?y({moId:t}):B;return e.id&&(a+="/"+e.id),a}function y(e){return G+"/managedObjects/"+e.moId+"/smartrules"}function b(e,n,t){return e.ruleTemplateName=n.name,R(e,t)}function R(n,t){var r=e.when(n);return n.c8y_Context||t.mo?(n.enabledSources=[],n.disabledSources=void 0,r=C(n,t.mo,t.withChildren)):(n.enabledSources=void 0,n.disabledSources=[]),r}function S(e){var r=h(e,!0),a=t.cleanFields(e,Y);return n.put(r,a)}function w(e){var t=h(e,!0);return n.delete(t)}function x(e,n){var t=n&&n.id||n;return!!t&&(e.disabledSources?!E(e.disabledSources,t):!e.enabledSources||E(e.enabledSources,t))}function I(e,n,t){return C(e,n,t).then(S)}function C(e,n,t){return F(n,t).then(function(n){return _.forEach(n,function(n){_.isArray(e.enabledSources)&&!E(e.enabledSources,n)&&e.enabledSources.push(n),_.isArray(e.disabledSources)&&E(e.disabledSources,n)&&_.remove(e.disabledSources,function(e){return e==n})}),e})}function A(e,n,t){return T(e,n,t).then(S)}function T(e,n,t){return F(n,t).then(function(n){return _.forEach(n,function(n){_.isArray(e.enabledSources)&&E(e.enabledSources,n)&&_.remove(e.enabledSources,function(e){return e==n}),_.isArray(e.disabledSources)&&!E(e.disabledSources,n)&&e.disabledSources.push(n)}),e})}function F(n,t){var r=n&&n.id||n,a=[];return r&&(a.push(e.when(r)),a.push(k(r,t))),e.all(a).then(_.flattenDeep)}function k(n,t){var a=[];return t!==!0&&t.assets!==!0||a.push(r.childAssets(n)),t!==!0&&t.devices!==!0||a.push(r.childDevices(n)),e.all(a).then(_.flattenDeep).then(_.partialRight(_.map,"id"))}function E(e,n){var t=n.id||n;return _.some(e,function(e){return e==t})}function D(e){var n=e||{};return l({title:o("Add global Smart Rule"),templateUrl:"core_smartRules/views/add.html",controller:"SmartRuleAddCtrl",size:"lg",resolve:{context:function(){return _.cloneDeep(n)}}})}function P(e,n){var t={inputAlarm:e,outputUser:n};return D(t)}function q(e){var n={inputDataPoint:e};return D(n)}function $(e){var n={outputOperation:{template:M(e)}};return D(n)}function M(e){var n=["id","self","status","deviceId","creationTime","failureReason"];return t.cleanFields(e,n)}function N(e,n){return L(n,e)}function O(e,n){return s.getTemplateByName(e).then(function(e){return N(e,n)})}function V(e){return L(e,void 0)}function U(e){return i.current().then(_.partial(j,e)).then(L)}function j(e,n){var r=_.cloneDeep(e);return r=t.cleanFields(r,z),r.name=c.getString("Clone of {{name}}",r),n&&(r.owner=n.id),r}function L(e,n){return l({templateUrl:"core_smartRules/views/edit.html",controller:"SmartRuleEditCtrl",size:"sm",resolve:{ruleTemplate:function(){return _.cloneDeep(n)},rule:function(){return _.cloneDeep(e)}}})}var G=t.url("service/smartrule"),B=G+"/smartrules",W="c8y_SmartRule",K="c8y_PrivateSmartRule",z=["id","self","cepModuleId","lastUpdated","creationTime"],Y=["type","cepModuleId","creationTime","lastUpdated"],H={create:{anyRole:["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"],allRoles:["ROLE_CEP_MANAGEMENT_ADMIN"]}};return{eventProcessingEnabled:a.shouldShowEventProcessing,permissionsCfgs:H,getEmpty:u,list:d,listByContext:p,detail:f,save:v,remove:w,hasSource:x,activate:I,deactivate:A,addNewWithUI:D,addNewForInputAlarmAndOutputUserWithUI:P,addNewForInputDataPointWithUI:q,addNewForOutputOperationWithUI:$,createInstanceWithUI:N,createInstanceWithUIByName:O,editWithUI:V,cloneWithUI:U}}e.$inject=["$q","$http","c8yBase","c8yInventory","c8yUiUtil","c8yModal","c8yUser","smartRuleTemplatesSvc","gettext","gettextCatalog"],angular.module("c8y.smartRules").factory("smartRulesSvc",e)}(),angular.module("c8y.smartRules").directive("smartRuleParamInput",["$compile",function(e){"use strict";return{scope:{rule:"=",param:"=",ruleTemplate:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInput.html",controller:"smartRuleParamInputCtrl",compile:function(n,t){var r,a=n.contents().remove();return function(n,t,l){function i(e){e.showIf?n.$watch(e.showIf,function(e){n.visible=e}):n.visible=!0}function s(e){e.requireIf&&n.$watch(e.requireIf,function(n){e.required=n})}function o(e){e.setIf&&n.$watch(e.setIf,function(t){t||(n.rule.config[e.property]=void 0)})}r||(r=e(a)),r(n,function(e,n){t.append(e)}),i(n.param),s(n.param),o(n.param)}}}}]),function(){"use strict";function e(e){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputAlarmSeverity.html",link:function(n,t,r,a){n.placeholder=a.placeholder,n.severities=e.severityList}}}angular.module("c8y.smartRules").directive("smartRuleParamInputAlarmSeverity",["c8yAlarms",e])}(),function(){"use strict";function e(e){function n(n){return[e.getString(n.label)," ",e.getString('(e.g. "c8y_UnavailabilityAlarm". The alarm type can be found in alarm details in Device management alarm section)'),n.required?" *":""].join("")}return{require:"^smartRuleParamInput",scope:{rule:"=",param:"=",multiple:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputAlarmType.html",link:function(e,t,r,a){function l(){var n=e.rule.config[e.param.property]||"";e.alarmTypes=_.map(n.split(","),function(e){return{name:e}})}function i(){e.alarmTypes.push({name:""})}function s(n){_.remove(e.alarmTypes,n)}e.placeholder=a.placeholder,e.tooltip=n,e.add=i,e.remove=s,e.$watch("alarmTypes",function(n){e.rule.config[e.param.property]=_.map(n,"name").join(",")},!0),l()}}}angular.module("c8y.smartRules").directive("smartRuleParamInputAlarmType",["gettextCatalog",e])}(),angular.module("c8y.smartRules").directive("smartRuleParamInputCheckbox",function(){"use strict";return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputCheckbox.html",link:function(e,n,t,r){e.placeholder=r.placeholder}}}),function(){"use strict";function e(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputDashboard.html"}}angular.module("c8y.smartRules").directive("smartRuleParamInputDashboard",e)}(),angular.module("c8y.smartRules").directive("smartRuleParamInputDefault",function(){"use strict";return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputDefault.html",link:function(e,n,t,r){e.placeholder=r.placeholder}}}),function(){"use strict";function e(){var e=/^([a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*,?)*$/i;return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputEmail.html",link:function(e,n,t,r){e.placeholder=r.placeholder},controller:["$scope",function(n){n.emailsPattern=e}]}}angular.module("c8y.smartRules").directive("smartRuleParamInputEmail",e)}(),function(){"use strict";function e(){function e(e,n,t,r,a){function l(){i(),c(),p()}function i(){P=_.cloneDeep(e.param.stepTypes),e.stepTypes=P,s()}function s(){var n=e.ruleTemplate.paramGroups,t=[].concat(n.input.params).concat(n.output.params),r=_.map(t,"property");_.forEach(P,_.partial(o,r))}function o(e,n){n.params=n.params||[],n.associatedRuleTemplateName&&t.getTemplateByName(n.associatedRuleTemplateName).then(function(t){n._active=t._active;var r=t.paramGroups,a=[].concat(r.input.params).concat(r.output.params);_.forEach(a,function(t){_.includes(e,t.property)||n.params.push(t)})})}function c(){D=_(e.rule.config[e.param.property]||[]).sortBy(u).map(d).value(),e.steps=D}function u(e){return e.ifFailed||0}function d(e){return{config:e,executionCondition:{ifFailed:e.ifFailed},expanded:!1,type:_.find(P,{associatedRuleTemplateName:e.ruleTemplateName})}}function p(){_.forEach(D,m),_.forEach(D,v)}function m(e){q.push({ifFailedStepRef:e})}function f(n){e.executionConditions=q=_.filter(q,function(e){return e.ifFailedStepRef!==n})}function v(e){_.isUndefined(e.executionCondition.ifFailed)?e.executionCondition=q[0]:e.executionCondition=_.find(q,function(n){return C(n.ifFailedStepRef)===e.executionCondition.ifFailed})}function g(e){return e&&e.type&&e.type.icon}function h(){var e=y();D.push(e),m(e)}function y(){return{type:P[0],expanded:!0,config:{},executionCondition:q[0]}}function b(e){return function(n){return!(n.ifFailedStepRef&&n.ifFailedStepRef.type&&!n.ifFailedStepRef.type.failable)&&(n.ifFailedStepRef!==e&&!(n.ifFailedStepRef&&n.ifFailedStepRef.executionCondition.ifFailedStepRef===e))}}function R(e){return!S(e)}function S(e){return!!_.find(D,function(n){return n.executionCondition&&n.executionCondition.ifFailedStepRef===e})}function w(n){f(n),e.steps=D=_.without(D,n)}function x(e){e.expanded=!e.expanded}function I(e){var n=e.label;return e.ifFailedStepRef&&(n=a.getString("On step {{stepNo}} failed",{stepNo:C(e.ifFailedStepRef)+1})),n}function C(e){return D.indexOf(e)}function A(n){var t=_(n).map(T).sortBy(u).value();e.rule.config[e.param.property]=t}function T(e){var n=_.assign({},e.config);return n.ruleTemplateName=e.type.associatedRuleTemplateName,e.executionCondition&&e.executionCondition.ifFailedStepRef&&(n.ifFailed=C(e.executionCondition.ifFailedStepRef)),n}function F(e){return!(e.type.failable&&S(e))}function k(e){var n=_.filter(D,function(e){return!e.executionCondition.ifFailedStepRef});return!(1===n.length&&n[0]===e)}function E(e){return r(e.expanded?"Collapse":"Expand")}var D,P,q=[{label:r("Always"),ifFailedStepRef:null}];e.executionConditions=q,e.icon=g,e.executionConditionsFilter=b,e.addStep=h,e.canRemoveStep=R,e.removeStep=w,e.getStepNo=C,e.toggleExpand=x,e.executionConditionLabel=I,e.canChangeStepType=F,e.canChangeExecutionCondition=k,e.getStepTooltip=E,e.$watch("steps",A,!0),l()}return{require:"smartRuleParamInput",scope:{rule:"=",param:"=",ruleTemplate:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputEscalationSteps.html",controller:["$scope","$q","smartRuleTemplatesSvc","gettext","gettextCatalog",e]}}angular.module("c8y.smartRules").directive("smartRuleParamInputEscalationSteps",e)}(),function(){"use strict";function e(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputExportConfiguration.html"}}angular.module("c8y.smartRules").directive("smartRuleParamInputExportConfiguration",e)}(),function(){"use strict";angular.module("c8y.smartRules").directive("smartRuleParamFrequency",["gettext",function(e){return e("Hour"),e("Day"),e("Week"),e("Month"),e("Year"),{scope:{rule:"=",param:"="},restrict:"E",template:'<cron-selection template="core_smartRules/views/paramInputFrequency.html" config="config" output="cronRule" init="initRule"></cron-selection>',controller:["$scope",function(e){e.config={options:{allowMinute:!1}};var n=e.rule.config;e.initRule=n.minute||"*",e.initRule+=" "+(n.hour||"*"),e.initRule+=" "+(n.day||"*"),e.initRule+=" "+(n.month||"*"),e.initRule+=" "+(n.weekday||"*"),"* * * * *"===e.initRule&&(e.initRule="0 0 * * 1"),e.$watch("cronRule",function(n){if(n){var t=n.split(/\s+/);e.rule.config.minute=t[0],e.rule.config.hour=t[1],e.rule.config.day=t[2],e.rule.config.month=t[3],e.rule.config.weekday=t[4]}})}]}}]).filter("smartRuleParamFrequency",function(){return function(e){return(e||[]).filter(function(e){return"Minute"!==e.label})}}).filter("smartRuleParamFrequencyDayNameToDate",function(){return function(e){return moment().day(e).toDate()}}).filter("smartRuleParamFrequencyMonthNameToDate",function(){return function(e){return moment().month(e-1).toDate()}}).filter("smartRuleParamFrequencyMinuteValueToDate",function(){return function(e){return moment().minute(e).toDate()}})}(),function(){"use strict";function e(){function e(e,n,t){function r(){a(e.rule.config[e.param.property])}function a(n){e.rule.config[e.param.property]=n,i.latlngs.length=0,_.forEach(n,function(e){i.latlngs.push(e),s.add(e)}),o.bounds=s.get()}function l(){t.showEditUI(i.latlngs).then(function(e){a(e)})}var i={type:"polygon",stroke:!0,weight:1,color:"#2e3974",fillColor:"#2e3974",latlngs:[]},s=new n.Bounds,o={center:{},bounds:s.get(),paths:{geofence:i}};e.map=o,e.editGeofence=l,r()}return{require:"smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputGeofence.html",controller:["$scope","c8yGeo","geofenceSvc",e]}}angular.module("c8y.smartRules").directive("smartRuleParamInputGeofence",e)}(),function(){"use strict";function e(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"=",kpiId:"=",fragment:"=",series:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputKpi.html",link:function(e,n,t,r){e.placeholder=r.placeholder},controller:["$scope","c8yKpi","c8yDataPointSvc",function(e,n,t){function r(){a()}function a(){l().then(o)}function l(){return m||(m=n.list()),m}function i(n){return s(n.c8y_Kpi.fragment,e.fragment)&&s(n.c8y_Kpi.series,e.series)}function s(e,n){return!n||e===n}function o(n){e.kpis=n}function c(n){return _.find(e.kpis,function(e){return e.id==n})}function u(e){var n=e.c8y_Kpi;return n.label+" - "+n.series}function d(){t.chooseKpiWithUI().then(function(n){e.kpiId=n[0]._kpiId}).then(p)}function p(){var n=c(e.kpiId);n&&(e.fragment=n.c8y_Kpi.fragment,e.series=n.c8y_Kpi.series)}var m;e.filterMatchingKpis=i,e.nameKpi=u,e.chooseKpi=d,e.changedKpiSelection=p,r()}]}}angular.module("c8y.smartRules").directive("smartRuleParamInputKpi",e)}(),angular.module("c8y.smartRules").directive("smartRuleParamInputNumber",function(){"use strict";function e(e,n,t,r){
e.isDefined=function(e){return!_.isUndefined(e)},e.placeholder=r.placeholder}return{require:"^smartRuleParamInput",scope:{rule:"=",param:"=",min:"=?",max:"=?"},restrict:"E",templateUrl:"core_smartRules/views/paramInputNumber.html",link:e}}),function(){"use strict";function e(e){function n(e){function n(){e.operation.json=e.rule.config[e.param.property]||{}}function r(n){e.operation.json=angular.copy(n)}var a={json:{},example:null};e.operation=a,e.operationExamples=t,e.chooseOperationExample=r,e.$watch("operation.json",function(n){e.rule.config[e.param.property]=n},!0),n()}var t=[{description:e.getString("Restart device"),c8y_Restart:{}},{description:e.getString("Update relay status to OPEN"),c8y_Relay:{relayState:"OPEN"}},{description:e.getString("Update relay status to CLOSED"),c8y_Relay:{relayState:"CLOSED"}}];return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputOperation.html",link:function(e,n,t,r){e.placeholder=r.placeholder},controller:["$scope",n]}}e.$inject=["gettextCatalog"],angular.module("c8y.smartRules").directive("smartRuleParamInputOperation",e)}(),function(){"use strict";function e(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputPhoneNumber.html"}}angular.module("c8y.smartRules").directive("smartRuleParamInputPhoneNumber",e)}(),function(){"use strict";function e(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputSelect.html",link:function(e,n,t,r){e.placeholder=r.placeholder}}}angular.module("c8y.smartRules").directive("smartRuleParamInputSelect",e)}(),angular.module("c8y.smartRules").directive("smartRuleParamInputTextarea",function(){"use strict";return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputTextarea.html",link:function(e,n,t,r){e.placeholder=r.placeholder}}}),function(){"use strict";function e(e,n){function t(e,t){return[n.getString(e.label)," (",n.getString(t),")",e.required?" *":""].join("")}return{require:"smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:"core_smartRules/views/paramInputTimeInterval.html",controller:["$scope",function(n){function r(){return n.rule.config[n.param.property]}function a(e){e&&(n.rule.config[n.param.property]=e)}function l(){return n.timeInterval.amount&&n.timeInterval.unit&&n.timeInterval.amount*n.timeInterval.unit.valueInSeconds}function i(e){_.assign(o,s(e))}function s(e){var n=c[2];return _.forEach(c,function(t){var r=e/t.valueInSeconds;return r%1!==0||(e=r,n=t,!1)}),{amount:e,unit:n}}var o={amount:null,unit:null},c=[{label:e("hours"),valueInSeconds:3600,dontDisplay:!1},{label:e("minutes"),valueInSeconds:60,dontDisplay:!1},{label:e("seconds"),valueInSeconds:1,dontDisplay:n.param.dontUseSeconds||!1}],u={AMOUNT:e("amount"),UNIT:e("unit")};n.placeholder=t,n.units=c,n.fieldNames=u,n.timeInterval=o,n.$watch(l,a),n.$watch(r,i)}]}}angular.module("c8y.smartRules").directive("smartRuleParamInputTimeInterval",["gettext","gettextCatalog",e])}(),angular.module("c8y.smartRules").directive("smartRuleParamWarnMaxLength",function(){"use strict";function e(e){e.visible=!1,e.$watch("rule.config[param.property]",function(t){e.exceedsMaxLength=t&&t.length>e.param.warnMaxLength,e.hasPlaceholder=n.test(e.rule.config[e.param.property]),e.visible=e.exceedsMaxLength||e.hasPlaceholder})}var n=/#{.+}/;return{scope:{rule:"=",param:"="},link:e,restrict:"E",templateUrl:"core_smartRules/views/paramWarnMaxLength.html"}}),function(){"use strict";function e(){return{restrict:"E",scope:{parentMo:"&",selectedChildAssets:"&",onSelectionConfirmed:"&",disableSelection:"<"},controller:"c8yChildAssetsSelectorCtrl",controllerAs:"ctrl",templateUrl:"core_smartRules/views/childAssetsSelector.html"}}angular.module("c8y.smartRules").directive("c8yChildAssetsSelector",e)}(),function(){"use strict";function e(e,n,t,r,a,l,i,s,o,c,u,d,p,m,f){function v(){e.$on("smartRulesListReload",g),g()}function g(){return t.when().then(h).then(R).then(x).then(G).then(y).catch(b)}function h(){te.inProgress=!0}function y(){te.inProgress=!1,te.done=!0,te.error=!1}function b(e){e.data&&e.data.message&&o.danger(e.data.message),te.inProgress=!1,te.done=!0,te.error=!0}function R(){return S().then(w)}function S(){return d.list()}function w(e){_.forEach(e,function(e){X[e.name]=e})}function x(){var e=Q.mo?p.listByContext(Q.mo):t.when([]),n=u.hasPermissions().then(function(e){return e?p.list():t.when([])});t.all({listByContext:e,list:n}).then(function(e){Q.rules=I(_.concat(e.listByContext,e.list))})}function I(e){var n=e;return Q.mo&&(n=_.reject(n,C(Q.mo))),Q.filter&&(n=_.filter(n,Q.filter)),n}function C(e){var n=new RegExp(e+"/dashboard");return function(e){var t=_.get(e,"config.url","");return A(e)&&!n.test(t)}}function A(e){return"sendDashboardsViaEmail"===e.ruleTemplateName}function T(e){return!A(e)}function F(e){return e.enabled&&$(e)?p.deactivate(e,Q.mo,!1).then(function(){o.success(f.getString('Rule "{{name}}" deactivated!',e))}):p.activate(e,Q.mo,!1).then(function(){o.success(f.getString('Rule "{{name}}" activated!',e))})}function k(e,n){var r=[];return _.forEach(n,function(n){var t=!_.find(Q.ruleChildren[e.id],{id:n.id});t&&r.push(p.activate(e,n,!1))}),_.forEach(Q.ruleChildren[e.id],function(t){var a=!_.find(n,{id:t.id});a&&r.push(p.deactivate(e,t,!1))}),t.all(r).then(x).then(G).then(function(){o.success(f.getString('Rule "{{name}}" activated/deactivated for children!',e))})}function E(){p.addNewWithUI().then(g)}function D(e){p.editWithUI(e).then(g)}function P(e){p.cloneWithUI(e).then(g)}function q(e){s({title:m("Confirm delete?"),body:f.getString('Do you really want to remove rule "{{name}}" with the id {{id}}?',e),status:"danger"}).then(p.remove.bind(p,e)).then(_.partial(_.pull,Q.rules,e)).then(_.partial(_.unary(o.success),m("Smart Rule successfully removed!")))}function $(e){return p.hasSource(e,Q.mo)}function M(e){var t={activate:{"for group":m("Activate for this group"),"for device":m("Activate for this device"),"for object":m("Activate for this object")},deactivate:{"for group":m("Deactivate for this group"),"for device":m("Deactivate for this device"),"for object":m("Deactivate for this object")}},r=e.enabled&&$(e)?"deactivate":"activate",a=n.deviceId?"device":n.groupId?"group":"object";return t[r]["for "+a]}function N(e){var n,t=X[e.ruleTemplateName];return t&&(n=f.getString(t.label.input)+" "+f.getString(t.label.output)),n}function O(e){var n,t=X[e.ruleTemplateName];return t&&(n=t.paramGroups.input.icon),n}function V(e){var n,t=X[e.ruleTemplateName];return t&&(n=t.paramGroups.output.icon),n}function U(e){return re[e.enabled].text}function j(e){return re[e.enabled].icon}function L(e){return re[e.enabled].cls}function G(){var e=c.getContext();if(null!==e.context)return a.childAssets(e.id).then(function(e){Q.children=e}).then(function(){Q.ruleChildren={},_.forEach(Q.rules,function(e){Q.ruleChildren[e.id]=B(e)})})}function B(e){return _.filter(Q.children,function(n){return e.enabled&&p.hasSource(e,n)})}function W(){var e=ee.canSeeSection;return _.isUndefined(e)&&(ee.canSeeSection=K().then(function(e){return ee.canSeeSection=e,ee.canSeeSection}),e=!1),e}function K(){return r.checkIfModulesExist(["c8y.cockpit.config"])?u.shouldShowLocalSmartRules():t.when(!1)}function z(){var e=ee.canAddRules;if(_.isUndefined(e)){var n;n=Q.context?{adminMOs:[Q.context.id]}:{allRoles:["ROLE_INVENTORY_ADMIN"],anyRole:["ROLE_SMARTRULE_ADMIN","ROLE_CEP_MANAGEMENT_ADMIN"]},ee.canAddRules=i.isAllowed(n).then(function(e){return ee.canAddRules=e,ee.canAddRules}),e=!1}return e}function Y(e){var n=ee.rules=ee.rules||{},t=n[e.id];return _.isUndefined(t)&&(n[e.id]=i.isAllowed({adminMOs:[e.id]}).then(function(t){return n[e.id]=t,n[e.id]}),t=!1),t}function H(){var e=ee.canInspect;return _.isUndefined(e)&&(ee.canInspect=t.all({administrationAccess:J(),eventProcessingAccess:Z(),eventProcessingEnabled:p.eventProcessingEnabled()}).then(function(e){return ee.canInspect=e.administrationAccess&&e.eventProcessingAccess&&e.eventProcessingEnabled,ee.canInspect}),e=!1),e}function J(){return l.listByUser().then(function(e){return!!_.find(e,{contextPath:"administration"})})}function Z(){return i.isAllowed({anyRole:["ROLE_CEP_MANAGEMENT_READ","ROLE_CEP_MANAGEMENT_ADMIN"]})}var Q=this,X={},ee={},ne={},te={done:!1,inProgress:!1},re={true:{text:m("Enabled"),icon:"check-circle",cls:"text-success"},false:{text:m("Disabled"),icon:"ban",cls:"text-warning"}};_.assign(Q,{ruleTemplates:X,loadingStatus:te,isOpen:ne,listClass:"interact-list",$onInit:v,add:E,edit:D,clone:P,remove:q,hasSource:$,getChildrenEnabledForSmartRule:B,toggleRuleActivationForContextMO:F,toggleRuleActivationForChildrenMOs:k,tooltip:M,type:N,status:U,statusIcon:j,statusClass:L,context:c.getContext(),inputIcon:O,outputIcon:V,canAddRules:z,canModify:Y,canInspect:H,canApplyOnChildren:T,canSeeSection:W}),_.assign(e,{refresh:g,paging:{refresh:g}})}e.$inject=["$scope","$routeParams","$q","c8yBase","c8yInventory","c8yApplication","c8yPermissions","c8yModal","c8yAlert","c8yUiUtil","c8ySmartRulesAvailability","smartRuleTemplatesSvc","smartRulesSvc","gettext","gettextCatalog"],angular.module("c8y.smartRules").component("smartRulesList",{bindings:{mo:"<?",filter:"<?"},templateUrl:"core_smartRules/list/smartRulesList.html",controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e){function n(){e.createInstanceWithUIByName(r.ruleTemplateName,r.ruleDefaults).then(t)}function t(e){r.onAdded({rule:e})}var r=this;_.assign(r,{add:n})}e.$inject=["smartRulesSvc"],angular.module("c8y.smartRules").component("addSmartRuleButton",{bindings:{icon:"<?",label:"<?",ruleTemplateName:"<",ruleDefaults:"<",onAdded:"&?"},transclude:!0,templateUrl:"core_smartRules/add/addSmartRuleButton.html",controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e){var n;n='<div ng-transclude>\r\n  <button class="btn btn-link" ng-click="vm.add()">\r\n    <i c8y-icon="{{vm.icon || \'plus-square\'}}"></i>\r\n    <span ng-bind="(vm.label | translate) || (\'New\' | translate)"></span>\r\n  </button>\r\n</div>\r\n',e.put("core_smartRules/add/addSmartRuleButton.html",n),e.put("/apps/core/smartRules/add/addSmartRuleButton.html",n),n='<div>\r\n  <div ng-if="vm.canSeeSection()">\r\n    <div ng-show="vm.loadingStatus.inProgress">\r\n      <c8y-rectangle-spinner message="\'Retrieving Smart Rulesâ€¦\' | translate"></c8y-rectangle-spinner>\r\n    </div>\r\n\r\n    <div ng-show="!vm.loadingStatus.inProgress && vm.loadingStatus.done && vm.loadingStatus.error">\r\n      <div class="alert alert-warning" translate>\r\n        Could not load Smart Rules list.\r\n      </div>\r\n    </div>\r\n\r\n    <div ng-show="!vm.loadingStatus.inProgress && vm.loadingStatus.done && !vm.loadingStatus.error">\r\n      <div class="c8y-empty-state text-center" ng-show="vm.rules.length === 0">\r\n        <h1 class="c8y-icon c8y-icon-smart-rules c8y-icon-duocolor"></h1>\r\n        <h3 translate>No Smart Rules defined.</h3>\r\n        <p c8y-guide-docs><small translate>Find out more on the <a c8y-guide-href="users-guide/cockpit/#rules">User Guide</a>.</small></p>\r\n      </div>\r\n\r\n      <div class="smart-rules-list" ng-show="vm.rules.length > 0">\r\n        <div class="card-group" ng-class="vm.listClass">\r\n          <div class="smart-rules-list-head">\r\n            <label class="smart-rule-group" translate ng-if="vm.context.context === \'group\'">Group</label>\r\n            <label class="smart-rule-group" translate ng-if="vm.context.context === \'device\'">Device</label>\r\n            <label class="smart-rule-group" translate ng-if="vm.context.context !== \'group\' && vm.context.context !== \'device\'">State</label>\r\n            <label class="smart-rule-children" translate ng-if="vm.children.length > 0">Children</label>\r\n            <label class="smart-rule-description" translate>Smart rule</label>\r\n          </div>\r\n\r\n          <div class="col-xs-12 col-sm-6 col-md-4" ng-repeat="rule in vm.rules | orderBy:\'name\'">\r\n            <div class="card-flip-container" ng-class="{\'flipping\': vm.isFlipped}">\r\n              <div class="card-flip smart-rule-list-card" ng-class="{\'flipped\': vm.isFlipped, \'active\': vm.isOpen[rule.id]}">\r\n                <div class="card card-front">\r\n                  <div class="card-actions collapsible" ng-class="{\'expanded\': vm.isOpen[rule.id]}" ng-if="vm.canAddRules() || vm.canModify(rule) || vm.canInspect()">\r\n                    <button class="btn btn-link btn-collapse" title="{{ \'Details\' | translate }}" ng-class="{\'active\': vm.isOpen[rule.id]}" ng-click="vm.isOpen[rule.id] = !vm.isOpen[rule.id]">\r\n                      <i c8y-icon="chevron-down"></i>\r\n                    </button>\r\n                    <div class="btn-group" is-open="ctrl.open" uib-dropdown>\r\n                      <button type="button" class="dropdown-toggle c8y-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" uib-dropdown-toggle>\r\n                        <i c8y-icon="ellipsis-v"></i>\r\n                      </button>\r\n                      <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\r\n                        <li ng-if="vm.canModify(rule)">\r\n                          <a href="" title="{{\'Edit Smart Rule\' | translate}}" ng-click="vm.edit(rule)">\r\n                            <i c8y-icon="pencil"></i> {{\'Edit\' | translate}}\r\n                          </a></li>\r\n                        <li ng-if="vm.canAddRules()">\r\n                          <a href="" title="{{\'Clone Smart Rule\' | translate}}" ng-click="vm.clone(rule)">\r\n                            <i c8y-icon="copy"></i> {{\'Clone\' | translate}}\r\n                          </a>\r\n                        </li>\r\n                        <li ng-if="vm.canModify(rule)">\r\n                          <a href="" title="{{\'Remove Smart Rule\' | translate}}" ng-click="vm.remove(rule)">\r\n                            <i c8y-icon="times"></i> {{\'Remove\' | translate}}\r\n                          </a>\r\n                        </li>\r\n                        <li role="separator" class="divider" ng-if="vm.canInspect()"></li>\r\n                        <li ng-if="vm.canInspect()">\r\n                          <a ng-href="/apps/administration#/eventprocessing/{{rule.cepModuleId}}" title="{{\'Inspect Smart Rule\' | translate}}">\r\n                            <i c8y-icon="c8y-smart-rules c8y-icon-mono"></i> {{\'Inspect\' | translate}}\r\n                          </a>\r\n                        </li>\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class="card-header">\r\n                    <p class="text-center text-muted">\r\n                      <i c8y-icon="c8y-smart-rules"></i>\r\n                      {{\'Smart Rule\' | translate}}\r\n                    </p>\r\n                    <h4 class="smart-rule-name card-title">\r\n                      {{rule.name}}\r\n                    </h4>\r\n                  </div>\r\n                  <div class="card-block">\r\n                    <div class="smart-rule-group smart-rule-group-switch" ng-if="vm.context.context === \'group\' || vm.context.context === \'device\'">\r\n                      <label class="c8y-switch" uib-tooltip="{{vm.tooltip(rule) | translate}}">\r\n                        <input type="checkbox" ng-disabled="!vm.canModify(rule) || vm.ruleTemplates[rule.ruleTemplateName].noTarget" ng-checked="rule.enabled && vm.hasSource(rule)" ng-click="vm.toggleRuleActivationForContextMO(rule)">\r\n                        <span></span>\r\n                      </label>\r\n\r\n                      <button type="button" class="btn c8y-btn-checkbox" ng-class="{\'active\': rule.enabled && vm.hasSource(rule)}" ng-click="vm.toggleRuleActivationForContextMO(rule)">\r\n                        <i class="fa" ng-class="{\'fa-check text-success\': rule.enabled && vm.hasSource(rule), \'fa-ban text-danger\': !rule.enabled || !vm.hasSource(rule)}"></i>\r\n                        <translate ng-if="rule.enabled && vm.hasSource(rule)">Enabled</translate>\r\n                        <translate ng-if="!rule.enabled || !vm.hasSource(rule)">Disabled</translate>\r\n                      </button>\r\n                    </div>\r\n\r\n                    <div class="smart-rule-state" ng-if="vm.context.context !== \'group\' && vm.context.context !== \'device\'">\r\n                      <div class="list-icon">\r\n                        <i c8y-icon="{{vm.statusIcon(rule)}}" uib-tooltip="{{vm.status(rule) | translate}}" ng-class="vm.statusClass(rule)"></i>\r\n                      </div>\r\n                      <div class="card-icon" ng-class="vm.statusClass(rule)">\r\n                        <i c8y-icon="{{vm.statusIcon(rule)}}"></i>\r\n                        <span>{{vm.status(rule) | translate}}</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div class="smart-rule-children" ng-if="vm.children.length > 0">\r\n                      <label translate>Children</label>\r\n                      <c8y-child-assets-selector ng-if="::vm.canApplyOnChildren(rule)" parent-mo="vm.mo" selected-child-assets="vm.ruleChildren[rule.id]" on-selection-confirmed="vm.toggleRuleActivationForChildrenMOs(rule, selection)" disable-selection="!vm.canModify(rule)">\r\n                      </c8y-child-assets-selector>\r\n                    </div>\r\n\r\n                    <div class="smart-list-icon-label">\r\n                      <span class="dot"><i c8y-icon="{{vm.inputIcon(rule)}}"></i></span>\r\n                      <i c8y-icon="arrow-right"></i>\r\n                      <span class="dot"><i c8y-icon="{{vm.outputIcon(rule)}}"></i></span>\r\n                    </div>\r\n\r\n                    <div class="smart-rule-description interact" ng-click="vm.isOpen[rule.id] = !vm.isOpen[rule.id]">\r\n                      <div class="smart-rule-name">\r\n                        {{rule.name}}\r\n                      </div>\r\n                      <small ng-show="vm.type(rule)" class="smart-rule-information text-muted">\r\n                        {{vm.type(rule)}}\r\n                      </small>\r\n                    </div>\r\n                  </div>\r\n                  <div class="card-actions-group">\r\n                    <button class="btn-flip" ng-click="vm.isFlipped = !vm.isFlipped">\r\n                      <i c8y-icon="reply"></i> {{\'Details\' | translate}}\r\n                    </button>\r\n                  </div>\r\n                </div><!-- /.card-front -->\r\n\r\n                <!-- <div uib-collapse="!isOpen[rule.id]"> -->\r\n                <div class="card card-back" uib-collapse="!vm.isOpen[rule.id]">\r\n                  <div class="card-header-actions">\r\n                    <div class="smart-list-icon-label">\r\n                      <span class="dot"><i c8y-icon="{{vm.inputIcon(rule)}}"></i></span>\r\n                      <i c8y-icon="arrow-right"></i>\r\n                      <span class="dot"><i c8y-icon="{{vm.outputIcon(rule)}}"></i></span>\r\n                    </div>\r\n                    <div class="title text-truncate">{{rule.name}}</div>\r\n                  </div>\r\n                  <div class="smart-rule-details card-inner-scroll">\r\n                    <div class="row">\r\n                      <div class="col-sm-3">\r\n                        <div class="legend form-block">{{\'Details\' | translate}}</div>\r\n                        <dl class="dl-inline small text-muted">\r\n                          <dt translate>Creation time</dt>\r\n                          <dd>{{rule.creationTime | absoluteDate}}</dd>\r\n                          <dt translate>Last updated</dt>\r\n                          <dd>{{rule.lastUpdated | absoluteDate}}</dd>\r\n                        </dl>\r\n                      </div>\r\n\r\n                      <div class="col-sm-9">\r\n                        <div class="legend form-block">{{\'History of changes\' | translate}}</div>\r\n                        <div c8y-audit-list filter="{source: rule.id}"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class="card-actions-group">\r\n                    <button type="button" class="btn-flip" ng-click="vm.isFlipped = !vm.isFlipped">\r\n                      <i c8y-icon="reply"></i> {{\'Back\' | translate}}\r\n                    </button>\r\n                  </div>\r\n                </div><!-- /.card-back -->\r\n\r\n              </div>\r\n\r\n            </div>\r\n          </div> <!-- /.col-**-** -->\r\n        </div><!-- /.card-group -->\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n',e.put("core_smartRules/list/smartRulesList.html",n),e.put("/apps/core/smartRules/list/smartRulesList.html",n),n='<div class="modal-header text-center separator">\n  <h3><i class="c8y-icon c8y-icon-smart-rules c8y-icon-duocolor"></i> {{title | translate}}</h3>\n  <h4 class="text-muted" translate>Pick your Smart Rule</h4>\n</div>\n\n<div class="">\n\n  <div class="alert alert-warning" ng-show="ruleTemplates.length == 0" translate>\n    No matching Smart Rules available.\n  </div>\n\n  <div class="card-group-block smart-rule-templates-list interact-grid">\n    <div ng-repeat="ruleTemplate in ruleTemplates" class="col-md-4 col-sm-6 col-xs-12 card" ng-class="{\'not-active\':!ruleTemplate._active, \'interact\': ruleTemplate._active}" ng-click="createInstance(ruleTemplate)">\n           <div class="card-block text-center">\n            <div class="smart-list-icon-label">\n              <span class="dot"><i c8y-icon="{{ruleTemplate.paramGroups.input.icon}}"></i></span>\n              <i c8y-icon="arrow-right"></i>\n              <span class="dot"><i c8y-icon="{{ruleTemplate.paramGroups.output.icon}}"></i></span>\n            </div>\n          <div><span class="caption caption-input">{{ruleTemplate.label.input | translate}}</span>\n          <span class="caption caption-output">{{ruleTemplate.label.output | translate}}</span></div>\n          <small class="text-muted">\n            {{ruleTemplate.description | translate}}\n          </small>\n        </div>\n    </div>\n  </div>\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-default" ng-click="cancel()" translate>Cancel</button>\n</div>\n',e.put("core_smartRules/views/add.html",n),e.put("/apps/core/smartRules/views/add.html",n),n='<div class="c8y-child-assets-selector" is-open="ctrl.dropdownStatus.open" uib-dropdown>\n  <button type="button" class="btn dropdown-toggle c8y-dropdown" title="{{ctrl.getSelectedText()}}" uib-dropdown-toggle>\n    <span class="text-truncate">\n      <i c8y-icon="check" ng-class="{\'text-success\': ctrl.areAllOriginallySelected()}"></i>\n      <span ng-bind="ctrl.getSelectedStatusText()"></span>\n    </span>\n  </button>\n  <ul class="dropdown-menu multiselect-container" ng-click="$event.stopPropagation();" uib-dropdown-menu>\n    <li class="multiselect-item">\n      <div class="input-group input-group-search">\n        <input class="form-control" type="search" placeholder="{{\'Type to filter\' | translate}}&hellip;" ng-model="ctrl.filterCfg.text">\n            <span class="input-group-addon">\n                <i c8y-icon="search" ng-class="{\'fa-spin\': loading}" class="fa fw fa-search"></i>\n            </span>\n          </div>\n\n    </li>\n    <li class="multiselect-item">\n      <label ng-if="!ctrl.areAllVisibleSelected()" class="c8y-checkbox input-sm" ng-click="ctrl.selectAllVisible()">\n        <input type="checkbox" ng-checked="false" ng-click="ctrl.selectAllVisible(); $event.stopPropagation();" style="margin-top:0"><span></span>\n        <span translate>Check all visible</span>\n      </label>\n      <label ng-if="ctrl.areAllVisibleSelected()" class="c8y-checkbox input-sm" ng-click="ctrl.deselectAllVisible()">\n        <input type="checkbox" ng-checked="true" ng-click="ctrl.deselectAllVisible(); $event.stopPropagation();" style="margin-top:0"><span></span>\n        <span translate>Uncheck all visible</span>\n      </label>\n    </li>\n    <li class="divider"></li>\n    <li class="multiselect-item-container">\n      <div ng-if="!(ctrl.dropdownStatus.open && ctrl.dropdownOpeningFinished)" class="text-center" style="padding: 8px">\n        <i c8y-icon="circle-o-notch" class="fa-spin"></i>\n        <translate>Loading</translate>&hellip;\n      </div>\n      <ul class="list-unstyled" ng-if="ctrl.dropdownStatus.open && ctrl.dropdownOpeningFinished">\n        <li ng-repeat="childAsset in ctrl.childAssets | filter:ctrl.filterCfg.text" class="multiselect-item">\n          <label class="c8y-checkbox input-sm text-truncate" ng-click="ctrl.toggle(childAsset); $event.preventDefault()">\n            <input type="checkbox" ng-checked="ctrl.isSelected(childAsset)" ng-click="ctrl.toggle(childAsset); $event.stopPropagation()" style="margin-top:0"><span></span>\n            <span class="label-text" title="{{childAsset.name}}" ng-bind="childAsset.name"></span>\n          </label>\n        </li>\n      </ul>\n    </li>\n    <li class="divider"></li>\n    <li><button class="btn btn-primary btn-block" ng-click="ctrl.apply()" translate>Apply</button></li>\n  </ul>\n</div>\n',e.put("core_smartRules/views/childAssetsSelector.html",n),e.put("/apps/core/smartRules/views/childAssetsSelector.html",n),n='<div class="modal-header text-center separator">\n  <p class="text-muted">{{title | translate}}</p>\n  <div class="smart-list-icon-label">\n    <span class="dot"><i c8y-icon="{{ruleTemplate.paramGroups.input.icon}}"></i></span>\n    <i c8y-icon="arrow-right"></i>\n    <span class="dot"><i c8y-icon="{{ruleTemplate.paramGroups.output.icon}}"></i></span>\n  </div>\n  <h4>{{ruleTemplate.label.input | translate}} {{ruleTemplate.label.output | translate}}</h4>\n  <small translate>Fields marked * are required.</small>\n</div>\n\n<div class="modal-inner-scroll smart-rule-control">\n  <form name="smartRuleForm" class="edit-smart-rule-details" novalidate>\n    <div class="list-group">\n      <div ng-if="ruleTemplate.info" ng-bind-html="ruleTemplate.info | translate" class="alert alert-info">\n      </div>\n\n      <div class="list-group-item">\n        <div class="smart-rule-control text-center">\n          <button type="button" class="btn btn-lg btn-default btn-smart-rule-activation" on ng-model="rule.enabled" uib-btn-checkbox="rule.enabled">\n            <i c8y-icon="minus-circle" class="text-danger" ng-show="!rule.enabled"></i>\n            <i c8y-icon="check-circle" class="text-success" ng-show="rule.enabled"></i>\n            <span ng-show="rule.enabled" translate>Enabled</span>\n            <span ng-show="!rule.enabled" translate>Disabled</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="list-group-item bg-gray-white">\n        <div class="smart-list-icon-label">\n          <span class="dot bg-primary-light">1</span> <strong translate>Rule name</strong>\n        </div>\n        <ng-form name="nestedSmartRuleForm">\n          <div class="form-group smart-rule-control" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n            <textarea id="rulename" rows="1" class="form-control input-name" name="name" ng-model="rule.name" ng-attr-placeholder="{{\'Rule name\' | translate}} *" required></textarea>\n          </div>\n        </ng-form>\n      </div>\n\n      <div class="list-group-item">\n        <div class="smart-list-icon-label">\n          <span class="dot bg-primary-light">2</span> <strong>{{ruleTemplate.paramGroups.input.label | translate}}</strong>\n        </div>\n        <div class="smart-rule-control">\n          <div ng-if="ruleTemplate.paramGroups.input.info" class="text-muted">\n            <i c8y-icon="info-circle" class="text-info pull-left"></i>\n            <p class="left-m"><em ng-bind-html="ruleTemplate.paramGroups.input.info | translate"></em></p>\n          </div>\n          <div ng-repeat="param in ruleTemplate.paramGroups.input.params">\n            <smart-rule-param-input c8y-check-dirty="rule" rule="rule" param="param" rule-template="ruleTemplate"></smart-rule-param-input>\n          </div>\n        </div>\n      </div>\n\n      <div class="list-group-item bg-gray-white">\n        <div class="smart-list-icon-label">\n          <span class="dot bg-primary-light">3</span> <strong>{{ruleTemplate.paramGroups.output.label | translate}}</strong>\n        </div>\n        <div class="smart-rule-control">\n          <div ng-repeat="param in ruleTemplate.paramGroups.output.params">\n            <smart-rule-param-input c8y-check-dirty="rule" rule="rule" param="param" rule-template="ruleTemplate"></smart-rule-param-input>\n          </div>\n          <div ng-if="ruleTemplate.paramGroups.output.info" class="text-muted">\n            <i c8y-icon="info-circle" class="text-info pull-left"></i>\n            <p class="left-m"><em ng-bind-html="ruleTemplate.paramGroups.output.info | translate"></em></p>\n          </div>\n\n        </div>\n      </div>\n\n      <div class="list-group-item" ng-if="!rule.id && !ruleTemplate.noTarget">\n        <div class="smart-list-icon-label">\n          <span class="dot bg-primary-light">4</span> <strong translate>Target asset or devices</strong>\n        </div>\n        <div class="smart-rule-control" ng-if="rule.id && !ruleTemplate.noTarget">\n          <div ng-if="rule.enabledSources">\n            <div translate>\n              Activated for target asset or devices\n            </div>\n            <div ng-repeat="source in enabledSources">\n                <i c8y-icon="check" class="text-success" class="text-muted"></i> {{source.name}}\n            </div>\n          </div>\n          <div class="" ng-if="rule.disabledSources">\n            <div translate>\n              Deactivated for target asset or devices\n            </div>\n            <div ng-repeat="source in disabledSources">\n              <i c8y-icon="minus-circle" uib-tooltip="{{\'Disabled\' | translate}}" class="text-warning"></i> {{source.name}}\n            </div>\n          </div>\n        </div>\n        <div class="smart-rule-control">\n          <div class="form-group">\n            <c8y-device-selector-combo parent="initialActivationCfg.parent" selected-child-device="initialActivationCfg.mo" groups-selectable="true">\n            </c8y-device-selector-combo>\n          </div>\n          <div class="checkbox" ng-show="hasChildAssets(initialActivationCfg.mo)">\n            <label>\n              <input type="checkbox" ng-model="initialActivationCfg.withChildren.assets">\n              <span translate translate-n="getChildAssetsCount(initialActivationCfg.mo)" translate-plural="Activate also for {{$count}} child assets">\n                Activate also for 1 child asset\n              </span>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-default" ng-click="cancel()" translate>Cancel</button>\n  <button class="btn btn-primary" ng-click="save()" ng-disabled="smartRuleForm.$pristine || smartRuleForm.$invalid || savingStatus.inProgress">\n    <span ng-hide="savingStatus.inProgress">\n      <span ng-hide="rule.id" translate>Create</span>\n      <span ng-show="rule.id" translate>Save changes</span>\n    </span>\n    <span ng-show="savingStatus.inProgress">{{\'Saving\' | translate}}&hellip;</span>\n  </button>\n</div>\n',e.put("core_smartRules/views/edit.html",n),e.put("/apps/core/smartRules/views/edit.html",n),n='<div ng-controller="SmartRulesListCtrl as vm">\n  <div ng-if="canSeeSection()">\n\n    <c8y-ui-action-bar-set>\n      <li class="navbar-form hidden-xs" action-bar-position="left" ng-show="rules.length > 0">\n        <c8y-list-display-control list-length="rules.length" on-list-class-change="vm.listClass = listClass">\n        </c8y-list-display-control>\n      </li>\n      <li>\n        <c8y-if-allowed cfg="smartRulesSvc.permissionsCfgs.create">\n          <button class="btn btn-link" ng-click="add()">\n            <i c8y-icon="plus-circle"></i> {{\'Add Smart Rule\' | translate}}\n          </button>\n        </c8y-if-allowed>\n      </li>\n      <li ng-show="getLinkToDM()">\n        <c8y-if-allowed any-app="[\'devicemanagement\']">\n          <a class="btn btn-link" title="{{\'Open in Device management\' | translate}}" target="_blank" ng-href="{{getLinkToDM()}}">\n            <i c8y-icon="external-link"></i> {{\'Device management\' | translate}}\n          </a>\n        </c8y-if-allowed>\n      </li>\n      <li>\n        <c8y-refresh-btn></c8y-refresh-btn>\n      </li>\n    </c8y-ui-action-bar-set>\n\n    <div ng-show="loadingStatus.inProgress">\n      <c8y-rectangle-spinner message="\'Retrieving Smart Rulesâ€¦\' | translate"></c8y-rectangle-spinner>\n    </div>\n\n    <div ng-show="!loadingStatus.inProgress && loadingStatus.done && loadingStatus.error">\n      <div class="alert alert-warning" translate>\n        Could not load Smart Rules list.\n      </div>\n    </div>\n\n    <div ng-show="!loadingStatus.inProgress && loadingStatus.done && !loadingStatus.error">\n\n      <div class="c8y-empty-state text-center" ng-show="rules.length === 0">\n        <h1 class="c8y-icon c8y-icon-smart-rules c8y-icon-duocolor"></h1>\n        <h3 translate>No Smart Rules defined.</h3>\n        <p c8y-guide-docs><small translate>Find out more on the <a c8y-guide-href="users-guide/cockpit/#rules">User Guide</a>.</small></p>\n      </div>\n\n\n      <div class="smart-rules-list" ng-show="rules.length > 0">\n\n        <div class="card-group" ng-class="vm.listClass">\n\n          <div class="smart-rules-list-head">\n            <label class="smart-rule-group" translate ng-if="context.context === \'group\'">Group</label>\n            <label class="smart-rule-group" translate ng-if="context.context === \'device\'">Device</label>\n            <label class="smart-rule-group" translate ng-if="context.context !== \'group\' && context.context !== \'device\'">State</label>\n            <label class="smart-rule-children" translate ng-if="children.length > 0">Children</label>\n            <label class="smart-rule-description" translate>Smart Rule</label>\n          </div>\n\n\n          <div class="col-xs-12 col-sm-6 col-md-4" ng-repeat="rule in rules | orderBy:\'name\'">\n            <div class="card-flip-container" ng-class="{\'flipping\': isFlipped}">\n              <div class="card-flip smart-rule-list-card" ng-class="{\'flipped\': isFlipped, \'active\':isOpen[rule.id]}">\n                <div class="card card-front">\n\n                  <div class="card-actions collapsible" ng-class="{\'expanded\': isOpen[rule.id]}" ng-if="canAddRules() || canModify(rule) || canInspect()">\n                    <button class="btn btn-link btn-collapse" title="{{ \'Details\' | translate }}" ng-class="{\'active\':isOpen[rule.id]}" ng-click="isOpen[rule.id] = !isOpen[rule.id]"><i c8y-icon="chevron-down"></i></button>\n                    <div class="btn-group" is-open="ctrl.open" uib-dropdown dropdown-append-to-body>\n                      <button type="button" class="dropdown-toggle c8y-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" uib-dropdown-toggle>\n                        <i c8y-icon="ellipsis-v"></i>\n                      </button>\n                      <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n                        <li ng-if="canModify(rule)">\n                          <a href="" title="{{\'Edit Smart Rule\' | translate}}" ng-click="edit(rule)">\n                            <i c8y-icon="pencil"></i> {{\'Edit\' | translate}}\n                          </a></li>\n                        <li ng-if="canAddRules(rule)">\n                          <a href="" title="{{\'Clone Smart Rule\' | translate}}" ng-click="clone(rule)">\n                            <i c8y-icon="copy"></i> {{\'Clone\' | translate}}\n                          </a>\n                        </li>\n                        <li ng-if="canModify(rule)">\n                          <a href="" title="{{\'Remove Smart Rule\' | translate}}" ng-click="remove(rule)">\n                            <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                          </a>\n                        </li>\n                        <li role="separator" class="divider" ng-if="canInspect()"></li>\n                        <li ng-if="canInspect()">\n                          <a ng-href="/apps/administration#/eventprocessing/{{rule.cepModuleId}}" title="{{\'Inspect Smart Rule\' | translate}}">\n                            <i c8y-icon="c8y-smart-rules c8y-icon-mono"></i> {{\'Inspect\' | translate}}\n                          </a>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n\n                  <div class="card-header">\n                    <p class="text-center text-muted"><i c8y-icon="c8y-smart-rules"></i> {{\'Smart Rule\' | translate}}</p>\n                    <h4 class="smart-rule-name card-title">\n                      {{rule.name}}\n                    </h4>\n                  </div>\n                  <div class="card-block">\n                    <div class="smart-rule-group smart-rule-group-switch" ng-if="context.context === \'group\' || context.context === \'device\'">\n                      <label class="c8y-switch" uib-tooltip="{{tooltip(rule) | translate}}">\n                        <input type="checkbox" ng-disabled="!canModify(rule) || $scope.ruleTemplates[rule.ruleTemplateName].noTarget" ng-checked="hasSource(rule)" ng-click="toggleRuleActivationForContextMO(rule)">\n                        <span></span>\n                      </label>\n\n                      <button type="button" class="btn c8y-btn-checkbox" ng-class="{\'active\': hasSource(rule)}" ng-click="toggleRuleActivationForContextMO(rule)">\n                        <i class="fa" ng-class="{\'fa-check text-success\': hasSource(rule), \'fa-ban text-danger\': !hasSource(rule)}"></i>\n                        <translate ng-if="hasSource(rule)">Enabled</translate>\n                        <translate ng-if="!hasSource(rule)">Disabled</translate>\n                      </button>\n                    </div>\n\n                    <div class="smart-rule-state" ng-if="context.context !== \'group\' && context.context !== \'device\'">\n                      <div class="list-icon"><i c8y-icon="{{statusIcon(rule)}}" uib-tooltip="{{status(rule) | translate}}" ng-class="statusClass(rule)"></i></div>\n                      <div class="card-icon" ng-class="statusClass(rule)"><i c8y-icon="{{statusIcon(rule)}}"></i> <span>{{status(rule) | translate}}</span></div>\n                    </div>\n\n                    <div class="smart-rule-children" ng-if="children.length > 0">\n                      <label>Children</label>\n                      <!-- <i c8y-icon="circle-o-notch" class="text-primary fa-spin" ng-if="children.length === undefined" ></i> -->\n                      <c8y-child-assets-selector ng-if="::canApplyOnChildren(rule)" parent-mo="moId" selected-child-assets="ruleChildren[rule.id]" on-selection-confirmed="toggleRuleActivationForChildrenMOs(rule, selection)" disable-selection="!canModify(rule)">\n                      </c8y-child-assets-selector>\n                    </div>\n\n                    <div class="smart-list-icon-label">\n                      <span class="dot"><i c8y-icon="{{inputIcon(rule)}}"></i></span>\n                      <i c8y-icon="arrow-right"></i>\n                      <span class="dot"><i c8y-icon="{{outputIcon(rule)}}"></i></span>\n                    </div>\n\n                    <div class="smart-rule-description interact" ng-click="isOpen[rule.id] = !isOpen[rule.id]">\n                      <div class="smart-rule-name">\n                        {{rule.name}}\n                      </div>\n                      <small ng-show="type(rule)" class="smart-rule-information text-muted">\n                        {{type(rule)}}\n                      </small>\n                    </div>\n                  </div>\n                  <div class="card-actions-group">\n                    <button class="btn-flip" ng-click="isFlipped = !isFlipped"><i c8y-icon="reply"></i> {{\'Details\' | translate}}</button>\n                  </div>\n                </div><!-- /.card-front -->\n\n                <!-- <div uib-collapse="!isOpen[rule.id]"> -->\n                <div class="card card-back" uib-collapse="!isOpen[rule.id]">\n                  <div class="card-header-actions">\n                    <div class="smart-list-icon-label">\n                      <span class="dot"><i c8y-icon="{{inputIcon(rule)}}"></i></span>\n                      <i c8y-icon="arrow-right"></i>\n                      <span class="dot"><i c8y-icon="{{outputIcon(rule)}}"></i></span>\n                    </div>\n                      <div class="title text-truncate">{{rule.name}}</div>\n                  </div>\n                  <div class="smart-rule-details card-inner-scroll">\n                    <div class="row">\n                      <div class="col-sm-3">\n                        <div class="legend form-block">{{\'Details\' | translate}}</div>\n                        <dl class="dl-inline small text-muted">\n                          <dt translate>Creation time</dt>\n                          <dd>{{rule.creationTime | absoluteDate}}</dd>\n                          <dt translate>Last updated</dt>\n                          <dd>{{rule.lastUpdated | absoluteDate}}</dd>\n                        </dl>\n                      </div>\n\n                      <div class="col-sm-9" ng-if="isOpen[rule.id]">\n                        <div class="legend form-block">{{\'History of changes\' | translate}}</div>\n                        <div c8y-audit-list filter="{source: rule.id}"></div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div class="card-actions-group">\n                    <button type="button" class="btn-flip" ng-click="isFlipped = !isFlipped"><i c8y-icon="reply"></i> Back</button>\n                  </div>\n                </div><!-- /.card-back -->\n\n              </div>\n\n            </div>\n          </div> <!-- /.col-**-** -->\n        </div><!-- /.card-group -->\n      </div>\n    </div>\n\n  </div>\n</div>\n',
e.put("core_smartRules/views/list.html",n),e.put("/apps/core/smartRules/views/list.html",n),n='<div ng-if="visible">\n  <div ng-if="param.info" class="text-muted bottom-m-sm">\n    <i c8y-icon="info-circle" class="pull-left text-info"></i>\n    <p class="left-m"><em ng-bind-html="param.info | translate"></em></p>\n  </div>\n\n  <div ng-switch="param.type" ng-init="initialValue = currentValueOrTranslatedDefault(rule, param)">\n    <div ng-switch-when="alarmSeverity" ng-init="rule.config[param.property] = currentValueOrDefault(rule, param)">\n      <smart-rule-param-input-alarm-severity rule="rule" param="param"></smart-rule-param-input-alarm-severity>\n    </div>\n    <div ng-switch-when="alarmType" ng-init="rule.config[param.property] = currentValueOrDefault(rule, param)">\n      <smart-rule-param-input-alarm-type rule="rule" param="param"></smart-rule-param-input-alarm-type>\n    </div>\n    <div ng-switch-when="alarmTypeMultiple" ng-init="rule.config[param.property] = currentValueOrDefault(rule, param)">\n      <smart-rule-param-input-alarm-type rule="rule" param="param" multiple="true"></smart-rule-param-input-alarm-type>\n    </div>\n    <div ng-switch-when="textarea" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-textarea rule="rule" param="param"></smart-rule-param-input-textarea>\n    </div>\n    <div ng-switch-when="email" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-email rule="rule" param="param"></smart-rule-param-input-email>\n    </div>\n    <div ng-switch-when="phoneNumber" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-phone-number rule="rule" param="param"></smart-rule-param-input-phone-number>\n    </div>\n    <div ng-switch-when="escalationSteps" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-escalation-steps rule="rule" param="param" rule-template="ruleTemplate"></smart-rule-param-input-escalation-steps>\n    </div>\n    <div ng-switch-when="geofence" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-geofence rule="rule" param="param"></smart-rule-param-input-geofence>\n    </div>\n    <div ng-switch-when="kpi" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-kpi rule="rule" param="param" kpi-id="rule.config[\'kpiId\']" fragment="rule.config[\'fragment\']" series="rule.config[\'series\']"></smart-rule-param-input-kpi>\n    </div>\n    <div ng-switch-when="operation" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-operation rule="rule" param="param"></smart-rule-param-input-operation>\n    </div>\n    <div ng-switch-when="select" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-select rule="rule" param="param"></smart-rule-param-input-select>\n    </div>\n    <div ng-switch-when="timeInterval" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-time-interval rule="rule" param="param"></smart-rule-param-input-time-interval>\n    </div>\n    <div ng-switch-when="checkbox" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-checkbox rule="rule" param="param"></smart-rule-param-input-checkbox>\n    </div>\n    <div ng-switch-when="number" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-number rule="rule" param="param" min="param.minNumber" max="param.maxNumber"></smart-rule-param-input-number>\n    </div>\n    <div ng-switch-when="frequency" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-frequency rule="rule" param="param"></smart-rule-param-frequency>\n    </div>\n    <div ng-switch-when="dashboard" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-dashboard rule="rule" param="param"></smart-rule-param-input-dashboard>\n    </div>\n    <div ng-switch-when="exportConfiguration" ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-export-configuration rule="rule" param="param"></smart-rule-param-input-export-configuration>\n    </div>\n    <div ng-switch-default ng-init="rule.config[param.property] = initialValue">\n      <smart-rule-param-input-default rule="rule" param="param"></smart-rule-param-input-default>\n    </div>\n    <div ng-if="param.warnMaxLength">\n      <smart-rule-param-warn-max-length rule="rule" param="param"/>\n    </div>\n  </div>\n</div>\n',e.put("core_smartRules/views/paramInput.html",n),e.put("/apps/core/smartRules/views/paramInput.html",n),n='<ng-form name="nestedSmartRuleForm">\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n    <ui-select class="form-control" ng-model="rule.config[param.property]" ng-required="param.required" uib-tooltip="{{placeholder(param) | translate}}">\n      <ui-select-match placeholder="{{placeholder(param) | translate}}" ng-bind="$select.selected | translate"></ui-select-match>\n      <ui-select-choices repeat="severity in severities | filterByFields: $select.search:[]:true">\n        <div ng-bind-html="severity | translate | highlight: $select.search"></div>\n      </ui-select-choices>\n    </ui-select>\n  </div>\n</ng-form>\n',e.put("core_smartRules/views/paramInputAlarmSeverity.html",n),e.put("/apps/core/smartRules/views/paramInputAlarmSeverity.html",n),n='<div ng-if="!multiple">\n  <ng-form name="nestedSmartRuleForm">\n    <div class="form-group alarmType" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n      <input type="{{param.type}}" class="form-control span" ng-model="rule.config[param.property]" placeholder="{{placeholder(param) | translate}}" uib-tooltip="{{tooltip(param)}}" ng-required="param.required">\n    </div>\n  </ng-form>\n</div>\n<div ng-if="multiple">\n  <div class="form-group" ng-repeat="alarmType in alarmTypes">\n    <ng-form name="nestedSmartRuleForm">\n      <div class="input-group" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n        <input type="{{param.type}}" class="form-control" ng-model="alarmType.name" placeholder="{{placeholder(param) | translate}}" uib-tooltip="{{tooltip(param)}}" ng-required="param.required">\n        <span class="input-group-btn">\n          <button type="button" class="btn btn-link" uib-tooltip="{{\'Remove\' | translate}}" ng-click="remove(alarmType)" ng-disabled="alarmTypes.length <= 1">\n            <i c8y-icon="minus-circle" class="text-danger"></i>\n          </button>\n        </span>\n      </div>\n    </ng-form>\n  </div>\n  <button type="button" class="btn-add-block" ng-click="add()">\n    <i c8y-icon="plus-circle"></i> <translate>Add alarm type</translate>\n  </button>\n</div>\n',e.put("core_smartRules/views/paramInputAlarmType.html",n),e.put("/apps/core/smartRules/views/paramInputAlarmType.html",n),n='<ng-form name="nestedSmartRuleForm">\n  <div class="form-group" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n    <div class="checkbox">\n      <label>\n        <input type="checkbox" ng-model="rule.config[param.property]" ng-required="param.required">\n        {{placeholder(param)}}\n      </label>\n    </div>\n  </div>\n</ng-form>\n\n\n\n',e.put("core_smartRules/views/paramInputCheckbox.html",n),e.put("/apps/core/smartRules/views/paramInputCheckbox.html",n),n='<div class="cron-wrap form-horizontal">\r\n  <div class="form-group smart-cron-job-every">\r\n    <label class="col-sm-3 control-label">{{ param.label | translate }}: </label>\r\n    <div class="col-sm-9">\r\n      <a ng-href="{{rule.config[param.property]}}" class="btn btn-link">\r\n        <i c8y-icon="{{rule.config.dashboard.icon}}"></i> {{rule.config.dashboard.name}}\r\n      </a>\r\n    </div>\r\n  </div>\r\n</div>\r\n',e.put("core_smartRules/views/paramInputDashboard.html",n),e.put("/apps/core/smartRules/views/paramInputDashboard.html",n),n='<ng-form name="nestedSmartRuleForm">\r\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\r\n    <input type="{{param.type}}" class="form-control span" ng-model="rule.config[param.property]" placeholder="{{placeholder(param)}}" uib-tooltip="{{placeholder(param)}}" ng-required="param.required"/>\r\n  </div>\r\n</ng-form>\r\n',e.put("core_smartRules/views/paramInputDefault.html",n),e.put("/apps/core/smartRules/views/paramInputDefault.html",n),n='<ng-form name="nestedSmartRuleForm">\r\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\r\n    <input type="text" multiple="multiple" class="form-control span" ng-model="rule.config[param.property]" placeholder="{{placeholder(param)}}" uib-tooltip="{{placeholder(param)}}" ng-required="param.required" ng-pattern="emailsPattern"/>\r\n  </div>\r\n</ng-form>\r\n',e.put("core_smartRules/views/paramInputEmail.html",n),e.put("/apps/core/smartRules/views/paramInputEmail.html",n),n='<div>\n  <div class="text-muted" ng-show="steps.length === 0" translate>\n    No escalation steps defined.\n  </div>\n  <table class="table" ng-show="steps.length > 0">\n    <tr ng-repeat-start="step in steps">\n      <td class="text-center" style="width: 35px">\n        {{getStepNo(step) + 1}}.\n      </td>\n      <td class="text-center" style="width: 35px">\n        <i c8y-icon="{{icon(step)}}" uib-tooltip="{{step.type.label | translate}}"></i>\n      </td>\n      <td style="max-width: 220px; text-overflow: ellipsis; overflow: hidden" title="{{step.config.to}}">\n        {{step.config.to}}\n      </td>\n      <td class="text-right">\n        {{executionConditionLabel(step.executionCondition) | translate}}\n      </td>\n      <td style="width: 70px" class="text-right">\n        <div class="btn-group">\n          <button class="btn btn-link btn-xs" uib-tooltip="{{getStepTooltip(step) | translate}}" ng-click="toggleExpand(step)">\n            <i c8y-icon="caret-{{step.expanded ? \'up\' : \'down\'}}"></i>\n          </button>\n          <button class="btn btn-link btn-xs" uib-tooltip="{{\'Remove\' | translate}}" ng-click="removeStep(step)" ng-disabled="!canRemoveStep(step)">\n            <i c8y-icon="close" class="text-danger"></i>\n          </button>\n        </div>\n      </td>\n    </tr>\n    <tr ng-repeat-end ng-if="step.expanded">\n      <td colspan="5">\n        <div class="row">\n          <div class="col-lg-12">\n            <div class="text-info">\n              <div ng-show="!canChangeStepType(step)">\n                  <i c8y-icon="info-circle"></i> <translate>Can\'t change type if other step depends on this one.</translate>\n              </div>\n              <div ng-show="!canChangeExecutionCondition(step)">\n                  <i c8y-icon="info-circle"></i> <translate>At least one step needs to be executed always.</translate>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="row">\n          <div class="col-lg-3">\n            <ng-form name="nestedSmartRuleForm">\n              <div class="form-group" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n                <ui-select ng-model="step.type" ng-disabled="!canChangeStepType(step)">\n                  <ui-select-match>\n                    <i c8y-icon="{{$select.selected.icon}}" uib-tooltip="{{$select.selected.type | translate}}"></i>\n                  </ui-select-match>\n                  <ui-select-choices repeat="stepType as stepType in stepTypes" ui-disable-choice="stepType._active != true">\n                    <div>\n                      <i c8y-icon="{{stepType.icon}}"></i> {{stepType.label | translate}}\n                    </div>\n                  </ui-select-choices>\n                </ui-select>\n              </div>\n            </ng-form>\n          </div>\n          <div class="col-lg-9">\n            <ng-form name="nestedSmartRuleForm">\n              <div class="form-group" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n                <ui-select ng-model="step.executionCondition" ng-disabled="!canChangeExecutionCondition(step)">\n                  <ui-select-match>\n                    {{executionConditionLabel($select.selected) | translate}}\n                  </ui-select-match>\n                  <ui-select-choices repeat="executionCondition in executionConditions | filter:executionConditionsFilter(step)">\n                    {{executionConditionLabel(executionCondition) | translate}}\n                  </ui-select-choices>\n                </ui-select>\n              </div>\n            </ng-form>\n          </div>\n        </div>\n        <div class="row">\n          <div class="col-lg-12">\n            <div ng-repeat="stepParam in step.type.params">\n              <smart-rule-param-input rule="step" param="stepParam"></smart-rule-param-input>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n  <button class="btn btn-link" ng-click="addStep()">\n    <i c8y-icon="plus"></i> <translate>Add step</translate>\n  </button>\n</div>\n',e.put("core_smartRules/views/paramInputEscalationSteps.html",n),e.put("/apps/core/smartRules/views/paramInputEscalationSteps.html",n),n='<div class="cron-wrap form-horizontal">\r\n  <div class="form-group smart-cron-job-every">\r\n    <label class="col-sm-3 control-label">{{ param.label | translate }}: </label>\r\n    <div class="col-sm-9">\r\n      <a ng-href="/apps/cockpit/#/export/{{rule.config[param.property]}}" class="btn btn-link">\r\n        <i c8y-icon="file-text-o"></i> {{rule.config.exportConfiguration.name}}\r\n      </a>\r\n    </div>\r\n  </div>\r\n</div>\r\n',e.put("core_smartRules/views/paramInputExportConfiguration.html",n),e.put("/apps/core/smartRules/views/paramInputExportConfiguration.html",n),n='<div class="cron-wrap form-horizontal" ng-form="nestedSmartRuleForm">\n  <div class="form-group smart-cron-job-every">\n    <label for="smart-cron-job-every" class="col-sm-3 control-label">{{ \'Every\' | translate }}</label>\n    <div class="col-sm-9">\n      <div class="c8y-select-wrapper">\n        <select id="smart-cron-job-every" class="cron-select form-control" ng-model="myFrequency.base" ng-required="true" ng-options="item.value as (item.label | translate) for item in frequency | smartRuleParamFrequency">\n        </select>\n        <span></span>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group smart-cron-job-on" ng-show="myFrequency.base == 4">\n    <label for="smart-cron-job-on" class="col-sm-3 control-label">{{ \'on\' | translate }}</label>\n    <div class="col-sm-9">\n      <div class="c8y-select-wrapper">\n        <select id="smart-cron-job-on" class="cron-select form-control day-value" ng-model="myFrequency.dayValue" ng-options="(value | smartRuleParamFrequencyDayNameToDate | date: \'EEEE\' ) for value in dayValue">\n        </select>\n        <span></span>\n    </div>\n    </div>\n  </div>\n\n  <div class="form-group smart-cron-job-on-the" ng-show="myFrequency.base >= 5">\n    <label for="smart-cron-job-on-the" class="col-sm-3 control-label">{{ \'on the\' | translate }}</label>\n    <div class="col-sm-9">\n      <div class="c8y-select-wrapper">\n        <select id="smart-cron-job-on-the" class="cron-select form-control day-of-month-value" ng-model="myFrequency.dayOfMonthValue" ng-options="value for value in dayOfMonthValue">\n        </select>\n        <span></span>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group smart-cron-job-of" ng-show="myFrequency.base  == 6">\n    <label for="smart-cron-job-of" class="col-sm-3 control-label">{{ \'of\' | translate }}</label>\n    <div class="col-sm-9">\n      <div class="c8y-select-wrapper">\n        <select id="smart-cron-job-of" class="cron-select form-control month-value" ng-model="myFrequency.monthValue" ng-options="(value | smartRuleParamFrequencyMonthNameToDate | date: \'MMMM\') for value in monthValue">\n        </select>\n        <span></span>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group smart-cron-job-at" ng-show="myFrequency.base >= 2">\n    <label for="smart-cron-job-at-hour" class="col-sm-3 control-label">{{ \'at\' | translate }}</label>\n    <div class="col-sm-9">\n      <div class="form-inline">\n        <div class="c8y-select-wrapper">\n          <select id="smart-cron-job-at-hour" class="cron-select form-control hour-value" ng-show="myFrequency.base >= 3" ng-model="myFrequency.hourValue" ng-options="value for value in hourValue">\n          </select>\n          <span></span>\n        </div>\n        <span ng-show="myFrequency.base >= 3"> : </span>\n        <div class="c8y-select-wrapper">\n          <select id="smart-cron-job-at-minute" class="cron-select form-control minute-value" ng-model="myFrequency.minuteValue" ng-options="(value | smartRuleParamFrequencyMinuteValueToDate | date: \'mm\') for value in minuteValue">\n          </select>\n          <span></span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n',e.put("core_smartRules/views/paramInputFrequency.html",n),e.put("/apps/core/smartRules/views/paramInputFrequency.html",n),n='<div>\n  <leaflet bounds="map.bounds" center="map.center" paths="map.paths" width="100%" height="260" defaults="{zoomControl:false, scrollWheelZoom:false}"></leaflet>\n  <button class="btn btn-default btn-block property-{{param.property}}" style="position:relative; z-index: 1001" title="{{\'Edit geofence\' | translate}}" ng-click="editGeofence()">\n    <i c8y-icon="pencil"></i> <translate>Edit geofence</translate>\n  </button>\n</div>\n',e.put("core_smartRules/views/paramInputGeofence.html",n),e.put("/apps/core/smartRules/views/paramInputGeofence.html",n),n='<div>\r\n  <div class="input-group">\r\n    <select class="form-control" ng-options="kpi.id as nameKpi(kpi) for kpi in kpisFiltered = (kpis | filter:filterMatchingKpis)" ng-model="kpiId" ng-change="changedKpiSelection()" ng-required="param.required">\r\n    </select>\r\n    <span class="input-group-btn">\r\n      <button class="btn btn-primary" type="button" ng-click="chooseKpi()" uib-tooltip="{{\'Choose data point from library\' | translate}}">\r\n        <i c8y-icon="search"></i>\r\n      </button>\r\n    </span>\r\n  </div>\r\n  <p class="alert alert-warning" ng-show="kpisFiltered.length === 0" translate>\r\n    No matching data points found in library. First enter red/yellow ranges and save it with "Save to Library".\r\n  </p>\r\n</div>\r\n',e.put("core_smartRules/views/paramInputKpi.html",n),e.put("/apps/core/smartRules/views/paramInputKpi.html",n),n='<ng-form name="nestedSmartRuleForm">\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n    <input type="number" class="form-control span" min="{{min}}" max="{{max}}" ng-model="rule.config[param.property]" placeholder="{{placeholder(param)}}" uib-tooltip="{{placeholder(param)}}" ng-required="param.required"/>\n    <small class="text-muted" ng-if="isDefined(param.default)">{{\'Default\' | translate}}: {{param.default}}</small>\n    <small class="text-muted" ng-if="isDefined(min)">, {{\'min\' | translate}}: {{min}}</small>\n    <small class="text-muted" ng-if="isDefined(max)">, {{\'max\' | translate}}: {{max}}</small>\n  </div>\n</ng-form>\n\n\n',e.put("core_smartRules/views/paramInputNumber.html",n),e.put("/apps/core/smartRules/views/paramInputNumber.html",n),n='<ng-form name="nestedSmartRuleForm">\n  <div class="form-group col-lg-12" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\n    <textarea c8y-code-editor="json" class="form-control" name="operation" ng-model="operation.json" ng-attr-placeholder="{&quot;c8y_Reset&quot;: {}}" uib-tooltip="{{placeholder(param)}}" ng-required="param.required" style="height: 250px"></textarea>\n  </div>\n  <div class="clearfix">\n    <div class="input-group">\n      <select class="form-control" ng-options="operationExample as (operationExample.description | translate) for operationExample in operationExamples" ng-model="operation.example"></select>\n      <span class="input-group-btn">\n        <button class="btn btn-primary" type="button" ng-click="chooseOperationExample(operation.example)" uib-tooltip="{{\'Use this operation\' | translate}}">\n          <i c8y-icon="share"></i>\n        </button>\n      </span>\n    </div>\n  </div>\n</ng-form>\n',e.put("core_smartRules/views/paramInputOperation.html",n),e.put("/apps/core/smartRules/views/paramInputOperation.html",n),n='<ng-form name="nestedSmartRuleForm">\r\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\r\n    <input type="text" class="form-control" ng-model="rule.config[param.property]" ng-maxlength="254" ng-required="param.required" uib-tooltip="{{placeholder(param)}}" placeholder="{{placeholder(param)}}" c8y-phone-number>\r\n  </div>\r\n</ng-form>',e.put("core_smartRules/views/paramInputPhoneNumber.html",n),e.put("/apps/core/smartRules/views/paramInputPhoneNumber.html",n),n='<ng-form name="nestedSmartRuleForm">\r\n  <div class="form-group property-{{param.property}}" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\r\n    <ui-select ng-model="rule.config[param.property]" ng-required="param.required">\r\n      <ui-select-match placeholder="{{placeholder(param)}}">\r\n        <div ng-bind="$select.selected.label | translate"></div>\r\n      </ui-select-match>\r\n      <ui-select-choices repeat="option.value as option in param.options | filter: $select.search">\r\n        <div ng-bind-html="option.label | translate | highlight: $select.search"></div>\r\n      </ui-select-choices>\r\n    </ui-select>\r\n  </div>\r\n</ng-form>\r\n',e.put("core_smartRules/views/paramInputSelect.html",n),e.put("/apps/core/smartRules/views/paramInputSelect.html",n),n='<ng-form name="nestedSmartRuleForm">\r\n  <div class="form-group" ng-class="{\'has-error\': nestedSmartRuleForm.$dirty && nestedSmartRuleForm.$invalid}">\r\n    <textarea class="form-control" ng-model="rule.config[param.property]" ng-attr-placeholder="{{placeholder(param)}}" uib-tooltip="{{placeholder(param)}}" ng-required="param.required"></textarea>\r\n  </div>\r\n</ng-form>\r\n',e.put("core_smartRules/views/paramInputTextarea.html",n),e.put("/apps/core/smartRules/views/paramInputTextarea.html",n),n='<div class="row">\n  <ng-form name="nestedSmartRuleForm1">\n    <div class="form-group col-lg-6" ng-class="{\'has-error\': nestedSmartRuleForm1.$dirty && nestedSmartRuleForm1.$invalid}">\n      <input name="amount" type="number" class="form-control" ng-model="timeInterval.amount" min="1" ng-required="param.required" placeholder="{{placeholder(param, fieldNames.AMOUNT)}}" uib-tooltip="{{placeholder(param, fieldNames.AMOUNT)}}">\n    </div>\n  </ng-form>\n  <ng-form name="nestedSmartRuleForm2">\n    <div class="form-group col-lg-6" ng-class="{\'has-error\': nestedSmartRuleForm2.$dirty && nestedSmartRuleForm2.$invalid}">\n      <select name="unit" class="form-control" ng-options="unit as (unit.label | translate) for unit in units | filter: {dontDisplay: false}" ng-model="timeInterval.unit" ng-required="param.required" placeholder="{{placeholder(param, fieldNames.UNIT)}}" uib-tooltip="{{placeholder(param, fieldNames.UNIT)}}"></select>\n    </div>\n  </ng-form>\n</div>\n',e.put("core_smartRules/views/paramInputTimeInterval.html",n),e.put("/apps/core/smartRules/views/paramInputTimeInterval.html",n),n='<div ng-show="visible" class="text-danger">\r\n  <span>\r\n    <i c8y-icon="exclamation"></i>\r\n    <span translate>This parameter has a max length of {{param.warnMaxLength}}.</span>\r\n  </span>\r\n  <span ng-show="hasPlaceholder">\r\n    <span translate>Use placeholders carefully.</span>\r\n  </span>\r\n</div>\r\n',e.put("core_smartRules/views/paramWarnMaxLength.html",n),e.put("/apps/core/smartRules/views/paramWarnMaxLength.html",n)}angular.module("c8y.smartRules").run(["$templateCache",e])}();