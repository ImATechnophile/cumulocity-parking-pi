/* devicemanagement_vendMeDeviceControl 8.21.0 2018-01-30T22:08:30+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("c8y.parts.vendMeDeviceControl",[]).config(["c8yViewsProvider","gettext",function(e,n){var t=["$scope","$routeParams","c8yBase","c8yDevices",function(e,n,t,a){e.device={},a.detail(n.deviceId).then(t.getResData).then(function(n){e.device=n})}];e.when("/device/:deviceId",{templateUrl:"devicemanagement_vendMeDeviceControl/views/index.html",icon:"coffee",name:n("Vendme"),controller:t,showIf:["$routeParams","c8yDevices",function(e,n){var t=e.deviceId;return n.detailCached(t).then(function(e){var t=e.data;return t&&n.isVendme(t)})}]})}]),angular.module("c8y.parts.vendMeDeviceControl").controller("vendMeDeviceControlCtrl",["$scope","c8yDeviceControl","c8yDevices","c8yModal","c8yInventory","c8yAlert","gettext",function(e,n,t,a,o,i,c){"use strict";function l(){e.$emit("message",{type:"success",text:c("Operation created")}),e.$emit("update","devicecontrol")}function r(e){if(_.isObjectLike(e)&&_.keys(e).length>0){var n=e.com_nsn_startups_vendme_fragments_MachineTechnicalInformation;if(n&&(s(n),n.protocolInfo)){var t=n.protocolInfo.id,a=n.protocolInfo.configuration;t&&m(t),a&&b(a)}}}function s(n){n.maxCredit&&(e.credit=n.maxCredit),n.useResetCounters&&(e.useResetCounters=n.useResetCounters),e.coinChanger="DISABLED"!==n.coinChanger,e.billValidator="DISABLED"!==n.bill_validator,e.cashless2="DISABLED"!==n.cashless2,e.cashless1="DISABLED"!==n.cashless1}function d(e,n){e.com_nsn_startups_vendme_fragments_MachineTechnicalInformation.useResetCounters=n}function v(e,n,t){e.com_nsn_startups_vendme_fragments_MachineTechnicalInformation[n]=t?null:"DISABLED"}function u(){o.update({id:e.device.id,com_nsn_startups_vendme_fragments_MachineTechnicalInformation:e.device.com_nsn_startups_vendme_fragments_MachineTechnicalInformation}).then(_.partial(i.success,"Vending machine updated!"))}function p(){var n=e.bitmask.filter(function(e){return e.selected}).reduce(function(e,n){return e|parseInt(n.val,16)},0).toString(16);return n}function m(e){k.forEach(function(n){var t=new RegExp(n.val);n.active=t.test(e)})}function g(){return k.filter(function(e){return e.active}).map(function(e){return e.val}).join("")}function b(e){if(e){var n=parseInt(e,16);isNaN(e)||S.forEach(function(t){var a=parseInt(t.val,16);t.selected=(a|e)===n})}}function h(){var n=e.device;return n&&(t.supportsOperation(n,"v4e_Protocol")||t.supportsOperation(n,"v4e_SetMaxCredit"))}function D(){var n=e.proto={};k.forEach(function(e){n[e.code]=e})}function f(e){var n=g();return!e.require||!(!n||!n.match(e.require))}function x(){S.forEach(function(e){e.selected=e.selected&&f(e)})}function C(){var t={deviceId:e.device.id,v4e_Log:{},description:c("Request device Log")};n.create(t).then(l,_.noop)}function M(t){var a=Math.round(100*t),o={deviceId:e.device.id,v4e_SetMaxCredit:{value:a},description:c("Set max credit to ")+a+c("cents")};n.create(o).then(l,_.noop)}function E(){var t={deviceId:e.device.id,v4e_Protocol:{val:g(),bitmask:"0x"+p()},description:c("Set protocol")};n.create(t).then(l,_.noop)}function y(n){n&&a({title:c("Confirm Free vend mode?"),body:c("This setting will enable all the products to be retrieved without payment. Are you sure you want to activate Free vend?")}).then(null,function(){e.proto.FREE.active=!1})}var k=[{text:c("Executive"),code:"EXE",bitmask:"0x0001",val:"a"},{text:c("MDB"),code:"MDB",bitmask:"0x0002",val:"m"},{text:c("Free vend"),code:"FREE",bitmask:"0x0008",val:"f"},{text:c("DDCMP on RS232 #1"),code:"DDCMP1",bitmask:"0x0004",val:"d"},{text:c("DEX on RS232 #1"),code:"DEX1",bitmask:"0x0010",val:"x"},{text:c("DDCMP on RS232 #2"),code:"DDCMP2",bitmask:"0x0100",val:"D"},{text:c("DEX on RS232 #2"),code:"DEX2",bitmask:"0x0200",val:"X"}],S=[{text:c("Operate as MDB Communications Gateway"),code:"MDB_COMMGW",val:"0x00000001",require:"m"},{text:c("VMC supports undefined credit"),code:"MDB_UNCREDIT",val:"0x00000002",require:"m"},{text:c("Force not to use display"),code:"MDB_NODISPLAY",val:"0x00000004",require:"m"},{text:c("Use FTL File Id 2 (default 1)"),code:"MDB_2FTL",val:"0x00000008",require:"m"},{text:c("Disable MDB sniffer mode"),code:"MDB_NOSNIFFER",val:"0x00000010",require:"m"},{text:c("Sielaff OLM2 variant of Communications Gateway"),code:"MDB_CGWOLM",val:"0x00000020",require:"m"},{text:c("Sielaff CGW variant of Communications Gateway"),code:"MDB_CGWSIE",val:"0x00000040",require:"m"},{text:c("Remote cashless"),code:"REMOTECL",val:"0x00000080",require:"m"},{text:c("Use DDCMP list #2, RS232 #2"),code:"DDCMP_2LIST2",val:"0x00000400",require:"D"},{text:c("Use enhanced DDCMP @ 2400 on RS232 #2"),code:"DDCMP_ENHANCED2",val:"0x00000800",require:"D"},{text:c("Use DDCMP list 2 on RS232 #1"),code:"DDCMP_2LIST1",val:"0x00004000",require:"d"},{text:c("Use enhanced DDCMP @ 2400 on RS232 #1"),code:"DDCMP_ENHANCED1",val:"0x00008000",require:"d"}];e.$watch("device",r),e.$watch(g,x),e.visible=h,e.bitmask=S,e.setProtocol=E,e.updateDevice=u,e.setCredit=M,e.getDeviceLog=C,e.showOption=f,e.confirmFreeVend=y,e.setVendingMachineSettings=v,e.setUseResetCounters=d,D()}]),function(){"use strict";function e(e){var n;n='<div data-ng-controller="vendMeDeviceControlCtrl" class="col-lg-6">\n  <form>\n    <!-- <div class="form-group">\n      <label>Protocol</label>\n      <select class="form-control"\n        data-ng-model="sProtocol"\n        data-ng-change="updateOptions()"\n        data-ng-options="protocol.text for protocol in protocols">\n      </select>\n    </div> -->\n\n    <div class="form-group">\n      <label translate>Protocol</label>\n\n      <div class="input-group">\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.EXE.active" ng-change="proto.MDB.active && (proto.MDB.active=!proto.EXE.active)">\n          {{proto.EXE.text}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.MDB.active" ng-change="proto.EXE.active && (proto.EXE.active=!proto.MDB.active)">\n          {{proto.MDB.text}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.FREE.active" ng-disabled="proto.EXE.active" ng-change="confirmFreeVend(proto.FREE.active)">\n          {{proto.FREE.text}}\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label translate>Serial #1</label>\n\n      <div class="input-group">\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.DDCMP1.active" ng-change="proto.DDCMP1.active && (proto.DEX1.active=!proto.DDCMP1.active)">\n          {{proto.DDCMP1.text}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.DEX1.active" ng-change="proto.DEX1.active && (proto.DDCMP1.active=!proto.DEX1.active)">\n          {{proto.DEX1.text}}\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label translate>Serial #2</label>\n\n      <div class="input-group">\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.DDCMP2.active" ng-change="proto.DDCMP2.active && (proto.DEX2.active=!proto.DDCMP2.active)">\n          {{proto.DDCMP2.text}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="proto.DEX2.active" ng-change="proto.DEX2.active && (proto.DDCMP2.active=!proto.DEX2.active)">\n          {{proto.DEX2.text}}\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label translate>Options</label>\n\n      <div class="checkbox" data-ng-repeat="bit in bitmask">\n        <label>\n          <input type="checkbox" data-ng-model="bit.selected" data-ng-disabled="!showOption(bit)">\n          {{bit.text}} <i class="icon-ok statusOk" data-ng-show="showOption(bit)"></i>\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <button type="button" class="btn btn-primary" data-ng-click="setProtocol()" translate>Update protocol configuration</button>\n    </div>\n\n    <div class="form-group">\n      <label translate>Vending Machine Settings</label>\n\n      <div class="input-group">\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="coinChanger" data-ng-change="setVendingMachineSettings(device, \'coinChanger\', coinChanger)">\n          {{\'Coin changer\' | translate}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="billValidator" data-ng-change="setVendingMachineSettings(device, \'bill_validator\', billValidator)">\n          {{\'Bill validator\' | translate}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="cashless1" data-ng-change="setVendingMachineSettings(device, \'cashless1\', cashless1)">\n          {{\'Cashless 1\' | translate}}\n        </label>\n\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="cashless2" data-ng-change="setVendingMachineSettings(device, \'cashless2\', cashless2)">\n          {{\'Cashless 2\' | translate}}\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label translate>Sales Configuration</label>\n\n      <div class="input-group">\n        <label class="checkbox-inline">\n          <input type="checkbox" ng-model="useResetCounters" data-ng-change="setUseResetCounters(device, useResetCounters)">\n          {{\'Use Reset Counters\' | translate}}\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <button type="button" class="btn btn-primary" data-ng-click="updateDevice()" translate>Update vending machine</button>\n    </div>\n\n    <div class="form-group">\n      <label translate>Maximum Credit</label>\n      <div class="input-group">\n        <input type="text" data-ng-model="credit" class="form-control text-right" step="0.01">\n        <span class="input-group-addon">&euro;</span>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <button type="button" class="btn btn-primary" data-ng-click="setCredit(credit)" translate>Update Maximum Credit</button>\n    </div>\n\n    <div class="form-group">\n      <label translate>Request device log</label>\n      <div class="form-control-static">\n        <button type="button" class="btn btn-primary" data-ng-click="getDeviceLog()" translate>Request device log</button>\n      </div>\n      <small style="display:block; margin-top:5px" translate>\n        Device related log information will be shown under "<b>Events</b>".\n      </small>\n    </div>\n\n\n  </form>\n</div>\n',e.put("devicemanagement_vendMeDeviceControl/views/index.html",n),e.put("/apps/devicemanagement/vendMeDeviceControl/views/index.html",n)}angular.module("c8y.parts.vendMeDeviceControl").run(["$templateCache",e])}();