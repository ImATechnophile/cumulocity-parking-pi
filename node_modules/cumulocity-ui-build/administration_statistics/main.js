/* administration_statistics 8.21.0 2018-01-30T22:07:40+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("c8y.parts.statistics",[]).config(["c8yNavigatorProvider","c8yViewsProvider",function(t,s){"use strict";s.when("/statistics",{templateUrl:"administration_statistics/views/index.html"})}]),function(){"use strict";function t(t,s,i,n,e,o,a,r){function l(){return!!v}function c(t,s){var i=r.getString("Usage between {{start}} - {{end}}",t);return l()&&"thisMonth"===s&&(i+="\n"+r.getString(v)),i}function u(t){return r.getString("Amount of data in use on {{end}}",t)}function m(t){return r.getString("Number of root devices on {{end}}. Does not include child devices.",t)}function d(t){return r.getString("Number of devices on {{end}}, including child devices.",t)}function h(){var t=i.monthFilter({},1);return t.dateFrom=moment(t.dateFrom).subtract(1,"month").endOf("month").format(i.dateFormat),t}function p(){var t=i.monthFilter();return delete t.dateTo,t}this.APP_IGNORE=["devicemanagement","administration","vendme_plugins","core","c8ydata","tenantadmin","platformadmin"];var g={requestCount:a("calculating number of API requests"),deviceRequestCount:a("calculating number of device API requests"),storageSize:a("calculating storage"),devicesCount:a("calculating number of devices"),usersCount:a("calculating number of users"),deviceWithChildrenCount:a("calculating number of devices")},v=n.administration.statistics.thisMonthExtraTooltip;this.summary={thisMonth:_.clone(g),lastMonth:_.clone(g)},this.tooltips=function(t,s){return{month:_.partial(c,t,s),storageSize:_.partial(u,t),rootDevicesCount:_.partial(m,t),devicesCount:_.partial(d,t)}},this.fetch=function(){var t=h(),s=p();this.formatMonth("thisMonth",s),this.formatMonth("lastMonth",t),this.fetchStatistics("thisMonth",s).then(_.bind(this.fetchUsersCount,this)),this.fetchStatistics("lastMonth",t),this.fetchSubscribedApps()},this.formatMonth=function(t,s){this[t]={},s.dateFrom?this[t].start=moment(s.dateFrom).format("ll"):this[t].start="?",s.dateTo?this[t].end=moment(s.dateTo).format("ll"):this[t].end=moment().format("ll"),this.assignTooltips(this[t],t)},this.assignTooltips=function(t,s){t.tooltips=this.tooltips(t,s)},this.fixFilter=function(t){return t=_.clone(t),t.dateTill=t.dateTo,delete t.dateTo,t},this.fetchStatistics=function(s,i){return t.getSummary(this.fixFilter(i)).then(_.bind(this.setStatistics,this,s))},this.fetchSubscribedApps=function(){e.list().then(_.bind(this.setApps,this))},this.setStatistics=function(t,s){var i=r.getString("<Not calculated>"),n=s.data;if(n.rootDevicesCount=n.deviceCount,n.devicesCount=n.deviceWithChildrenCount,Number(n.storageSize)<0?n.storageSize=i:n.storageSize=o("bytes")(n.storageSize),n.storageLimitPerDevice){var e=Math.max(n.devicesCount,1);n.storageLimit=o("bytes")(n.storageLimitPerDevice*e)}Number(n.rootDevicesCount)<0&&(n.rootDevicesCount=i),Number(n.devicesCount)<0&&(n.devicesCount=i),this.summary[t]={requestCount:_.isNumber(n.requestCount)?r.getPlural(n.requestCount,"1 API request, including:","{{requestCount}} API requests, including:",n):void 0,deviceRequestCount:_.isNumber(n.deviceRequestCount)?r.getPlural(n.deviceRequestCount,"1 device API request","{{deviceRequestCount}} device API requests",n):void 0,storageSize:_.isNumber(n.storageSize)?r.getString("{{storageSize}} storage",n):void 0,storageLimit:_.isNumber(n.storageLimit)?r.getString("{{storageLimit}} storage quota",n):void 0,rootDevicesCount:_.isNumber(n.rootDevicesCount)?r.getPlural(n.rootDevicesCount,"1 root device","{{rootDevicesCount}} root devices",n):void 0,devicesCount:_.isNumber(n.devicesCount)?r.getPlural(n.devicesCount,"1 device","{{devicesCount}} devices",n):void 0}},this.fetchUsersCount=function(){s.list({pageSize:1}).then(_.bind(this.setUsersCount,this))},this.setUsersCount=function(t){var s=t.statistics.totalPages;this.summary.thisMonth.usersCount=r.getPlural(s,"1 user","{{count}} users",{count:s})},this.setApps=function(t){this.apps=_(t).filter(_.bind(this.marketApps,this)).filter(_.bind(this.hiddenApps,this)).filter(_.bind(this.ignoredApps,this)).value()},this.marketApps=function(t){return"MARKET"===t.availability},this.hiddenApps=function(t){return!(t.manifest&&t.manifest.noAppSwitcher===!0)},this.ignoredApps=function(t){return!_.includes(this.APP_IGNORE,t.name)},this.shouldDisplayCustomTooltip=l}t.$inject=["c8yStatistics","c8yUser","c8yBase","c8yConfig","c8yApplication","$filter","gettext","gettextCatalog"],angular.module("c8y.parts.statistics").controller("StatisticsCtrl",t)}(),function(){"use strict";function t(t){var s;s='<div ng-controller="StatisticsCtrl as ctrl" ng-init="ctrl.fetch()" class="card-group">\n  <div class="col-md-4 col-sm-6 col-xs-12">\n    <div class="card">\n      <div class="card-header">\n        <h4 translate>Current month usage</h4>\n      </div>\n      <hr>\n      <div class="card-block text-muted">{{ctrl.thisMonth.tooltips.month()}}</div>\n      <ul class="list-group">\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.requestCount">\n          <span ng-bind="ctrl.summary.thisMonth.requestCount"></span>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.deviceRequestCount">\n          <span ng-bind="ctrl.summary.thisMonth.deviceRequestCount"></span>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.storageSize">\n          <span ng-bind="ctrl.summary.thisMonth.storageSize"></span><br>\n          <small class="text-muted">{{ctrl.thisMonth.tooltips.storageSize()}}</small>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.storageLimit">\n          <span ng-bind="ctrl.summary.thisMonth.storageLimit"></span><br>\n          <small class="text-muted">{{\'The quota calculation is based on the known number of devices, as displayed below.\' | translate}}</small>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.rootDevicesCount">\n          <span ng-bind="ctrl.summary.thisMonth.rootDevicesCount"> </span><br>\n          <small class="text-muted">{{ctrl.thisMonth.tooltips.rootDevicesCount()}}</small>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.devicesCount">\n          <span ng-bind="ctrl.summary.thisMonth.devicesCount"> </span><br>\n          <small class="text-muted">{{ctrl.thisMonth.tooltips.devicesCount()}}</small>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.thisMonth.usersCount">\n          <span ng-bind="ctrl.summary.thisMonth.usersCount"></span>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <div class="col-md-4 col-sm-6 col-xs-12">\n    <div class="card">\n      <div class="card-header">\n        <h4 translate>Last month usage</h4>\n      </div>\n      <hr>\n      <div class="card-block text-muted">{{ctrl.lastMonth.tooltips.month()}}</div>\n      <ul class="list-group">\n        <li class="list-group-item" ng-if="ctrl.summary.lastMonth.requestCount" ng-bind="ctrl.summary.lastMonth.requestCount">\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.lastMonth.deviceRequestCount" ng-bind="ctrl.summary.lastMonth.deviceRequestCount">\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.lastMonth.storageSize">\n          <span ng-bind="ctrl.summary.lastMonth.storageSize"></span><br>\n          <small class="text-muted">{{ctrl.lastMonth.tooltips.storageSize()}}</small></li>\n        <li class="list-group-item" ng-if="ctrl.summary.lastMonth.rootDevicesCount">\n          <span ng-bind="ctrl.summary.lastMonth.rootDevicesCount"></span><br>\n          <small class="text-muted">{{ctrl.lastMonth.tooltips.rootDevicesCount()}}</small>\n        </li>\n        <li class="list-group-item" ng-if="ctrl.summary.lastMonth.devicesCount">\n          <span ng-bind="ctrl.summary.lastMonth.devicesCount"></span><br>\n          <small class="text-muted">{{ctrl.lastMonth.tooltips.devicesCount()}}</small>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <div class="col-md-4 col-xs-12">\n    <div class="card">\n      <div class="card-header">\n        <h4 translate>Subscribed apps</h4>\n      </div>\n      <hr>\n      <div class="list-group list-group-links">\n        <a class="list-group-item flex-row" target="_blank" ng-repeat="app in ctrl.apps" ng-href="/apps/{{app.contextPath}}/index.html">\n          <span class="list-item-icon" style="font-size:36px; min-width: 45px"><c8y-app-icon app="::app"></c8y-app-icon></span>\n          <span class="list-item-body">\n            <span ng-bind="app | humanizeAppName"></span><br>\n            <small class="text-muted" ng-bind="app.contextPath"></small>\n          </span>\n        </a>\n      </div>\n    </div>\n  </div>\n</div>\n',t.put("administration_statistics/views/index.html",s),t.put("/apps/administration/statistics/views/index.html",s)}angular.module("c8y.parts.statistics").run(["$templateCache",t])}();