/* core_dataPointExplorer 8.21.0 2018-01-30T22:08:22+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function t(t,a){t.add({name:"Data points graph",nameDisplay:a("Data points graph"),description:a("A graph display of a collection of data points"),templateUrl:"core_dataPointExplorer/views/widget.html",configTemplateUrl:"core_dataPointExplorer/views/widgetConfig.html",options:{noDeviceTarget:!0,minCol:4}})}angular.module("c8y.cockpit.dataPointExplorer",["c8y.deviceSelector"]).constant("dataPointExplorerTemplateBasePath","core_dataPointExplorer/views/").config(["c8yComponentsProvider","gettext",t])}();var _slicedToArray=function(){function t(t,a){var n=[],e=!0,i=!1,o=void 0;try{for(var l,r=t[Symbol.iterator]();!(e=(l=r.next()).done)&&(n.push(l.value),!a||n.length!==a);e=!0);}catch(t){i=!0,o=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw o}}return n}return function(a,n){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return t(a,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){"use strict";function t(t,a,n,e,i,o,l,r,s,d){function c(t){return n.detail(t).then(i.getResData).then(p)}function p(t){return t[j]||{}}function u(t,a,n){return c(t).then(function(t){return n?delete t[a[W]]:t[a[W]]=m(a),t})}function m(t){var a=/^__/;return _.omitBy(t,function(t,n){return a.test(n)})}function g(t,a,e){var o={id:i.getId(t)},l=function(t){return s.mustHaveAdminMOs([t]).then(_.constant(t))};return i.createLocalId(a,W),u(t,a,e).then(function(t){return o[j]=t,o}).then(l).then(n.save,_.constant(t))}function f(t,n){var e=_.cloneDeep(t),i={templateUrl:"core_dataPointExplorer/views/dataPointAdd.html",controller:"c8yDataPointAddCtrl",size:"sm",resolve:{config:function(){return n||{}},addedDataPoints:function(){return e}}};return a.open(i).result}function v(t){var n=_.cloneDeep(t),e={templateUrl:"core_dataPointExplorer/views/dataPointAdd.html",controller:"c8yDataPointAddCtrl",size:"sm",resolve:{config:function(){return{kpisOnly:!0,maxSelectCount:1}},addedDataPoints:_.constant(n)}};return a.open(e).result}function h(a){return t.all({deviceDataPoints:c(a),kpiData:e.listKpiForDevice(a),device:a.name?t.resolve(a):n.detail(a).then(i.getResData)}).then(b)}function y(a){return t.all({deviceDataPoints:c(a),kpiData:t.resolve([]),device:a.name?t.resolve(a):n.detail(a).then(i.getResData)}).then(b)}function b(t){var a=t.deviceDataPoints,n=t.kpiData,e=t.device,i=n.matchKpi,o=n.nonKpiSeries,l=[];return _.forEach(a,function(t){x(l,t)||l.push(w(n,t))}),_.forEach(i,function(t){var a=C(t);x(l,a)||l.push(a)}),_.forEach(o,function(t){x(l,t)||l.push(S(t))}),_.forEach(l,_.partial(D,e)),l}function x(t,a){var n=a.fragment,e=a.series;return _.some(t,function(t){return t.fragment===n&&t.series===e})}function D(t,a){return a.__target={id:t.id,name:t.name},a}function w(t,a){var n=t.matchKpi,e=a,i=e._kpiId,o=i?_.find(n,{id:i}):null;return o&&(e=_.assign(_.cloneDeep(o.c8y_Kpi),e)),e}function C(t){var a=_.cloneDeep(t.c8y_Kpi);return a._kpiId=t.id,a}function T(){for(var t="#",a=0;a<3;a+=1)t+=_.padStart(_.random(0,255).toString(16),2,"0");return t}function S(t){var a=_.cloneDeep(t);return a.label=t.fragment+" => "+t.series,a.color=T(),a}function F(t){return"datapoints"+(t||"")}function $(a){var n=window.localStorage.getItem(F(a)),e=n?JSON.parse(n):[];return t.when(e)}function P(t,a){var n=5,e=2,i=(a||{}).id,o=function(){return B(e).then(E(n)).then(k)},l=function(t){return t.length?t:i?R(i,n):o()};return $(t).then(l)}function k(t){var a=_slicedToArray(t,1),n=a[0];return n&&(n.__active=!0),t}function E(t){return function(a){return _.take(a,t)}}function R(t,a){var e,o=[],l=function(){if(!e.length)return o;var t=e.shift();return h(t).then(r)},r=function(r){return _.forEach(r,function(t){return o.push(t),!(o.length>=a)}),o.length>=a?o:e?l():n.detail(t).then(i.getResData).then(function(t){return e=[],_.forEach(["childAssets","childDevices"],function(a){_.forEach(t[a].references,function(t){e.push(t.managedObject.id)})}),l()})};return h(t).then(r).then(k)}function A(a,n){var e=_.map(a,function(t){var a=_.cloneDeep(t);return a});return window.localStorage.setItem(F(n),JSON.stringify(e)),t.when(a)}function L(a){var n=window.localStorage.getItem(F("_savedfilter_"+(a||"")));return n=n?JSON.parse(n):M(),_.keys(n).length||(n=M()),n.dateFrom&&(n.dateFrom=moment(n.dateFrom).toDate()),n.dateTo&&(n.dateTo=moment(n.dateTo).toDate()),t.when(n)}function M(){var t=l.durations,a=l._defaultDuration,n=t[a];return{interval:a,dateTo:new Date,dateFrom:moment().subtract(n).toDate(),realtime:!0,aggregation:r.calculate(n)}}function I(a,n){return window.localStorage.setItem(F("_savedfilter_"+(n||"")),JSON.stringify(a)),t.when(a)}function N(t,a){return _.filter(t,function(t){var n=t.c8y_Kpi;return n.fragment===a.fragment&&n.series===a.series})}function U(t,a){var n=_.defaults(a.c8y_Kpi,Y);return t._kpiId=a.id,_.assign(t,n),t}function O(t,a){var n={},i={};return t._kpiId&&a&&(n.id=t._kpiId),_.assign(i,_.defaults(_.pick(t,z),Y)),n.c8y_Kpi=i,e.save(n)}function B(t){return o.list({pageSize:10*t}).then(K).then(function(a){var n=[];return _.forEach(a,function(a){return a.length>0&&n.push(a),!(n.length>=t)}),_.flattenDeep(n)})}function K(a){var n=_.map(a,h);return t.all(n)}function V(a){return t.all(_.map(a,q))}function q(t){var a=t.fragment,n=t.series,e=_.get(t,"__target.id"),i={fragment:a,series:n,device:e};return d.latest(i).then(function(e){return t.unit=_.get(e,[a,n,"unit"],t.unit),t})}var j="c8y_DataPoint",W="_id",z=["target","color","min","max","fragment","series","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax","unit","label"],Y=_.transform(z,function(t,a){t[a]=void 0},{});return{listForObject:c,listPossible:h,listPossibleFast:y,listLocalWithDefaults:P,listLocal:$,listForFirstDevices:B,saveLocal:A,save:g,remove:_.partialRight(g,!0),getSavedFilters:L,getDefaultFilters:M,setSavedFilters:I,addUI:f,chooseKpiWithUI:v,listAllKpi:e.list,getCompatibleKpi:N,updateDataPointWithKpi:U,saveDataPointToLibrary:O,setUnitFromLastMeasurement:V}}t.$inject=["$q","$uibModal","c8yInventory","c8yKpi","c8yBase","c8yDevices","INTERVAL_CONSTANTS","c8yAggregationSvc","c8yPermissions","c8yMeasurements"],angular.module("c8y.cockpit.dataPointExplorer").factory("c8yDataPointSvc",t)}(),function(){"use strict";function t(){function t(t,a,n){"basicList"in n&&(t.isBasicList=!0),"noChart"in n&&(t.noChart=!0),"noAsset"in n&&(t.noAsset=!0)}return{require:"?ng-form",restrict:"E",link:t,scope:{datapoints:"=",dontSave:"@",maxSelectCount:"&",allowAddingDataPointsFromContextMoOnly:"<"},templateUrl:"core_dataPointExplorer/views/dataPointList.html",controller:"c8yDataPointListCtrl"}}angular.module("c8y.cockpit.dataPointExplorer").directive("c8yDataPointList",[t])}(),function(){"use strict";function t(t,a){function n(n,e,i,o){function l(){var t=d()||{};return t.__active?void _(s).filter(function(t){return o[t]}).forEach(function(t){var a=o[t];_.reduce(a.$parsers,function(t,a){return a(t)},a.$viewValue)}):void _.forEach(s,function(t){var a=o[t];a&&a.$invalid&&(a.$setValidity("c8yMin",!0),a.$setValidity("c8yMax",!0),a.$setValidity("required",!0))})}function r(){n.$watch(d,l,!0),n.$watch(function(){return o.$valid},l)}var s=["active","color","label","unit","min","max","target","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax"],d=_.partial(a(i.c8yDataPointValidator),n);t(r,500)}return{require:"form",restrict:"A",transclude:!1,link:n}}angular.module("c8y.cockpit.dataPointExplorer").directive("c8yDataPointValidator",["$timeout","$parse",t])}(),function(){"use strict";function t(t,a,n,e,i){function o(){return a.getCompatibleKpi(t.kpis,t.dp||{})}function l(){return t.dp._kpiId&&d(t.dp._kpiId)}function r(n){t.isopen=!1;var o=!!n._kpiId;n._kpiId&&!d(n._kpiId)&&(o=!1,delete n._kpiId),a.saveDataPointToLibrary(n,o).then(function(a){_.isEmpty(a.data)||(n._kpiId=a.data.id),e.success(i("Successfully saved to library")),t.listKpi()})}function s(n,e){t.isopen=!1,a.updateDataPointWithKpi(n,e)}function d(a){return _.some(t.availableKpi(),{id:a})}function c(){if(t.dp._kpiId){var a=_.find(t.availableKpi(),{id:t.dp._kpiId});return _.get(a,"c8y_Kpi.label","")}}function p(){_.forEach(u,function(a){return _.get(t.singleDpForm,a).$setTouched()})}t.availableKpi=o,t.isKpiAvailable=l,t.saveToLibrary=r,t.updateDataPointWithKpi=s,t.chartTypes=n.renderTypes,t.lineTypes=n.lineTypes,t.axisTypes=n.axisTypes,t.dpDebounce=300,t.$watch("dp",function(n){n&&!t.dontSave&&a.save(n.__target,n)},!0),t.getLinkedKpiLabel=c,t.setRangesFieldsAsTouched=_.once(p);var u=["min","max","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax"]}t.$inject=["$scope","c8yDataPointSvc","c8yChart","c8yAlert","gettext"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointItemCtrl",t)}(),function(){"use strict";function t(t,a,n,e,i,o){function l(){r()}function r(){o.hasAnyRole(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]).then(function(a){t.canSaveToLibrary=a})}function s(){a.addUI(t.datapoints,{allowOnlyContextMo:t.allowAddingDataPointsFromContextMoOnly}).then(u).then(function(){t.forms.dpForm.$setDirty()})}function d(a){t.datapoints=_.without(t.datapoints,a),t.forms.dpForm.$setDirty()}function c(){_.get(t,"datapoints.length")||a.listLocalWithDefaults(F,$).then(u).then(p)}function p(){t.$watch("datapoints",function(){a.saveLocal(t.datapoints,F)},!0)}function u(a){t.datapoints||(t.datapoints=[]),t.maxSelectCount()&&_.forEach(a,function(t){t.__active=!1}),_.forEach(a,function(a){t.datapoints.push(a)}),m(a)}function m(t){var n=_.reject(t,"unit");return a.setUnitFromLastMeasurement(n)}function g(){var t=n.getContext();$=t,t.context&&(F=t.context+"_"+t.id)}function f(t){return i.addNewForInputDataPointWithUI(t)}function v(){a.listAllKpi().then(function(a){t.kpis=a})}function h(a){if(a.__active)return!0;var n=t.maxSelectCount();return!n||y().length<n}function y(){return _.filter(t.datapoints,{__active:!0})}function b(){t.forms.dpForm.$setValidity("dpSelected",y().length>0)}function x(t){return String(_.max(_.map(t,w)))}function D(t){return String(_.min(_.map(t,w)))}function w(t){return _.isNumber(t)?t:Number(t||NaN)}function C(t){return!_.isNaN(w(t))}function T(t){return""!==t.min&&_.isNumber(parseFloat(t.min))&&""!==t.max&&_.isNumber(parseFloat(t.max))}function S(){e.shouldShowGlobalSmartRules().then(function(a){t.shouldShowSmartRules=a})}var F,$;t.add=s,t.remove=d,t.allowSelection=h,t.max=x,t.min=D,t.isNumber=C,t.hasLimits=T,t.smartRulesSvc=i,t.createSmartRule=f,t.listKpi=v,t.$watch("datapoints",b,!0),t.shouldShowSmartRules=!1,l(),g(),S(),c(),v()}t.$inject=["$scope","c8yDataPointSvc","c8yUiUtil","c8ySmartRulesAvailability","smartRulesSvc","c8yPermissions"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointListCtrl",t)}(),function(){"use strict";function t(t,a,n,e,i,o,l,r){function s(a){a&&(t.noContext=!1,u(!0),m(),delete t.datapoints,e.listPossible(a).then(D).then(d).then(p).then(w))}function d(t){return _.reject(t,function(t){return!!_.find(l,_.pick(t,["fragment","series","__target"]))})}function c(t){return!o.kpisOnly||!_.isUndefined(t._kpiId)&&_.isUndefined(t._id)}function p(a){t.datapoints=a}function u(a){t.data.loadingDataPoints=a}function m(){t.datapointsSelected=g()}function g(){return _.union(_.filter(t.datapoints,"__active"),_.filter(t.datapointsSelected,"__active"))}function f(){a.close(g())}function v(t){var a=t.context;return a&&("device"===a||"group"===a)}function h(){var a=i.getContext();v(a)?t.rootId=a.id:(t.noContext=!0,u(!0),e.listForFirstDevices(2).then(D).then(d).then(p).then(w))}function y(t){return!t.__active&&o&&o.maxSelectCount<=g().length}function b(t){return t.title||r("Add data point")}function x(t){return t.addButtonLabel||r("Add")}var D=_.partialRight(_.filter,c),w=_.partial(u,!1);t.config=o,t.shouldDisableSelection=y,t.cancel=a.dismiss,t.getSelected=g,t.add=f,t.data={},t.$watch("data.device",s),t.getConfigTitle=b,t.getConfigBtnLabel=x,h()}t.$inject=["$scope","$uibModalInstance","$injector","c8yDataPointSvc","c8yUiUtil","config","addedDataPoints","gettext"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointAddCtrl",t)}(),function(){"use strict";function t(t,a,n,e,i,o,l,r,s,d,c,p,u,m){function g(a){t.data.graphDataPoints=a;var n=v(_.filter(a,"__active"));t.channel=n?"/measurements/"+n:""}function f(a){t.data.graphAlarmsEventsConfigs=a;var n=v(_.filter(a,"__active"));t.alarmsChannel=n?"/alarms/"+n:"",t.eventsChannel=n?"/events/"+n:""}function v(t){return _(t).map(function(t){return t.__target.id}).uniq().value().join(",")}function h(){if(!t.dontSave&&!t.disableLocalStorage){var a=_.pick(t.data,["dateFrom","dateTo","interval","aggregation","realtime","alarmsEventsConfigs"]);o.setSavedFilters(a,A)}}function y(){var t=e.getContext();!t.context&&a.path().match(/datapoint/)&&i.changeTitle({title:d("Data explorer")})}function b(){var t=e.getContext();t.context&&(A=t.context+"_"+t.id),x()}function x(){if(!t.disableLocalStorage){var a=_.throttle(function(t,a){t!==a&&h()},500,{leading:!1,trailing:!0});o.getSavedFilters(A).then(function(n){_.assign(t.data,n),t.$watch("data.realtime",a),t.$watch("data.dateFrom",a),t.$watch("data.dateTo",a),t.$watch("data.interval",a),t.$watch("data.aggregation",a),t.$watch("data.alarmsEventsConfigs",a,!0)})}}function D(){var t=D._hasDashboard,a=t,e=void 0;if(_.isUndefined(t))try{e=n.get("dashboardSvc"),2===e.VERSION&&(a=e)}catch(t){a=!1}return D._hasDashboard=a,a}function w(a){var n=D();n&&n[a]({name:"Data points graph",title:c.getString("Data points"),_width:12,_height:5,config:{datapoints:t.data.graphDataPoints,alarmsEventsConfigs:t.data.graphAlarmsEventsConfigs,dateTo:t.data.dateTo,dateFrom:t.data.dateFrom,aggregation:t.data.aggregation,realtime:t.data.realtime}}).then(C)}function C(){r.success(d("Widget successfully created"))}function T(){w("addWidgetToSelectedDashboardInContext")}function S(){w("addWidgetToSelectedReport")}function F(){var a={text:d(A?"Send as widget to dashboard":"Send as widget to report"),action:A?T:S};D()&&!t.noActions&&l.addAction(a)}function P(){function a(a,n){l.addAction({text:a,action:function(){var a={dateFrom:moment(t.data.dateFrom).format(s.dateFullFormat),dateTo:moment(t.data.dateTo).format(s.dateFullFormat)};u.downloadReportForDatapoints(n,t.data.graphDataPoints,a).catch(function(t){t&&t.message&&r.warning(t.message)})}})}a(d("Download as CSV"),p.format.csv),a(d("Download as Excel"),p.format.xlsx)}function k(){var a=t.data.interval;if(a&&"custom"!==a){var n=_.find(m.intervals,function(t){return t.id===a})||{};n.qty&&(t.data.dateFrom=moment().subtract(n.qty,n.unit).toDate(),t.data.dateTo=moment().toDate())}}function E(a){t.chartBox=a}function R(){y(),b(),F(),t.noActions||P(),$(window).resize(function(){t.$broadcast("dashboardResize"),t.$apply()}),t.onBoxChanged=E,t.onUpdateDates=function(a,n){t.data.dateFrom=a,t.data.realtime&&n<=new Date&&(t.data.realtime=!1),t.data.dateTo=n,t.data.updateDatesAndFetchData()},t.onUpdateDisplayedDates=function(a,n){t.data.displayedDateFrom=a,t.data.displayedDateTo=n},t.savedFilter={config:{}},t.data=t.data||_.cloneDeep(t.savedFilter),k(),t.$watch("data.datapoints",g,!0),t.$watch("data.alarmsEventsConfigs",f,!0)}var A=void 0;R()}t.$inject=["$scope","$location","$injector","c8yUiUtil","c8yTitle","c8yDataPointSvc","c8yActions","c8yAlert","c8yBase","gettext","gettextCatalog","c8yMeasurements","MeasurementsReportSvc","INTERVAL_CONSTANTS"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointExplorerCtrl",t)}(),function(){"use strict";function t(t,a,n,e){function i(a,n){t.child.config.updateDates!==!1&&(t.child.config.dateFrom=a,t.child.config.dateTo=n)}function o(){var a=t.child.config.interval;if(a&&a!==e.custom.id){var n=_.find(e.intervals,function(a){return a.id===t.child.config.interval})||{};n.qty&&(t.child.config.dateFrom=moment().subtract(n.qty,n.unit).toDate(),t.child.config.dateTo=moment().toDate())}}function l(t){u=t,r(),s()}function r(){var a=n.height()-(u&&u.height);t.dataPointsGraphHeight=_.max([m,a])}function s(){a(function(){t.$broadcast("dashboardResize")},500)}function d(a,n){t.alarmsEventsTimeline=t.alarmsEventsTimeline||{},t.alarmsEventsTimeline.displayedDateFrom=a,t.alarmsEventsTimeline.displayedDateTo=n}function c(a){t.chartBox=a}function p(t){return _(t).map(function(t){return t.__target.id}).uniq().value().join(",")}var u,m=200;t.onUpdateDates=i,t.onUpdateDisplayedDates=d,t.onBoxChanged=c,t.onTimelinesChartSizeChanged=l,t.dataPointsGraphHeight=n.height(),o(),t.$watch("child.config.datapoints",function(a){var n=p(a);t.channel=n?"/measurements/"+n:""}),t.$watch("child.config.alarmsEventsConfigs",function(a){var n=p(a);t.alarmsChannel=n?"/alarms/"+n:"",t.eventsChannel=n?"/events/"+n:""}),t.$watchCollection(["child.config.dateFrom","child.config.dateTo"],function(){d(t.child.config.dateFrom,t.child.config.dateTo)}),t.$on("dashboardResize",function(a){a.targetScope!==t&&(r(),s())})}t.$inject=["$scope","$timeout","$element","INTERVAL_CONSTANTS"],angular.module("c8y.cockpit.dataPointExplorer").controller("DataPointWidgetCtrl",t)}(),function(){"use strict";function t(t,a){function n(a){t.chartBox=a}t.noActions=!0,t.dontSave=!0;var e=function(t,n){var e=_.pick(n,"dateFrom","dateTo","aggregation","displayDateSelection","interval","realtime","displayDateSelection"),i=a.getDefaultFilters();_.assign(t,i,e)};t.onBoxChanged=n,t.data={},t.data.datapoints=_.cloneDeep(t.config.datapoints),t.data.alarmsEventsConfigs=_.cloneDeep(t.config.alarmsEventsConfigs),e(t.data,t.config),t.$watch("data",function(){e(t.config,t.data),t.config.datapoints=t.data.graphDataPoints,t.config.alarmsEventsConfigs=t.data.graphAlarmsEventsConfigs},!0)}angular.module("c8y.cockpit.dataPointExplorer").controller("DataPointWidgetConfigCtrl",["$scope","c8yDataPointSvc",t])}(),function(){"use strict";function t(t){var a;a='<div class="modal-header separator">\n  <h3>{{getConfigTitle(config) | translate}}</h3>\n</div>\n<div class="modal-inner-scroll">\n  <div class="modal-body">\n    <div class="legend form-block"><span class="dot bg-primary-light">1</span>\n      <translate>Select device</translate>\n    </div>\n    <div class="form">\n      <c8y-device-selector-combo parent="rootId" selected-child-device="data.device" read-only="config.allowOnlyContextMo">\n      </c8y-device-selector-combo>\n    </div>\n  </div>\n\n  <div class="bg-gray-white separator">\n    <div class="modal-body">\n      <div class="legend form-block"><span class="dot bg-primary-light">2</span>\n        <translate>Select data point</translate>\n      </div>\n      <div ng-show="data.loadingDataPoints" class="text-center">\n        <c8y-rectangle-spinner class="spinner-inline" message="\'Loading data pointsâ€¦\' | translate"></c8y-rectangle-spinner>\n      </div>\n      <p class="text-center" ng-show="noContext && datapoints.length">\n        {{\'Here are a few data points to get you started\' | translate}}\n      </p>\n\n      <div class="alert alert-warning" ng-show="datapoints.length == 0" translate>\n        No data points found.\n      </div>\n    </div>\n    <div class="list-group" ng-show="datapointsSelected.length || datapoints.length">\n      <div class="c8y-data-point list-group-item flex-row collapsible" ng-repeat="dp in datapointsSelected" ng-class="{\'expanded\': isCollapsed}">\n        <div class="list-item-actions">\n          <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn" ng-click="isCollapsed = !isCollapsed"><i c8y-icon="chevron-down"></i></button>\n        </div>\n        <div class="list-item-checkbox">\n          <label class="c8y-checkbox input-sm">\n            <input type="checkbox" ng-model="dp.__active" ng-disabled="shouldDisableSelection(dp)">\n            <span></span>\n          </label>\n        </div>\n\n        <div class="list-item-icon">\n          <i c8y-icon="circle" ng-style="{color: dp.color}"></i>\n        </div>\n\n        <div class="list-item-body" ng-click="isCollapsed = !isCollapsed">\n          <span class="text-truncate small">{{dp.label}}</span>\n        </div>\n\n        <div uib-collapse="!isCollapsed" style="padding-left: 35px">\n          <div class="data-point-details small">\n            <div class="data-point-target">\n              <label class="text-muted" translate>Measurement:</label> <span>{{dp.fragment}} &gt; {{dp.series}}</span>\n            </div>\n            <div class="tight-grid">\n              <div class="col-xs-6 col-sm-4" ng-show="dp.unit">\n                <label class="text-muted" translate>Unit:</label> {{dp.unit}}\n              </div>\n              <div class="col-xs-6 col-sm-4" ng-if="!isBasicList" ng-show="dp.min">\n                <label class="text-muted" translate>Min:</label> {{dp.min}}\n              </div>\n              <div class="col-xs-6 col-sm-4" ng-if="!isBasicList" ng-show="dp.max">\n                <label class="text-muted" translate>Max:</label> {{dp.max}}\n              </div>\n            </div>\n          </div>\n        </div>\n        <!-- /collapse -->\n      </div>\n\n\n      <div class="c8y-data-point list-group-item flex-row collapsible" ng-repeat="dp in datapoints" ng-class="{\'expanded\': isCollapsed}">\n        <div class="list-item-actions">\n          <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn" ng-click="isCollapsed = !isCollapsed"><i c8y-icon="chevron-down"></i></button>\n        </div>\n        <div class="list-item-checkbox">\n          <label class="c8y-checkbox input-sm">\n            <input type="checkbox" ng-model="dp.__active" ng-disabled="shouldDisableSelection(dp)">\n              <span></span>\n            </label>\n        </div>\n\n        <div class="list-item-icon">\n          <i c8y-icon="circle" ng-style="{color: dp.color}"></i>\n        </div>\n\n        <div class="list-item-body text-truncate" title="{{dp.label}}" ng-click="isCollapsed = !isCollapsed">\n          <span class="small">{{dp.label}}</span>\n        </div>\n\n        <div uib-collapse="!isCollapsed" style="padding-left: 35px">\n          <div class="data-point-details small top-m-sm">\n            <div class="data-point-target">\n              <label class="text-muted" translate>Measurement:</label> <span>{{dp.fragment}} &gt; {{dp.series}}</span>\n            </div>\n            <div class="tight-grid">\n              <div class="col-xs-6 col-sm-4" ng-show="dp.unit">\n                <label class="text-muted" translate>Unit:</label> {{dp.unit}}\n              </div>\n              <div class="col-xs-6 col-sm-4" ng-if="!isBasicList" ng-show="dp.min">\n                <label class="text-muted" translate>Min:</label> {{dp.min}}\n              </div>\n              <div class="col-xs-6 col-sm-4" ng-if="!isBasicList" ng-show="dp.max">\n                <label class="text-muted" translate>Max:</label> {{dp.max}}\n              </div>\n            </div>\n          </div>\n        </div>\n        <!-- /collapse -->\n\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-default" ng-click="cancel()" translate>Cancel</button>\n  <button class="btn btn-primary" ng-click="add()" ng-disabled="!getSelected().length">\n    {{getConfigBtnLabel(config) | translate}}\n  </button>\n</div>',t.put("core_dataPointExplorer/views/dataPointAdd.html",a),t.put("/apps/core/dataPointExplorer/views/dataPointAdd.html",a),a='<div class="card">\n    <div class="card-header">\n      <span class="card-title h4" translate>Data points</span>\n      <!-- popover help content\n      <span class="pull-right">\n        <a href="#" data-toggle="popover" data-placement="left" data-content="Help content" data-trigger="focus" data-original-title="" title=""><i class="fa fa-question-circle-o"></i></a>\n      </span> -->\n    </div>\n    <hr>\n    <div ng-if="forms.dpForm.$invalid" class="card-block">\n      <div ng-if="!forms.dpForm.$error.dpSelected" class="alert alert-warning" style="margin-bottom:0">\n        <translate>You need to fix validation errors before you can save.</translate>\n          &nbsp;\n        <a href="" class="text-warning" popover-trigger="\'focus\'" popover-append-to-body="true" uib-popover="{{\'Validations are simple rules such as `min must be less than max`. Red bordered input fields will give you clues. You must also select at least one datapoint.\' | translate}}">\n          <i c8y-icon="question-circle-o"></i>\n        </a>\n      </div>\n      <div ng-if="forms.dpForm.$error.dpSelected && datapoints.length > 0" class="alert alert-info" style="margin-bottom:0">\n        <translate>You must enable at least one datapoint.</translate>\n      </div>\n      <div ng-if="datapoints.length === 0" class="c8y-empty-state text-left">\n        <h1 class="c8y-icon c8y-icon-data-points c8y-icon-duocolor"></h1>\n        <p>\n          <strong translate>No data points found.</strong>\n          <span translate>You must add at least one data point.</span><br>\n          <small c8y-guide-docs translate>Find out more on the <a c8y-guide-href="users-guide/cockpit/#visualize">User Guide</a>.</small>\n        </p>\n      </div>\n    </div>\n\n    <div class="c8y-data-point-list list-group" ng-form="forms.dpForm" style="margin-top:-1px">\n      <div class="c8y-data-point list-group-item flex-row collapsible" ng-repeat="dp in datapoints" ng-controller="c8yDataPointItemCtrl" ng-form="forms.dpChildForm{{$index}}" c8y-data-point-validator="dp" ng-class="{\'expanded\': isCollapsed}" style="z-index: initial">\n        <div class="list-item-actions">\n          <span ng-if="singleDpForm.$invalid" class="has-error"><i c8y-icon="warning"></i></span>\n\n          <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn" ng-click="isCollapsed = !isCollapsed"><i c8y-icon="chevron-down"></i></button>\n          <span class="dropdown settings" is-open="isopen" uib-dropdown>\n            <button type="button" class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle>\n              <i c8y-icon="ellipsis-v"></i>\n            </button>\n            <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n              <li c8y-if-allowed cfg="smartRulesSvc.permissionsCfgs.create" ng-if="shouldShowSmartRules">\n                <button type="button" ng-click="createSmartRule(dp)">\n                  <i c8y-icon="cogs"></i> {{\'Create Smart Rule\' | translate}}\n                </button>\n              </li>\n              <li>\n                <button type="button" ng-click="remove(dp)">\n                  <i c8y-icon="trash"></i>{{\'Remove from list\' | translate}}\n                </button>\n              </li>\n              <li ng-repeat="kpi in availableKpi()">\n                <button type="button" ng-click="updateDataPointWithKpi(dp, kpi)">\n                  <i c8y-icon="c8y-data-points"></i> <translate>Load \'<small><i>{{kpi.c8y_Kpi.label}}</i></small>\' from library</translate>\n                </button>\n              </li>\n              <li ng-show="canSaveToLibrary">\n                <button type="button" ng-click="saveToLibrary(dp)">\n                  <i c8y-icon="floppy-o"></i>\n                  <translate ng-hide="isKpiAvailable()">Save to library</translate>\n                  <translate ng-show="isKpiAvailable()">Update \'<small class="text-muted"><i>{{getLinkedKpiLabel()}}</i></small>\' in library</translate>\n                </button>\n              </li>\n            </ul>\n          </span>\n        </div>\n\n        <div class="list-item-switch">\n          <label class="c8y-switch">\n            <input name="active" type="checkbox" ng-model="dp.__active" ng-disabled="!allowSelection(dp)">\n            <span></span>\n          </label>\n        </div>\n\n        <div class="list-item-colorpicker">\n          <input c8y-color-picker name="color" type="hidden" class="colorpicker" ng-model="dp.color" uib-tooltip="{{\'Change color\' | translate}}">\n        </div>\n\n        <div class="list-item-body text-truncate">\n          <div class="data-point-label text-truncate" title="{{\'Show details\' | translate}}" ng-click="isCollapsed = !isCollapsed">\n            <span name="label">{{dp.label}}</span>\n          </div>\n        </div>\n\n        <div uib-collapse="!isCollapsed">\n          <div class="data-point-details" ng-form="singleDpForm">\n            <div class="form-group">\n              <label translate>Label</label>\n              <input name="label" ng-model="dp.label" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="input-sm form-control">\n            </div>\n            <div class="data-point-target">\n              <label translate>Target</label>\n              <p>{{dp.__target.name}}\n              <br><small class="text-muted hidden-xs">{{dp.fragment}} &gt; {{dp.series}}</small></p>\n            </div>\n            <div class="tight-grid">\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group form-group-sm">\n                      <label for="unit" translate>Default unit</label>\n                      <input name="unit" ng-model="dp.unit" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control">\n                    </div>\n              </div>\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group form-group-sm" ng-if="!isBasicList">\n                      <label for="min" translate>Min</label>\n                      <input name="min" type="number" ng-max="dp.max" ng-model="dp.min" c8y-model-options="{preserveNumericStrings: true}" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                      <c8y-error-feedback field="singleDpForm.min"></c8y-error-feedback>\n                    </div>\n              </div>\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group form-group-sm" ng-if="!isBasicList">\n                      <label for="max" translate>Max</label>\n                      <input name="max" type="number" ng-min="dp.min" ng-model="dp.max" c8y-model-options="{preserveNumericStrings: true}" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                      <c8y-error-feedback field="singleDpForm.max"></c8y-error-feedback>\n                    </div>\n              </div>\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group form-group-sm" ng-if="!isBasicList" style="clear:both">\n                      <label for="target"><translate>Target</translate>  <i c8y-icon="info-circle" uib-tooltip="{{\'Expected target value for datapoint\' | translate}}"></i></label>\n                      <input name="target" type="number" ng-min="dp.min" ng-max="dp.max" c8y-model-options="{preserveNumericStrings: true}" ng-model="dp.target" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control">\n                    </div>\n              </div>\n\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group" ng-if="!isBasicList">\n                      <label for="yellowRange" translate>Yellow range</label>\n                      <div class="tight-grid">\n                        <div class="col-xs-6">\n                          <div class="form-group form-group-sm">\n                            <input name="yellowRangeMin" type="number" ng-min="dp.min" ng-max="min([dp.max, dp.yellowRangeMax])" c8y-model-options="{preserveNumericStrings: true}" ng-required="isNumber(dp.yellowRangeMax) && hasLimits(dp)" ng-model="dp.yellowRangeMin" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                            <c8y-error-feedback field="singleDpForm.yellowRangeMin"></c8y-error-feedback>\n                          </div>\n                        </div>\n                        <div class="col-xs-6">\n                          <div class="form-group form-group-sm">\n                            <input name="yellowRangeMax" type="number" ng-min="max([dp.min, dp.yellowRangeMin])" ng-max="dp.max" c8y-model-options="{preserveNumericStrings: true}" ng-required="isNumber(dp.yellowRangeMin) && hasLimits(dp)" ng-model="dp.yellowRangeMax" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                            <c8y-error-feedback field="singleDpForm.yellowRangeMax"></c8y-error-feedback>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n              </div>\n\n              <div class="col-xs-6 col-sm-4">\n                  <div class="form-group" ng-if="!isBasicList">\n                      <label for="redRange" translate>Red range</label>\n                      <div class="tight-grid">\n                        <div class="col-xs-6">\n                          <div class="form-group form-group-sm">\n                            <input name="redRangeMin" type="number" ng-min="dp.min" ng-max="min([dp.max, dp.redRangeMax])" c8y-model-options="{preserveNumericStrings: true}" ng-required="isNumber(dp.redRangeMax) && hasLimits(dp)" ng-model="dp.redRangeMin" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                            <c8y-error-feedback field="singleDpForm.redRangeMin"></c8y-error-feedback>\n                          </div>\n                        </div>\n                        <div class="col-xs-6">\n                          <div class="form-group form-group-sm">\n                          <input name="redRangeMax" type="number" ng-min="max([dp.min, dp.redRangeMin])" ng-max="dp.max" c8y-model-options="{preserveNumericStrings: true}" ng-required="isNumber(dp.redRangeMin) && hasLimits(dp)" ng-model="dp.redRangeMax" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" class="form-control" ng-change="setRangesFieldsAsTouched()">\n                          <c8y-error-feedback field="singleDpForm.redRangeMax"></c8y-error-feedback>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n              </div>\n\n                <div class="tight-grid">\n                  <div class="col-xs-6 col-sm-4">\n                      <div class="form-group form-group-sm" ng-if="!isBasicList && !noChart">\n                          <label for="display"><translate>Display</translate> <i c8y-icon="info-circle" uib-tooltip="{{\'Value displayed when data is aggregated\' | translate}}"></i></label>\n                          <div class="c8y-select-wrapper">\n                            <select class="form-control" ng-options="type.val as (type.text | translate) for type in chartTypes" ng-model="dp.renderType" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" ng-init="dp.renderType = dp.renderType || chartTypes[0].val">\n                            </select>\n                            <span></span>\n                          </div>\n                        </div>\n                  </div>\n                  <div class="col-xs-6 col-sm-4">\n                      <div class="form-group form-group-sm" ng-if="!isBasicList && !noChart">\n                          <label for="chartType" translate>Chart type</label>\n                          <div class="c8y-select-wrapper">\n                            <select class="form-control" ng-options="type.val as (type.text | translate) for type in lineTypes" ng-model="dp.lineType" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}" ng-init="dp.lineType = dp.lineType || lineTypes[0].val">\n                            </select>\n                            <span></span>\n                        </div>\n                        </div>\n                  </div>\n                 <div class="col-xs-6 col-sm-4">\n                    <div class="form-group form-group-sm" ng-if="!isBasicList && !noChart">\n                        <label for="yAxis" translate>Y Axis</label>\n                        <div class="c8y-select-wrapper">\n                          <select class="form-control" ng-options="axis.val as (axis.text | translate) for axis in axisTypes" ng-model="dp.yAxisType" ng-model-options="{updateOn: \'blur\', debounce: dpDebounce}">\n                          </select>\n                          <span></span>\n                        </div>\n                      </div>\n                 </div>\n                </div>\n              </div>\n          </div>\n        </div>\n\n      </div><!-- /.data-point -->\n\n\n\n    </div><!-- / .list-group -->\n    <div class="card-footer separator">\n      <button class="btn btn-primary" ng-click="add()">\n        <i c8y-icon="plus-circle"></i>\n        <translate>Add data point</translate>\n      </button>\n    </div>\n  </div><!-- card -->\n',
t.put("core_dataPointExplorer/views/dataPointList.html",a),t.put("/apps/core/dataPointExplorer/views/dataPointList.html",a),a='<div class="data-point-explorer" style="clear:both">\n  <c8y-ui-action-bar-set>\n    <li class="navbar-form">\n      <label translate>Aggregation</label>\n        <c8y-aggregation date-from="data.dateFrom" date-to="data.dateTo" realtime="data.realtime" aggregation="data.aggregation" auto="true">\n        </c8y-aggregation>\n    </li>\n    <li class="navbar-form">\n        <c8y-interval date-from="data.dateFrom" date-to="data.dateTo" interval="data.interval">\n        </c8y-interval>\n    </li>\n    <li>\n      <c8y-realtime-button channel="{{channel}}" state="data.realtime" on-data="data.onData($data)">\n      </c8y-realtime-button>\n      <c8y-realtime-button ng-show="false" channel="{{alarmsChannel}}" state="data.realtime" on-data="data.onAlarm($data)" on-data-update="data.onAlarm($data)">\n        </c8y-realtime-button>\n        <c8y-realtime-button ng-show="false" channel="{{eventsChannel}}" state="data.realtime" on-data="data.onEvent($data)">\n        </c8y-realtime-button>\n    </li>\n  </c8y-ui-action-bar-set>\n\n\n  <div class="row">\n    <div class="col-md-8">\n      <div class="card">\n        <div class="card-block">\n          <div class="c8yGraphFill" style="height:540px; clear: both">\n            <c8y-chart datapoints="data.graphDataPoints" date-from="data.dateFrom" date-to="data.dateTo" realtime="data.realtime" aggregation="data.aggregation" show-time="true" on-data="data.onData" on-update-dates="onUpdateDates($dateFrom, $dateTo)" on-update-displayed-dates="onUpdateDisplayedDates($dateFrom, $dateTo)" on-box-changed="onBoxChanged(box)">\n            </c8y-chart>\n          </div>\n          <c8y-alarms-events-timelines-chart alarms-events-configs="data.graphAlarmsEventsConfigs" date-from="data.displayedDateFrom" date-to="data.displayedDateTo" on-update-dates="onUpdateDates($dateFrom, $dateTo)" update-dates-and-fetch-data="data.updateDatesAndFetchData" realtime="data.realtime" on-realtime-alarm="data.onAlarm" on-realtime-event="data.onEvent" chart-box="chartBox">\n          </c8y-alarms-events-timelines-chart>\n\n        </div>\n      </div>\n    </div>\n    <div class="col-md-4">\n      <c8y-data-point-list datapoints="data.datapoints"></c8y-data-point-list>\n      <c8y-alarms-events-timelines-config configs="data.alarmsEventsConfigs"></c8y-alarms-events-timelines-config>\n    </div>\n  </div>\n\n</div>\n',t.put("core_dataPointExplorer/views/explorer.html",a),t.put("/apps/core/dataPointExplorer/views/explorer.html",a),a='<div ng-controller="DataPointWidgetCtrl" class="dashboard-old-minheight" style="height: 100%" ng-init="disableLocalStorage = true">\n  <c8y-realtime-button ng-show="false" channel="{{channel}}" state="child.config.realtime" on-data="onData($data)">\n  </c8y-realtime-button>\n  <c8y-realtime-button ng-show="false" channel="{{alarmsChannel}}" state="child.config.realtime" on-data="onAlarm($data)" on-data-update="onAlarm($data)">\n  </c8y-realtime-button>\n  <c8y-realtime-button ng-show="false" channel="{{eventsChannel}}" state="child.config.realtime" on-data="onEvent($data)">\n  </c8y-realtime-button>\n  <c8y-aggregation ng-show="false" date-from="child.config.dateFrom" date-to="child.config.dateTo" aggregation="child.config.aggregation" realtime="child.config.realtime" auto="true">\n  </c8y-aggregation>\n  <div style="position: relative" ng-style="{height: dataPointsGraphHeight}">\n    <c8y-chart datapoints="child.config.datapoints" datapoints-initial-display-limit="child.config.datapointsInitialDisplayLimit" date-from="child.config.dateFrom" date-to="child.config.dateTo" realtime="child.config.realtime" aggregation="child.config.aggregation" show-time="child.config.displayDateSelection" on-data="onData" on-update-dates="onUpdateDates($dateFrom, $dateTo)" on-update-displayed-dates="onUpdateDisplayedDates($dateFrom, $dateTo)" on-box-changed="onBoxChanged(box)" selectable="child.config.selectable" selected="child.config.selected" append-datepicker-to-body="true">\n    </c8y-chart>\n  </div>\n  <c8y-alarms-events-timelines-chart alarms-events-configs="child.config.alarmsEventsConfigs" date-from="alarmsEventsTimeline.displayedDateFrom" date-to="alarmsEventsTimeline.displayedDateTo" on-update-dates="onUpdateDates($dateFrom, $dateTo)" update-dates-and-fetch-data="alarmsEventsTimeline.updateDatesAndFetchData" realtime="child.config.realtime" on-realtime-alarm="onAlarm" on-realtime-event="onEvent" chart-box="chartBox" on-size-changed="onTimelinesChartSizeChanged($size)">\n  </c8y-alarms-events-timelines-chart>\n</div>\n',t.put("core_dataPointExplorer/views/widget.html",a),t.put("/apps/core/dataPointExplorer/views/widget.html",a),a='<div ng-controller="DataPointWidgetConfigCtrl" ng-init="disableLocalStorage = true">\n  <div class="data-point-explorer" ng-controller="c8yDataPointExplorerCtrl">\n    <div class="pull-right" style="margin-bottom: 5px">\n      <c8y-realtime-button class="top-right-control" channel="{{channel}}" state="data.realtime" on-data="onData($data)">\n      </c8y-realtime-button>\n      <c8y-realtime-button ng-show="false" channel="{{alarmsChannel}}" state="data.realtime" on-data="onAlarm($data)" on-data-update="onAlarm($data)">\n      </c8y-realtime-button>\n      <c8y-realtime-button ng-show="false" channel="{{eventsChannel}}" state="data.realtime" on-data="onEvent($data)">\n      </c8y-realtime-button>\n      <c8y-aggregation class="top-right-control" date-from="data.dateFrom" date-to="data.dateTo" aggregation="data.aggregation" realtime="data.realtime" auto="true">\n      </c8y-aggregation>\n      <c8y-interval class="top-right-control" date-from="data.dateFrom" date-to="data.dateTo" interval="data.interval">\n      </c8y-interval>\n    </div>\n    <div class="c8yGraphFill" style="height:340px; clear: both">\n      <c8y-chart datapoints="data.graphDataPoints" date-from="data.dateFrom" date-to="data.dateTo" realtime="data.realtime" aggregation="data.aggregation" show-time="true" on-data="onData" on-update-dates="onUpdateDates($dateFrom, $dateTo)" on-update-displayed-dates="onUpdateDisplayedDates($dateFrom, $dateTo)" on-box-changed="onBoxChanged(box)">\n      </c8y-chart>\n    </div>\n    <c8y-alarms-events-timelines-chart alarms-events-configs="data.graphAlarmsEventsConfigs" date-from="data.displayedDateFrom" date-to="data.displayedDateTo" on-update-dates="onUpdateDates($dateFrom, $dateTo)" update-dates-and-fetch-data="data.updateDatesAndFetchData" realtime="data.realtime" on-realtime-alarm="onAlarm" on-realtime-event="onEvent" chart-box="chartBox">\n    </c8y-alarms-events-timelines-chart>\n    <c8y-data-point-list datapoints="data.datapoints" allow-adding-data-points-from-context-mo-only="dashboard.deviceType && dashboard.deviceTypeValue" dont-save="true"></c8y-data-point-list>\n    <c8y-alarms-events-timelines-config configs="data.alarmsEventsConfigs"></c8y-alarms-events-timelines-config>\n    <label class="checkbox-inline c8y-checkbox" style="margin-top: 20px">\n      <input type="checkbox" ng-model="data.displayDateSelection">\n      <span></span>\n      <translate>Show date selection</translate>\n    </label>\n  </div>\n</div>\n',t.put("core_dataPointExplorer/views/widgetConfig.html",a),t.put("/apps/core/dataPointExplorer/views/widgetConfig.html",a)}angular.module("c8y.cockpit.dataPointExplorer").run(["$templateCache",t])}();