/* devicemanagement_deviceBulkControl 8.21.0 2018-01-30T22:08:28+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function e(e,t){e.when("/group/:groupId",{templateUrl:"devicemanagement_deviceBulkControl/views/list.html",name:t("Bulk operations"),icon:"c8y-energy"})}angular.module("c8y.deviceBulkControl",["ui.bootstrap.progressbar"]).config(["c8yViewsProvider","gettext",e])}(),function(){"use strict";function e(e,t,n,i,o,a,s,r,l){function c(){p().then(d,g).then(m).then(angular.bind(w,w.start))}function p(e){var t=u(e);return o.list(t,!0)}function u(e){var n=e||b;return _.assign(n,t),n}function d(t,n){e.operations&&!n||(e.operations=[]),t.forEach(function(t){e.operations.push(t),h[t.id]=h[t.id]||_.cloneDeep(k)}),e.paging=t.paging}function g(e){return 403===e.status?s.info(l("You need these roles to access bulk operations: Bulk Operation Read / Admin")):s.danger(r.getTranslatedServerMessage(e.data.message),e.data),i.reject()}function m(){var e=t.open;e&&(h[e]=_.assign(h[e]||_.cloneDeep(k),{showDetails:!0}))}function v(){e.paging.refresh().then(_.partialRight(d,!0))}function f(t){e.paging.loading=!0,t?p({pageSize:t}).then(d):e.paging.next().then(d).finally(function(){e.paging.loading=!1})}function y(){w.stop()}var h={},b={withDeleted:!0},k={showGroupLink:!t.groupId,showProgressBar:!0,showEditable:!0,showDetails:!1},w={promise:null,toggle:function(){this.promise?this.stop():this.start()},start:function(){this.promise||(v(),this.promise=n(v,1e4))},stop:function(){this.promise&&(n.cancel(this.promise),this.promise=null)},icon:function(){return a.icon(!!this.promise)},color:function(){return this.promise?"realtime-on":"realtime-off"},state:function(){return!!this.promise}};e.operationDisplayOptions=h,e.realtime=w,e.refresh=v,e.loadNext=f,e.$on("$destroy",y),c()}angular.module("c8y.deviceBulkControl").controller("bulkOperationsListCtrl",["$scope","$routeParams","$interval","$q","c8yDeviceBulkControl","c8yRealtime","c8yAlert","c8yLocales","gettext",e])}(),function(){"use strict";function e(e,t,n,i,o,a,s,r){function l(){c(),p()}function c(){e.operation=r=r||{}}function p(){return t.all([o.list(),a.getGroupList()]).then(_.flattenDeep).then(u)}function u(t){e.groups=t,r.groupId=r.groupId||t[0]&&t[0].id}function d(e){return n.close(e)}e.save=d,e.dismiss=n.dismiss,l()}angular.module("c8y.deviceBulkControl").controller("bulkOperationDetailsCtrl",["$scope","$q","$uibModalInstance","$routeParams","c8yDeviceGroup","c8yDynamicGroups","c8yInventory","operation",e])}(),function(){"use strict";function e(e,t,n,i,o,a,s,r){function l(){e.displayOptions.showDetails=!e.displayOptions.showDetails}function c(e){return i.getStatusStyle(e).cls}function p(e){return i.getStatusStyle(e).icon}function u(e){return i.getStatusStyle(e).label}function d(e){return n.getStyle(e).icon}function g(e){return n.getStyle(e).cls}function m(e){return k(e,i.status.SCHEDULED)}function v(e){return t.editBulkOperationWithUI(e).then(b)}function f(e){return i.canCancel(e)}function y(e){return o({title:s("Confirm cancelling operation?"),body:e.operationPrototype.description?r.getString('Do you really want to cancel operation "{{description | translate}}"?',e.operationPrototype):s("Do you really want to cancel this operation?"),status:"danger"}).then(angular.bind(i,i.cancel,e)).then(_.partial(_.unary(a.success),s("Operation cancellation triggered. If it is in progress, it may take up to one minute to cancel it."))).then(b)}function h(e){return k(e,i.status.COMPLETED_WITH_FAILURES)}function b(){e.onEdited&&e.onEdited()}function k(e,t){return i.getStatus(e)===t}function w(e){return e.operationPrototype.description||s("no description available")}function O(n){_.isUndefined(e.groupStillExists)&&t.doesTargetGroupExist(n).then(function(t){e.groupStillExists=t})}function S(n){e.progressBar=_.assign(e.progressBar||{},t.getProgressBar(n))}e.toggle=l,e.isInStatus=k,e.statusClass=c,e.statusIcon=p,e.statusLabel=u,e.singleOpStatusClass=g,e.singleOpStatusIcon=d,e.canEdit=m,e.edit=v,e.canCancel=f,e.cancel=y,e.canRetryFailed=h,e.retryFailed=t.retryFailedWithUI,e.getOperationDesc=w,e.checkGroupLink=O,e.$watch("operation",S)}e.$inject=["$scope","deviceBulkControlSvc","c8yDeviceControl","c8yDeviceBulkControl","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceBulkControl").controller("deviceControlBulkOperationRowSummaryCtrl",e)}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{operation:"=",displayOptions:"=?",onEdited:"&?"},templateUrl:"devicemanagement_deviceBulkControl/views/bulkOperationRowSummary.html",controller:"deviceControlBulkOperationRowSummaryCtrl"}}angular.module("c8y.deviceBulkControl").directive("deviceControlBulkOperationRowSummary",e)}(),function(){"use strict";function e(e,t,n){function i(){return{showDetails:!1,showDeviceLink:!0}}function o(e){return n.getStatusStyle(e).cls}function a(e){return n.getStatusStyle(e).icon}function s(e){return n.getStatusStyle(e).label}function r(e){return t.getStyle(e).icon}function l(e){return t.getStyle(e).cls}e.getSingleOperationDisplayOptions=i,e.getStandardKeys=t.getStandardKeys,e.status=n.getStatusStyle,e.statusClass=o,e.statusIcon=a,e.statusLabel=s,e.singleOpStatusClass=l,e.singleOpStatusIcon=r}angular.module("c8y.deviceBulkControl").controller("deviceControlBulkOperationRowDetailsCtrl",["$scope","c8yDeviceControl","c8yDeviceBulkControl",e])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{operation:"=",onChange:"&?"},templateUrl:"devicemanagement_deviceBulkControl/views/bulkOperationRowDetails.html",controller:"deviceControlBulkOperationRowDetailsCtrl"}}angular.module("c8y.deviceBulkControl").directive("deviceControlBulkOperationRowDetails",e)}(),function(){"use strict";function e(e,t,n,i,o,a){function s(e){if(e&&e.progress&&0!==e.progress.all){var t=e.progress;return[{type:"info",value:t.pending/t.all*100,tooltip:a("Pending"),status:"pending"},{type:"warning",value:t.executing/t.all*100,tooltip:a("Executing"),status:"executing"},{type:"success",value:t.successful/t.all*100,tooltip:a("Successful"),status:"successful"},{type:"danger",value:t.failed/t.all*100,tooltip:a("Failed"),status:"failed"}]}return null}function r(t){return c({startDate:moment().add(10,"minutes").seconds(0).format(e.dateFullFormat),operationPrototype:_.cloneDeep(t),creationRamp:15}).then(_.partial(p,a("New bulk operation scheduled!")))}function l(e){return c(e).then(_.partial(p,a("Bulk operation updated!")))}function c(e){return i({templateUrl:"devicemanagement_deviceBulkControl/views/details.html",controller:"bulkOperationDetailsCtrl",resolve:{operation:function(){return _.cloneDeep(e)}}})}function p(e,t){return n.save(t).then(_.partial(m,e))}function u(t){return n.detail(t).then(e.getResData).then(function(e){return"#/group/"+e.groupId+"/bulk_operations?open="+e.id})}function d(e){var n=e.groupId;return t.detail(n,{},{silentError:!0}).then(_.constant(!0)).catch(_.constant(!1))}function g(t){var i=_.cloneDeep(t);return i.startDate=moment().add(10,"minutes").seconds(0).format(e.dateFullFormat),c(i).then(n.retryFailed).then(_.partial(m,a("Scheduled bulk operation to complete failed devices!")))}function m(e){return o.success(e)}return{getProgressBar:s,createBulkOperationFromExistingOp:r,editBulkOperationWithUI:l,getBulkOperationHref:u,doesTargetGroupExist:d,retryFailedWithUI:g}}e.$inject=["c8yBase","c8yInventory","c8yDeviceBulkControl","c8yModal","c8yAlert","gettext"],angular.module("c8y.deviceBulkControl").factory("deviceBulkControlSvc",e)}(),function(){"use strict";function e(e){var t;t='<div class="row">\n  <div class="col-sm-3">\n    <div class="legend form-block" translate>Details</div>\n    <dl class="dl-inline small text-muted" style="margin-bottom: 0">\n      <dt translate>Start date</dt>\n      <dd>{{operation.startDate | date:\'medium\'}}</dd>\n      <dt>\n        <span translate>Delay</span>\n        <a href popover-placement="right" popover-trigger="\'focus\'" uib-popover="{{\'Delay before sending the operation to the next device.\' | translate}}"><i c8y-icon="question-circle-o"></i></a>\n      </dt>\n      <dd>{{operation.creationRamp | duration}}</dd>\n      <dt translate>Status</dt>\n      <dd>\n      <i c8y-icon="{{statusIcon(operation)}}" ng-class="statusClass(operation)"></i> {{statusLabel(operation) | translate}}\n      <span ng-if="operation.progress.pending || operation.progress.executing" class="text-muted" translate>\n        (updated every minute)\n      </span>\n        <div ng-if="operation.progress.pending || operation.progress.executing || operation.progress.successful || operation.progress.failed">\n          <i c8y-icon="{{singleOpStatusIcon(\'pending\')}}" ng-class="singleOpStatusClass(\'pending\')"></i> {{\'Pending\' | translate}}: {{operation.progress.pending}},\n          <i c8y-icon="{{singleOpStatusIcon(\'executing\')}}" ng-class="singleOpStatusClass(\'executing\')"></i> {{\'Executing\' | translate}}: {{operation.progress.executing}},\n          <i c8y-icon="{{singleOpStatusIcon(\'successful\')}}" ng-class="singleOpStatusClass(\'successful\')"></i> {{\'Successful\' | translate}}: {{operation.progress.successful}},\n          <i c8y-icon="{{singleOpStatusIcon(\'failed\')}}" ng-class="singleOpStatusClass(\'failed\')"></i> {{\'Failed\' | translate}}: {{operation.progress.failed}}\n        </div>\n      </dd>\n    </dl>\n  </div>\n  <div class="col-sm-9">\n    <div class="legend form-block" translate>Operation</div>\n    <pre style="white-space: pre-wrap">{{operation.operationPrototype|json:2}}</pre>\n\n    <div ng-if="operation.operations.length">\n      <div class="legend form-block" translate>Operations</div>\n        <div class="list-group">\n          <div class="list-group-item collapsible" ng-class="{\'expanded\': displayOptions.showDetails}" ng-repeat="op in operation.operations | orderBy:sortOperationsListByTime:true track by op.id" ng-init="displayOptions = getSingleOperationDisplayOptions()">\n            <div device-control-single-operation-row-summary operation="op" display-options="displayOptions">\n            </div> \n            <div ng-if="displayOptions.showDetails" device-control-single-operation-row-details operation="op">\n            </div>\n          </div>\n        </div>\n      </div>\n  </div>\n</div>\n',e.put("devicemanagement_deviceBulkControl/views/bulkOperationRowDetails.html",t),e.put("/apps/devicemanagement/deviceBulkControl/views/bulkOperationRowDetails.html",t),t='<div class="flex-row" ng-class="{\'realtime-animation-list\': realtimeAnimation}">\n  <div class="list-item-actions">\n    <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn" ng-class="{\'active\':isOpen}" ng-click="toggle(operation); isOpen = !isOpen">\n      <i c8y-icon="chevron-down"></i>\n    </button>\n    <span class="dropdown settings" is-open="isopen" uib-dropdown>\n      <button class="dropdown-toggle c8y-dropdown btn-link" uib-dropdown-toggle>\n          <i c8y-icon="ellipsis-v"></i>\n      </button>\n      <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n        <li ng-show="displayOptions.showEditable && canCancel(operation)">\n          <button ng-click="cancel(operation)">\n            <i c8y-icon="times"></i> {{\'Cancel operation\' | translate}}\n          </button>\n        </li>\n        <li ng-show="displayOptions.showEditable && canRetryFailed(operation)">\n          <button ng-click="retryFailed(operation)">\n            <i c8y-icon="refresh"></i> {{\'Retry failed\' | translate}}\n          </button>\n        </li>\n        <li ng-show="displayOptions.showEditable && canEdit(operation)">\n          <button ng-click="edit(operation)">\n            <i c8y-icon="pencil"></i> {{\'Edit operation schedule\' | translate}}\n          </button>\n        </li>\n      </ul>\n    </span>\n  </div>\n  <div class="list-item-icon">\n    <a name="bulk-operation-{{operation.id}}" class="text-gray-medium-dark">\n      <i c8y-icon="{{statusIcon(operation)}}" ng-class="statusClass(operation)" uib-tooltip="{{statusLabel(operation)}}"></i>\n    </a>\n  </div>\n  <div class="list-item-body">\n    <div class="flex-row">\n      <div class="col-md-5">\n        <span class="interact" ng-click="toggle(operation);isOpen = !isOpen">{{getOperationDesc(operation) | translate}}</span>\n        <span ng-if="displayOptions.showGroupLink" ng-mouseover="checkGroupLink(operation)">\n          <span class="text-muted" ng-if="groupStillExists === undefined">\n            <br><small>\n              <i c8y-icon="folder-open"></i>\n              {{\'Group\' | translate}} {{operation.groupId}}\n            </small>\n          </span>\n          <span class="text-muted" ng-if="groupStillExists === false" uib-tooltip="{{\'This group has already been removed.\' | translate}}">\n            <br><small>\n              <i c8y-icon="folder-open"></i>\n              <del>{{\'Group\' | translate}} {{operation.groupId}}</del>\n            </small>\n          </span>\n          <a class="text-muted" ng-href="#/group/{{operation.groupId}}" ng-if="groupStillExists === true">\n            <br><small>\n              <i c8y-icon="folder-open"></i>\n              {{\'Group\' | translate}} {{operation.groupId}}\n            </small>\n          </a>\n        </span>\n      </div>\n      <div class="col-md-3 col-xs-8" ng-click="toggle(operation);isOpen = !isOpen">\n        <div ng-if="displayOptions.showProgressBar && progressBar">\n          <uib-progress style="margin-bottom: 0" animate="isInStatus(operation, \'EXECUTING\')">\n            <uib-bar ng-repeat="bar in progressBar track by $index" type="{{bar.type}}" value="bar.value">\n              <span ng-hide="bar.value < 5" uib-tooltip="{{bar.tooltip}}: {{bar.value | number:0}}%">\n                <i c8y-icon="{{singleOpStatusIcon(bar.status)}}"></i> {{bar.value | number:0}}%\n              </span>\n            </uib-bar>\n          </uib-progress>\n        </div>\n      </div>\n      <div class="col-md-4 col-xs-12" ng-click="toggle(operation);isOpen = !isOpen">\n        <small class="text-muted">\n          <i c8y-icon="calendar"></i> {{operation.startDate | absoluteDate}}\n        </small>\n      </div>\n    </div>\n  </div>\n</div>\n',e.put("devicemanagement_deviceBulkControl/views/bulkOperationRowSummary.html",t),e.put("/apps/devicemanagement/deviceBulkControl/views/bulkOperationRowSummary.html",t),t='<form name="bulkOperationDetailsForm" novalidate>\n  <div class="modal-header">\n    <h3 translate>Execute operation for whole group</h3>\n  </div>\n  <div class="modal-body">\n    <div class="form-group" ng-if="!operation.id" style="position:relative;z-index:1000">\n      <label class="form-label" translate>Target group</label>\n      <div class="form-group">\n        <ui-select ng-model="operation.groupId" class="form-control" required>\n          <ui-select-match placeholder="{{\'Select or search group\' | translate}}">{{$select.selected.name}}</ui-select-match>\n          <ui-select-choices repeat="group.id as group in groups | filter: $select.search | orderBy:\'name\'">\n            <div ng-bind-html="group.name | highlight: $select.search"></div>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="form-label" translate>Start date</label>\n      <div class="form-group clearfix">\n        <div class="form-group datepicker pull-left" style="margin-right: 10px">\n          <input class="form-control" placeholder="{{\'Start date\' | translate}}" style="width: 125px; text-align:center" required is-open="openStartDate" uib-datepicker-popup show-button-bar="false" show-weeks="0" ng-model="operation.startDate" ng-click="openStartDate=true">\n        </div>\n        <div class="form-group timeField">\n          <div uib-timepicker ng-model="operation.startDate" show-spinners="false" show-meridian="false" required></div>\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="form-label"><span translate>Delay</span>&nbsp;<i c8y-icon="question-circle" uib-tooltip="{{\'Delay before sending the operation to the next device.\' | translate}}"></i></label>\n      <div class="form-group">\n        <c8y-duration-input ng-model="operation.creationRamp"></c8y-duration-input>\n      </div>\n    </div>\n    <div class="form-group">\n      <button class="btn btn-link" ng-click="showOperationDetails = !showOperationDetails">\n        <span ng-hide="showOperationDetails" translate>Show</span>\n        <span ng-show="showOperationDetails" translate>Hide</span>\n        {{\'operation details\' | translate}}\n      </button>\n      <div class="form-group" ng-show="showOperationDetails">\n        <textarea c8y-code-editor="json" class="form-control" name="operation" ng-model="operation.operationPrototype" style="height: 250px" required></textarea>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-primary" ng-disabled="bulkOperationDetailsForm.$invalid" ng-click="save(operation)">\n      <span ng-hide="operation.id" translate>Create</span>\n      <span ng-show="operation.id" translate>Reschedule</span>\n    </button>\n    <button class="btn btn-default" ng-click="dismiss()" translate>Cancel</button>\n  </div>\n</form>\n',e.put("devicemanagement_deviceBulkControl/views/details.html",t),e.put("/apps/devicemanagement/deviceBulkControl/views/details.html",t),t='<div ng-controller="bulkOperationsListCtrl" class="bulk-operations-list">\n  <c8y-ui-action-bar-set>\n    <button type="button" class="btn btn-link c8y-realtime" title="{{\'Toggle realtime\' | translate}}" ng-click="realtime.toggle()">\n      <span class="c8y-pulse" ng-class="{active: realtime.state(), inactive: !realtime.state()}"></span>\n      {{\'Realtime\' | translate}}\n    </button>\n\n    <c8y-refresh-btn></c8y-refresh-btn>\n  </c8y-ui-action-bar-set>\n\n    <div class="c8y-empty-state text-center" ng-show="operations.length == 0">\n      <h1 class="c8y-icon c8y-icon-energy c8y-icon-duocolor"></h1>\n      <h3 translate>No bulk operations found.</h3>\n    </div>\n\n    <div class="list-group">\n      <div class="list-group-item" ng-repeat="op in operations">\n        <div device-control-bulk-operation-row-summary operation="op" display-options="operationDisplayOptions[op.id]" on-edited="refresh()"></div>\n        <div ng-if="operationDisplayOptions[op.id].showDetails" device-control-bulk-operation-row-details operation="op"></div>\n      </div>\n    </div>\n\n    <c8y-load-more change-page-size></c8y-load-more>\n  </div>\n',e.put("devicemanagement_deviceBulkControl/views/list.html",t),e.put("/apps/devicemanagement/deviceBulkControl/views/list.html",t)}angular.module("c8y.deviceBulkControl").run(["$templateCache",e])}();