/* administration_pluginEditor 8.21.0 2018-01-30T22:07:39+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function t(t,n){t.when("/applications/:applicationId",{templateUrl:"administration_pluginEditor/plugins.html",icon:"plug",name:n("Plugins"),showIf:["$routeParams","c8yApplication",function(t,n){return!(!t.applicationId||"new"===t.applicationId)&&n.detail(t.applicationId).then(function(t){return!_.isEmpty(t.data.manifest)})}]})}angular.module("c8y.pluginEditor",[]).config(["c8yViewsProvider","gettext",t])}(),function(){"use strict";function t(t){function n(){return t.applicationId}var i=this;i.getApplicationId=n}angular.module("c8y.pluginEditor").controller("c8yPluginsTabCtrl",["$routeParams",t])}(),function(){"use strict";function t(){return{restrict:"E",scope:{application:"&"},controller:"c8ySmartAppPluginEditorCtrl",controllerAs:"ctrl",templateUrl:"administration_pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html"}}angular.module("c8y.pluginEditor").directive("c8ySmartAppPluginEditor",t)}(),function(){"use strict";function t(t,n,i,a,l,e){function r(){s()}function s(){a.listPlugins().then(c)}function c(t){w=_.map(t,"manifest"),x.plugins=C=_.filter(w,function(t){return t.list!==!1}),C.sort(function(t,n){return t.name.toLowerCase()>n.name.toLowerCase()?1:-1}),o(C)}function o(t){var n=[];n.push(e("- Show all")),t.forEach(function(t){t.category&&n.indexOf(t.category)===-1&&n.push(t.category)}),x.categories=n.map(function(t){return{display:t,val:"- Show all"===t?"":t}})}function p(){u()}function u(){var n=a.detail(t.application()).then(i.getResData);n.then(function(t){return a.isPaasApp(t).then(function(t){x.isSmartApp=!t})}),n.then(function(t){return t.manifest}).then(g).then(d)}function g(t){return t.imports=_.uniq(t.imports),t}function d(t){x.manifest=t}function m(t){return _.find(w,function(n){return n.rootContextPath===t})||{}}function f(t){return t&&t.rootContextPath&&t.rootContextPath.split("/")[0]}function v(t){var n=x.manifest&&x.manifest.imports||[];return n.indexOf(t.rootContextPath)===-1}function h(t){x.manifest.imports||(x.manifest.imports=[]),_.includes(x.manifest.imports,t.rootContextPath)?l.warning(e("Plugin already subscribed!")):x.manifest.imports.push(t.rootContextPath)}function y(t){x.manifest.imports=_.without(x.manifest.imports,t)}function P(n){a.updateManifest(t.application(),g(n)).then(function(){l.success(e("Application manifest updated!"))})}function b(t){k=k!==t?t:null}function A(t){return k===t}function E(t,i,a){t.stopPropagation();var l='<img ng-src="{{src}}" style="max-width:100%">';n.open({template:l,controller:["$scope",function(t){t.src="/apps/"+i.rootContextPath+"/"+a}]})}var x=this,w=[],C=[],k=null;x.plugins=C,x.getPlugin=m,x.getPluginContextApp=f,x.subscribe=h,x.unsubscribe=y,x.notSubscribedFilter=v,x.updateManifest=P,x.openItem=b,x.isOpen=A,x.openScr=E,x.filter={},t.$watch("application()",p,!0),r()}t.$inject=["$scope","$uibModal","c8yBase","c8yApplication","c8yAlert","gettext"],angular.module("c8y.pluginEditor").controller("c8ySmartAppPluginEditorCtrl",t)}(),function(){"use strict";function t(){return{restrict:"E",scope:{application:"&"},controller:"c8yPaasPluginEditorCtrl",controllerAs:"ctrl",templateUrl:"administration_pluginEditor/paasPluginEditor/paasPluginEditor.html"}}angular.module("c8y.pluginEditor").directive("c8yPaasPluginEditor",t)}(),function(){"use strict";function t(t,n,i,a,l,e,r){function s(){return c()}function c(){return i.detail(t.application()).then(n.getResData).then(i.isPaasApp).then(function(n){if(m.isPaasApp=n,n)return i.listPluginsByPaasApp(t.application()).then(function(t){m.plugins=_.filter(t,"pluginPackage")}).then(o)})}function o(){m.categories=_(m.plugins).map(function(t){return t.pluginPackage&&t.pluginPackage.category}).filter(_.identity).uniq().map(function(t){return{value:t,label:t}}).value(),m.categories.push({value:void 0,label:e("- Show all -")})}function p(t){var n=/(?:\.([^.]+))?$/;return"zip"===n.exec(t.name)[1]}function u(t){return!f.category||t.pluginPackage&&t.pluginPackage.category===f.category}function g(){var n=m.pluginArchives[0].file;return p(n)?(v.label=e("Uploading archive"),v.progress=0,v.inProgress=!0,void i.addPaasAppPlugin(t.application(),m.pluginArchives[0].file).progress(function(t){v.progress=t.loaded/t.total*90,v.progress>=90&&(v.label=e("Updating application"))}).then(s).then(function(){l.success(e("Plugin successfully added to application!"))}).finally(function(){v.inProgress=!1,v.progress=0})):void l.danger(e("Selected file is not a ZIP archive! Please choose appropriate file."))}function d(n){return a({title:e("Are you sure?"),body:r.getString('Do you really want to remove plugin "{{pluginPackage.name || pluginName}}"?',n),status:"danger"}).then(_.partial(i.removePaasAppPlugin,t.application(),n.pluginName)).then(s).then(function(){l.success(r.getString('Plugin "{{pluginPackage.name || pluginName}}" removed from application!',n))})}var m=this,f={category:void 0},v={inProgress:!1,progress:0};m.processingStatus=v,m.filter=f,m.filterByCategory=u,m.onFileSelected=g,m.removePlugin=d,t.$watch("application()",s,!0)}t.$inject=["$scope","c8yBase","c8yApplication","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.pluginEditor").controller("c8yPaasPluginEditorCtrl",t)}(),function(){"use strict";function t(t){var n;n='<div ng-if="ctrl.isPaasApp">\n  <c8y-ui-action-bar-set>\n    <li class="navbar-form" action-bar-position="left">\n        <label translate>Filter by category</label>\n        <div class="c8y-select-wrapper">\n          <select class="form-control" style="min-width: 180px" ng-model="ctrl.filter.category" ng-options="category.value as (category.label | translate) for category in ctrl.categories | orderBy:\'label | translate\'">\n          </select>\n          <span></span>\n        </div>\n      </li>\n  </c8y-ui-action-bar-set>\n\n  <div class="row">\n    <div class="col-sm-8">\n      <ul class="list-group">\n        <li class="list-group-item flex-row" ng-repeat="plugin in ctrl.plugins | filter:ctrl.filterByCategory | orderBy:\'pluginPackage.name | translate\'">\n          <div class="list-item-icon">\n            <i c8y-icon="plug"></i>\n          </div>\n          <div class="list-item-body">\n            <div class="row">\n              <div class="col-sm-8">\n                <strong><span ng-bind="plugin.pluginPackage.name | translate"></span></strong><br>\n                <small class="text-muted" ng-bind="plugin.pluginPackage.description | translate"></small><br>\n                <small class="label label-primary text-truncate" title="{{plugin.pluginPackage.category | translate}}" ng-bind="plugin.pluginPackage.category | translate"></small>\n              </div>\n              <div class="col-sm-4 showOnHover text-right">\n                <button class="btn btn-xs btn-danger top-m-sm" ng-click="ctrl.removePlugin(plugin)">\n                  <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                </button>\n              </div>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n\n    <div class="col-sm-4">\n      <file-picker files="ctrl.pluginArchives" multiple="false" required="true" display-drop-zone="true" drop-zone-label="\'Add plugin\' | translate" on-file-selected="ctrl.onFileSelected()" processing-status="ctrl.processingStatus">\n      </file-picker>\n    </div>\n  </div>\n\n</div>\n',t.put("administration_pluginEditor/paasPluginEditor/paasPluginEditor.html",n),t.put("/apps/administration/pluginEditor/paasPluginEditor/paasPluginEditor.html",n),n='<div ng-controller="c8yPluginsTabCtrl as ctrl">\n  <c8y-paas-plugin-editor application="ctrl.getApplicationId()"></c8y-paas-plugin-editor>\n  <c8y-smart-app-plugin-editor application="ctrl.getApplicationId()"></c8y-smart-app-plugin-editor>\n</div>\n',t.put("administration_pluginEditor/plugins.html",n),t.put("/apps/administration/pluginEditor/plugins.html",n),n='<div ng-if="ctrl.isSmartApp">\n  <div ng-if="ctrl.manifest">\n    <div class="card-group">\n      <div class="col-lg-6 col-xs-12">\n        <div class="card">\n          <div class="card-header">\n            <h4 class="card-title" translate>Subscribed plugins</h4>\n          </div>\n          <hr>\n          <ul class="list-group">\n            <li class="list-group-item interact" ng-repeat="p in ctrl.manifest.imports track by $index" ng-click="ctrl.openItem(p)">\n              <a href="" ng-click="ctrl.unsubscribe(p)" class="btn btn-danger pull-right btn-xs showOnHover" translate>Unsubscribe</a>\n              {{ctrl.getPlugin(p).name}} <span class="text-muted">{{ctrl.getPluginContextApp(ctrl.getPlugin(p))}}</span>\n              <div uib-collapse="!ctrl.isOpen(p)">\n                <p ng-show="ctrl.getPlugin(p).category">\n                  <b>{{\'Category\' | translate}}:</b> {{ctrl.getPlugin(p).category}}\n                </p>\n                <p class="text-muted">{{ctrl.getPlugin(p).description}}</p>\n              </div>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="col-lg-6 col-xs-12">\n        <div class="card">\n          <div class="card-header">\n            <h4 class="card-title" translate>Available plugins</h4>\n          </div>\n          <hr>\n          <div class="card-block">\n            <div class="row">\n              <div class="col-sm-6">\n                <div class="form-inline" style="margin-bottom: 16px">\n                  <label class="control-label" translate>Categories</label>\n                  <div class="c8y-select-wrapper">\n                    <select ng-options="cat.val as (cat.display | translate) for cat in ctrl.categories" ng-model="ctrl.filter.category" class="form-control"></select>\n                    <span></span>\n                  </div>\n                </div>\n              </div>\n              <div class="col-sm-6">\n                <div class="input-group input-group-search">\n                  <input type="search" class="form-control" placeholder="{{\'Filterâ€¦\' | translate}}" ng-model="ctrl.filter.$">\n                  <span class="input-group-addon">\n                    <i c8y-icon="search" ng-show="ctrl.filter.$.length === 0 || !ctrl.filter.$ "></i>\n                    <i c8y-icon="times" class="text-muted" ng-show="ctrl.filter.$.length > 0" ng-click="ctrl.filter.$ = \'\'"></i>\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="card-inner-scroll" style="height: calc( 100vh - 410px); min-height: 300px">\n            <ul class="list-group">\n              <li class="list-group-item interact" ng-repeat="p in ctrl.plugins | filter:ctrl.filter" ng-click="ctrl.openItem(p)">\n                <a href="" ng-click="ctrl.subscribe(p)" class="btn btn-primary pull-right btn-xs showOnHover" translate>Subscribe</a>\n                {{p.name | translate}} <span class="text-muted">{{ctrl.getPluginContextApp(p)}}</span>\n                <div uib-collapse="!ctrl.isOpen(p)">\n                  <p ng-show="p.category">\n                    <b>{{\'Category\' | translate}}:</b> {{p.category | translate}}\n                  </p>\n                  <p class="text-muted">{{p.description | translate}}</p>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n    <button type="button" class="btn btn-primary" ng-click="ctrl.updateManifest(ctrl.manifest)" translate>Save</button>\n  </div>\n</div>\n',t.put("administration_pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html",n),t.put("/apps/administration/pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html",n)}angular.module("c8y.pluginEditor").run(["$templateCache",t])}();