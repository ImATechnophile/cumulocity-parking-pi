/* core_connectivity 8.21.0 2018-01-30T22:08:00+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function s(s,n){function t(s,t,e,a,i,r,l){function o(n){m=n[1];var t=n[0];return t.valid&&m.c8y_Mobile&&m.c8y_Mobile.iccid?void(u=t.url.split("/").slice(0,3).join("/")):s.reject()}function c(){if(!m.c8y_Mobile.c8y_IsConnectivity)return i.getTerminalDetails(v,{},{},{silentError:!0}).then(function(){return m.c8y_Mobile.c8y_IsConnectivity={},r.save(m)})}function d(){var t=m.c8y_Mobile.iccid,a=[{text:n("SIM details"),action:function(){var s=u+"/provision/ui/terminals/sims/simDetails.html?iccid="+t+"&dss=false&tabName=connections";window.open(s,"_blank")}}];return s.when(_.forEach(a,function(s){e.addAction(s)}))}var m,u,v=t.deviceId,g=l.detail(),p=r.detailCached(v).then(a.getResData),b=s.all([g,p]),h=i.safePing();return b.then(o).then(h).then(c).then(d).then(function(){return!0}).catch(function(){return!1})}s.when("/device/:deviceId",{templateUrl:"core_connectivity/views/index.html",name:n("Connectivity"),icon:"plug",showIfPermissions:{anyRole:["ROLE_CONNECTIVITY_READ"]},showIf:["$q","$routeParams","c8yActions","c8yBase","c8yConnectivity","c8yDevices","c8yConnectivitySettings",t]})}angular.module("c8y.connectivity",[]).config(["c8yViewsProvider","gettext",s])}(),function(){"use strict";function s(s,n,t,e,a,i,r,l,o){function c(){s.terminal&&n.all([d(),S(),f(),b()]).then(O).then(H)}function d(){u(),v(),g()}function m(s){if(s.dateFrom){var n=s.dateFrom;s.dateFrom=moment(n).format("ll"),s.cycleStartDate=moment(n).format("YYYY-MM-DD")}s.dateTo?s.dateTo=moment(s.dateTo).format("ll"):s.dateTo=moment().format("ll")}function u(){var n=_.find(J.statuses,function(n){return n.status===s.terminal.status});s.currentStatus=n.status}function v(){s.statusIcon=J.icons[s.terminal.suspended].icon}function g(){s.statusClass=J.icons[s.terminal.suspended].class}function p(s){Q.Data=s.usageDetails?(_.reduce(s.usageDetails,function(s,n){return s+n.dataVolume},0)/1e3).toFixed(3):0}function b(){return l.getTerminalDataUsage(t.deviceId,{},W).then(p)}function h(s){Q.Voice=s.voiceUsageDetails?_.reduce(s.voiceUsageDetails,function(s,n){return s+n.callDuration},0).toFixed(3):0}function f(){return l.getTerminalVoiceUsage(t.deviceId,{},W).then(h)}function y(s){return Q.Sms=s.smsUsageDetails?s.smsUsageDetails.length:0,s}function S(){return l.getTerminalSmsUsage(t.deviceId,{},W).then(y)}function x(s){var n={type:e(s),today:K.dateTo,thisMonthStart:K.dateFrom,lastMonthStart:W.dateFrom,lastMonthEnd:W.dateTo,lastMonthUsage:Q[s]};return a.getString("{{type}} usage this month to date ({{thisMonthStart}} - {{today}})\nUsage for last month ({{lastMonthStart}} - {{lastMonthEnd}}): {{lastMonthUsage}}",n)}function D(){var s=e("SIM status successfully changed");return i.success(s)}function T(s){return l.setTerminalSimStatus(t.deviceId,{targetValue:s}).then(function(){return n.all([N(),k()])}).then(c).then(D)}function w(){var n=e("SMS successfully sent");return s.message.messageText="",s.forms.messageForm.$setPristine(),i.success(n)}function I(s){return l.sendSms(t.deviceId,s).then(R).then(w)}function M(n){s.terminal=_.merge(X.terminal,_.head(n.terminals))}function A(n){n.sessionInfo?n.sessionInfo[0].inSession=e("Yes"):n.sessionInfo=[{inSession:e("No")}],s.session=_.head(n.sessionInfo)}function E(n){s.smss=n.smsMessages}function C(n){s.auditLogs=n.terminalAuditTrails}function F(n){s.sessions=n.usageDetails}function N(){return l.getTerminalDetails(t.deviceId).then(M)}function U(){return l.getTerminalSessionInfo(t.deviceId).then(A)}function R(){return l.getSms(t.deviceId).then(E)}function k(){return l.getTerminalAuditLogs(t.deviceId).then(C)}function L(){return l.getTerminalDataUsage(t.deviceId,{},K).then(F)}function O(){s.dataUsageTooltip=x("Data"),s.smsUsageTooltip=x("Sms"),s.voiceUsageTooltip=x("Voice")}function V(){return n.all([N(),U(),R(),k(),L()])}function P(){return l.safePing()}function Y(){return P().then(V).then(c)}function q(){K=r.monthFilter(),W=r.monthFilter({},1),delete K.dateTo,m(K),m(W)}function $(n){s.isAdmin=n}function B(){return o.hasAnyRole(["ROLE_CONNECTIVITY_ADMIN"]).then($)}function H(){s.loading=!1}function j(){return s.loading=!0,n.all([Y(),B()])}function z(){q(),j()}function G(s){return r.validationHints(s,ss)}var K,W,J={statuses:[{status:"ACTIVATED_NAME",text:e("Activated"),readOnly:!1},{status:"ACTIVATION_READY_NAME",text:e("Activation ready"),readOnly:!1},{status:"DEACTIVATED_NAME",text:e("Deactivated"),readOnly:!1},{status:"INVENTORY_NAME",text:e("Inventory"),readOnly:!1},{status:"PURGED_NAME",text:e("Purged"),readOnly:!0},{status:"REPLACED_NAME",text:e("Replaced"),readOnly:!0},{status:"RETIRED_NAME",text:e("Retired"),readOnly:!1},{status:"TEST_READY_NAME",text:e("Test ready"),readOnly:!0},{status:"TRIAL_NAME",text:e("Trial"),readOnly:!0}],icons:{N:{icon:"check-circle",class:"statusOk"},Y:{icon:"exclamation-circle",class:"statusNok"},F:{icon:"wrench",class:"statusAlert"}}},Q={},X={terminal:{fixedIpAddress:"-"}},Z="messageForm",ss={required:e("This field is required!")};s.message={},s.forms={},s.currentStatus="",s.loading=!0,s.statusMap=J,s.sendSms=I,s.setSimStatus=T,s.isAdmin=!1,s.reload=Y,s.validationHints=G,s.invalid=angular.bind(r,r.invalid,s.forms,Z),z()}angular.module("c8y.connectivity").controller("connectivityCtrl",["$scope","$q","$routeParams","gettext","gettextCatalog","c8yAlert","c8yBase","c8yConnectivity","c8yPermissions",s])}(),function(){"use strict";function s(s){var n;n='<div class="card" ng-show="auditLogs.length > 0">\r\n  <div class="card-header">\r\n    <h4 class="card-title">{{\'Audit logs\' | translate }}</h4>\r\n  </div>\r\n  <hr>\r\n  <div class="card-block">\r\n    <div class="timeline-list list-condensed">\r\n      <div class="timeline-list-item flex-row" ng-repeat="auditLog in auditLogs">\r\n        <small class="timeline-item-date">\r\n          {{auditLog.effectiveDate | absoluteDate}}\r\n        </small>\r\n        <div class="timeline-item-content flex-row wrap">\r\n          <div class="list-item-icon">\r\n            <i c8y-icon="archive"></i>\r\n          </div>\r\n          <div class="list-item-body">\r\n            <div class="row">\r\n              <div class="col-sm-5">\r\n                <label class="small" translate>Changed</label> <span ng-bind="auditLog.field"></span><br>\r\n                <label class="small" translate>Who</label> <span ng-bind="auditLog.userName"></span>\r\n              </div>\r\n              <div class="col-sm-5">\r\n                <label class="small" translate>From</label> <span ng-bind="auditLog.priorValue"></span><br>\r\n                <label class="small" translate>To</label> <span ng-bind="auditLog.value"></span>\r\n              </div>\r\n              <div class="col-sm-2">\r\n                <label class="small" translate>Status</label> <span ng-bind="auditLog.status"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n',s.put("core_connectivity/views/auditLogs.html",n),s.put("/apps/core/connectivity/views/auditLogs.html",n),n='<div ng-controller="connectivityCtrl" class="connectivity-plugin">\r\n  <c8y-ui-action-bar-set>\r\n    <button type="button" class="btn btn-link" ng-click="reload()">\r\n      <i c8y-icon="refresh"></i> {{\'Reload\' | translate}}\r\n    </button>\r\n  </c8y-ui-action-bar-set>\r\n\r\n  <div ng-include="\'core_connectivity/views/status.html\'"></div>\r\n  <div ng-include="\'core_connectivity/views/sms.html\'"></div>\r\n\r\n  <div ng-include="\'core_connectivity/views/sessions.html\'"></div>\r\n  <div ng-include="\'core_connectivity/views/auditLogs.html\'"></div>\r\n\r\n</div>\r\n',s.put("core_connectivity/views/index.html",n),s.put("/apps/core/connectivity/views/index.html",n),n='\r\n<div class="card" ng-show="sessions.length > 0">\r\n  <div class="card-header">\r\n    <h4 class="card-title">{{\'Sessions\' | translate }}</h4>\r\n  </div>\r\n  <hr>\r\n  <div class="list-group">\r\n    <div class="list-group-item flex-row" ng-repeat="session in sessions">\r\n      <div class="list-item-icon">\r\n        <i c8y-icon="exchange"></i>\r\n      </div>\r\n\r\n      <div class="list-item-body">\r\n        <div class="row">\r\n          <div class="col-sm-3">\r\n            <label class="small" translate>Customer</label><br class="visible-sm"> <span ng-bind="session.customer"></span>\r\n          </div>\r\n          <div class="col-sm-3">\r\n            <label class="small" translate>Started</label><br class="visible-sm"> <span ng-bind="session.sessionStartTime | absoluteDate"></span>\r\n          </div>\r\n          <div class="col-sm-3">\r\n            <label class="small" translate>Duration</label><br class="visible-sm"> <span ng-bind="session.duration | duration"></span>\r\n          </div>\r\n          <div class="col-sm-3">\r\n            <label class="small" translate>Data usage (KB)</label><br class="visible-sm"> <span ng-bind="session.dataVolume"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n',s.put("core_connectivity/views/sessions.html",n),s.put("/apps/core/connectivity/views/sessions.html",n),n='<div class="card" ng-show="smss.length > 0 || isAdmin">\r\n  <div class="card-header">\r\n    <h4 class="card-title">  {{\'SMS\' | translate }}</h4>\r\n  </div>\r\n  <hr>\r\n\n  <div class="list-group">\r\n    <div class="list-group-item flex-row collapsible" ng-class="{\'expanded\': isDetailExpanded}" ng-repeat="sms in smss" ng-click="isDetailExpanded = !isDetailExpanded">\r\n\r\n      <div class="list-item-actions">\r\n        <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn">\r\n          <i c8y-icon="chevron-down"></i>\r\n        </button>\r\n      </div>\r\n\r\n      <div class="list-item-icon">\r\n        <i c8y-icon="envelope-o"></i>\r\n      </div>\r\n\r\n      <div class="list-item-body">\r\n        <div class="row">\r\n          <div class="col-sm-3">\r\n            <label class="small" translate>SMS ID</label><br class="visible-sm"> <span ng-bind="sms.smsMsgId"></span>\r\n          </div>\r\n          <div class="col-sm-4">\r\n            <label class="small" translate>Date sent</label><br class="visible-sm"> <span>{{sms.dateSent | date:\'d MMM y h:mm\'}}</span>\r\n          </div>\r\n          <div class="col-sm-4">\r\n            <label class="small" translate>Date received</label><br class="visible-sm"> <span>{{sms.dateReceived | date:\'d MMM y h:mm\'}}</span>\r\n          </div>\r\n          <div class="col-sm-1 text-right">\r\n            <div class="text-left visible-xs">\r\n              <label class="small" translate>Status</label> {{sms.status}}\r\n              <i ng-show="sms.status ==\'Delivered\' || sms.status ==\'Received\'" class="text-success" c8y-icon="check"></i>\r\n              <i ng-show="sms.status ==\'Pending\'" class="text-info" c8y-icon="ellipsis-h"></i>\r\n              <i ng-show="sms.status ==\'Failed\'" class="text-danger" c8y-icon="exclamation-circle"></i>\r\n            </div>\r\n            <div class="hidden-xs">\r\n              <i ng-show="sms.status ==\'Delivered\' || sms.status ==\'Received\'" class="text-success" c8y-icon="check" uib-tooltip="{{sms.status}}"></i>\r\n              <i ng-show="sms.status ==\'Pending\'" class="text-info" c8y-icon="ellipsis-h" uib-tooltip="{{sms.status}}"></i>\r\n              <i ng-show="sms.status ==\'Failed\'" class="text-danger" c8y-icon="exclamation-circle" uib-tooltip="{{sms.status}}"></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n       <div class="collapse" uib-collapse="!isDetailExpanded">\r\n         <div class="flex-row">\r\n            <div class="list-item-icon"></div>\r\n            <div class="list-item-body">\r\n             <div class="row top-m bottom-m">\r\n               <span style="width: 35px; float: left" class="visible-xs"></span>\r\n               <div class="col-sm-4">\r\n                 <label class="small" translate>Sent from</label> <small ng-bind="sms.sentFrom"></small><br>\r\n                 <label class="small" translate>Sent to</label> <small ng-bind="sms.sentToIccid"></small><br>\r\n                 <label class="small" translate>Message type</label> <small ng-bind="sms.msgType"></small>\r\n               </div>\r\n               <div class="col-sm-8">\r\n                 <label class="small" translate>Message text</label>\r\n                 <p>{{sms.messageText}}</p>\r\n               </div>\r\n             </div>\r\n           </div>\r\n       </div>\r\n\r\n    </div>\r\n  </div>\r\n\r\n  <!-- <table class="table" ng-show="smss.length > 0">\r\n    <thead>\r\n      <tr>\r\n        <th translate>SMS ID</th>\r\n        <th translate>Date sent</th>\r\n        <th translate>Date received</th>\r\n        <th translate>Message text</th>\r\n        <th translate>Sent from</th>\r\n        <th translate>Sent to</th>\r\n        <th translate>Status</th>\r\n        <th translate>Message type</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr ng-repeat="sms in smss">\r\n        <td ng-bind="sms.smsMsgId"></td>\r\n        <td ng-bind="sms.dateSent | absoluteDate"></td>\r\n        <td ng-bind="sms.dateReceived | absoluteDate"></td>\r\n        <td ng-bind="sms.messageText"></td>\r\n        <td ng-bind="sms.sentFrom"></td>\r\n        <td ng-bind="sms.sentToIccid"></td>\r\n        <td ng-bind="sms.status"></td>\r\n        <td ng-bind="sms.msgType"></td>\r\n      </tr>\r\n    </tbody>\r\n  </table> -->\r\n  <div class="card-block">\r\n    <div class="legend form-block" translate>Send SMS</div>\r\n    <form name="forms.messageForm" ng-if="isAdmin">\r\n      <div class="form-group" ng-class="{\'has-error\': invalid(\'mText\')}" uib-tooltip="{{validationHints(forms.messageForm.mText)}}">\r\n        <textarea required ng-model="message.messageText" name="mText" class="form-control form-group" rows="3"></textarea>\r\n      </div>\r\n\r\n      <div class="form-group">\r\n        <button ng-disabled="messageForm.$invalid" class="btn btn-primary" translate ng-click="sendSms(message)">Send</button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</div>\r\n</div>',s.put("core_connectivity/views/sms.html",n),s.put("/apps/core/connectivity/views/sms.html",n),n='<div class="card">\r\n  <div class="card-header">\r\n    <h4 class="card-title" translate>Status</h4>\r\n  </div>\r\n  <hr>\r\n  <div class="card-block">\r\n    <form name="forms.terminalForm">\r\n      <div class="row">\r\n        <div class="col-md-4 col-sm-3">\r\n          <div class="form-group">\r\n            <label class="small" translate>In session</label>\r\n            <p ng-bind="session.inSession | translate"></p>\r\n          </div>\r\n        </div>\r\n        <div class="col-md-4 col-sm-5">\r\n          <div class="form-group">\r\n            <label class="small" translate>Session start</label>\r\n            <span ng-show="session.inSession === \'Yes\'">\r\n              <p ng-bind="session.dateSessionStarted | absoluteDate"></p>\r\n            </span>\r\n            <p ng-show="session.inSession !== \'Yes\'">\r\n              -\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div class="col-md-4 col-sm-4">\r\n          <div class="form-group">\r\n            <label class="small" translate>Session IP address</label>\r\n            <span ng-show="session.inSession === \'Yes\'">\r\n              <p ng-bind="session.ipAddress"></p>\r\n            </span>\r\n            <p ng-show="session.inSession !== \'Yes\'">\r\n              -\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="col-md-4">\r\n          <div class="form-group">\r\n            <label class="small" translate>ICCID</label>\r\n            <p ng-bind="terminal.iccid"></p>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="col-md-4">\r\n          <div class="form-group">\r\n          <label class="small" translate>SIM status</label>\r\n            <div class="row">\r\n              <div class="col-xs-9">\r\n                <div class="c8y-select-wrapper">\r\n                  <select class="form-control" ng-model="currentStatus" ng-disabled="!isAdmin" ng-change="setSimStatus(currentStatus)">\r\n                    <option ng-repeat="status in statusMap.statuses" ng-disabled="status.readOnly" ng-bind="status.text" ng-selected="status.status === currentStatus" value="{{status.status}}" translate>\r\n                    </option>\r\n                  </select>\r\n                  <span></span>\r\n                </div>\r\n              </div>\r\n              <div class="col-xs-3">\r\n                <i c8y-icon="{{statusIcon}}" ng-class="statusClass" style="font-size: 20px; line-height: 34px"></i>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="col-md-4">\r\n          <div class="form-group">\r\n            <label class="small" translate>Fixed IP address</label>\r\n            <p ng-bind="terminal.fixedIpAddress | translate"></p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class="row">\r\n        <div class="col-md-4">\r\n          <div class="form-group">\r\n            <label class="small" translate>SMS usage</label>\r\n            <p>{{terminal.monthToDateSMSUsage}}\r\n              <button class="btn btn-link" uib-popover="{{smsUsageTooltip}}" popover-placement="auto right" popover-append-to-body="true" popover-trigger="\'focus\'">\r\n                <i c8y-icon="question-circle-o"></i>\r\n              </button>\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div class="col-md-4">\r\n          <div class="form-inline">\r\n            <label class="small" translate>Data usage (MB)</label>\r\n            <p>{{terminal.monthToDateDataUsage}}\r\n              <button class="btn btn-link" uib-popover="{{dataUsageTooltip}}" popover-placement="auto right" popover-append-to-body="true" popover-trigger="\'focus\'"><i c8y-icon="question-circle-o"></i></button>\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div class="col-md-4">\r\n          <div class="form-group">\r\n            <label class="small" translate>Voice usage</label>\r\n            <p class="wide-linebreak-tooltip">\r\n              {{terminal.monthToDateVoiceUsage}}\r\n              <button class="btn btn-link" uib-popover="{{voiceUsageTooltip}}" popover-placement="auto right" popover-append-to-body="true" popover-trigger="\'focus\'">\r\n                <i c8y-icon="question-circle-o"></i>\r\n              </button>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</div>\r\n',s.put("core_connectivity/views/status.html",n),s.put("/apps/core/connectivity/views/status.html",n)}angular.module("c8y.connectivity").run(["$templateCache",s])}();