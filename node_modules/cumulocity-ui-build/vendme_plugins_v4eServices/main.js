/* vendme_plugins_v4eServices 9.3.0 2018-03-26T16:26:46+00:00 796b68a031b1+ (release/9.3.0) tip */
angular.module("v4e.services",[]),function(){"use strict";function n(n,e){function t(){var t=e.url(_);return n.get(t).then(e.getResData).then(r)}function r(n){return n.values||[]}function o(n,e){var t=n&&n.com_nsn_startups_vendme_fragments_VendingMachineCategoryInfo;return t&&t.consumptionModel===e}function s(n){return o(n,v.UNITARY)}function u(n){return o(n,v.RECIPE)}function a(n){return n&&"Location"===i(n)}function i(n){return n.com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.model}function c(t,r){var o=l(t),s=r||{},u={params:s};return n.get(o,u).then(e.getResData)}function l(n){var t=n&&(n.id||n);return t&&e.url(d+"/"+t)}function m(e,t){var r=f(e),o={vmid:e.id,slotRefills:t};return n.post(r,o)}function f(n){var t=d;return t+=a(n)?"/refillSales":"/refillDetails",e.url(t)}var _="vendme-service/business/resources/group/activeVendingMachineIdentifiers",d="vendme-service/business/resources/vendingmachine",v={UNITARY:"UNITARY",RECIPE:"RECIPE"};return{isUnitaryMachine:s,isRecipeMachine:u,isLocationMachine:a,detail:c,refill:m,list:t}}angular.module("v4e.services").factory("v4eMachines",["$http","c8yBase",n])}(),angular.module("v4e.services").factory("v4eMachineSlots",["$http","c8yBase","v4eMachines",function(n,e,t){"use strict";function r(t){var r=o(t);return n.get(r).then(e.getResData)}function o(n){return a(n)+"/slots"}function s(t){var r=u(t);return n.get(r).then(e.getResData)}function u(n){return a(n)+"/ingredientslots"}function a(n){var t=n.id||n;return e.url(D+"/"+t)}function i(n,e){return n&&n.type===e}function c(n){return i(n,N.SLOT)}function l(n){return i(n,N.INGREDIENT_SLOT)}function m(n){return c(n)?E.PRODUCT:l(n)?E.INGREDIENT:void 0}function f(n){return n.type===E.PRODUCT?n.com_nsn_startups_vendme_fragments_ProductInfo.name:n.type===E.INGREDIENT?n.com_nsn_startups_vendme_fragments_IngredientInfo.name:null}function _(n){return c(n)?n.com_nsn_startups_vendme_fragments_SlotTypeInfo.slotId:l(n)?n.com_nsn_startups_vendme_fragments_IngredientSlotTypeInfo.slotId:null}function d(n){return c(n)?n.com_nsn_startups_vendme_fragments_SlotInfo.selectionNumber:l(n)?n.com_nsn_startups_vendme_fragments_IngredientSlotInfo.selectionNumber:null}function v(n){var e={};return e.current=g(n),e}function g(n){var e={};return e.name=p(n),e.quantity=I(n),e}function p(n){return c(n)?n.com_nsn_startups_vendme_fragments_ProductInfo.name:l(n)?n.com_nsn_startups_vendme_fragments_IngredientInfo.name:null}function I(n){var e=0;return c(n)?(e=n.com_nsn_startups_vendme_fragments_SlotInfo.liveItemsLeft,e<0?0:e):l(n)?(e=n.com_nsn_startups_vendme_fragments_IngredientSlotInfo.liveAmmountLeft,e<0?0:e):null}function R(n){return c(n)?"pcs":l(n)?n.com_nsn_startups_vendme_fragments_IngredientSlotTypeInfo.unit:null}function h(n){return c(n)?n.com_nsn_startups_vendme_fragments_SlotInfo.plannedProduct:l(n)?n.com_nsn_startups_vendme_fragments_IngredientSlotInfo.plannedIngredient:null}function S(n){return y(n)-I(n)}function y(n){return c(n)?n.com_nsn_startups_vendme_fragments_SlotInfo.plannedRefillAmount:l(n)?n.com_nsn_startups_vendme_fragments_IngredientSlotInfo.plannedRefillAmount:null}function T(n,e){return e.current&&e.planned&&e.current.name!==e.planned.name||e.current.quantity!==e.planned.quantity}var D="vendme-service/business/resources/vendingmachine",N={SLOT:"com_nsn_startups_vendme_Slot",INGREDIENT_SLOT:"com_nsn_startups_vendme_IngredientSlot"},E={PRODUCT:"com_nsn_startups_vendme_Product",INGREDIENT:"com_nsn_startups_vendme_Ingredient"};return{listSlots:r,listIngredientSlots:s,isSlot:c,isIngredientSlot:l,getSlotContentsType:m,getSlotContentsItemName:f,getSlotPosition:_,getSlotSelectionNumber:d,getSlotContents:v,getSlotContentsName:p,getSlotContentsUnit:R,getPlannedSlotContentsId:h,getPlannedSlotContentsQuantity:S,getPlannedSlotContentsRefillAmount:y,isSlotContentsActionRequired:T}}]),function(){"use strict";function n(n,e,t,r,o){function s(){var e=u();return n.get(e).then(r.getResData).then(I)}function u(){return r.url(D+"/routeIdentifiers")}function a(e,t,o,s){var u=i(e,t,o,s);return n.post(u).then(r.getResData)}function i(n,e,t,o){return r.url(T+"/machinesTree/"+n+"/move/?from="+e+"&to="+t+"&ndx="+o)}function c(n){return o.detail(n).then(r.getResData).then(l)}function l(n){return n.type===N?n:null}function m(n){return"Free of charge delivery"===n.routeType}function f(e,t){var r={method:"PUT",url:_(e,t.id)};return n(r)}function _(n,e){return r.url(D+"/"+n+"/vendingmachines/"+e)}function d(e){var t=v(e);return n.get(t).then(r.getResData).then(I)}function v(n){return r.url(T+"/group/"+n+"/active/vendingmachines")}function g(e){var t=p(e);return n.get(t).then(r.getResData).then(I)}function p(n){return r.url(T+"/group/"+n+"/active/machineswithslots")}function I(n){return n.values||[]}function R(n){return n.com_nsn_startups_vendme_fragments_GroupInfo={},n.type=N,o.save(n)}function h(e,t,o){var s=r.url(E+"/locationRouteReport"),u={routeId:e,timestamp:1e3*parseInt(moment(t).format("X")),routeRefills:o};return n.post(s,u)}function S(n){var r=e.defer(),o=y(n),s=new XMLHttpRequest;return s.open("GET",o,!0),s.responseType="arraybuffer",s.onload=function(n){200===s.status?r.resolve(s):r.reject(s)},s.setRequestHeader("Authorization","Basic "+t.token),s.setRequestHeader("UseXBasic",!0),s.send(),r.promise}function y(n){var e=n.id||n;return r.url(E+"/routeReports?eventId="+e)}var T="vendme-service/business/resources",D=T+"/group",N="com_nsn_startups_vendme_Route",E="vendme-service/business/reports";return{list:s,detail:c,save:R,move:a,addMachineToRoute:f,isFreeOfChangeDeliveryRoute:m,getActiveMachines:d,getActiveMachinesWithSlots:g,createLocationRouteReport:h,downloadLocationRouteReportExcel:S}}angular.module("v4e.services").factory("v4eRoutes",["$http","$q","info","c8yBase","c8yInventory",n])}(),angular.module("v4e.services").factory("v4eWorkplans",["$http","c8yBase",function(n,e){"use strict";function t(t){var o=r(),s=t||{};return n.get(o,{params:s}).then(e.getResData)}function r(){return e.url(c+"/workplans")}function o(t){var r=s(),o=t||{};return n.get(r,{params:o}).then(e.getResData)}function s(){return e.url(c+"/get")}function u(e,t,r,o,s){var u=a(),i={params:{groupId:e,route:t,refillerName:r,date:moment(o).format(l),machines:s.join(",")}};return n.post(u,{},i)}function a(){return e.url(c+"/create")}function i(n){return n.type===m.PRODUCT?n.com_nsn_startups_vendme_fragments_ProductInfo.name:n.type===m.INGREDIENT?n.com_nsn_startups_vendme_fragments_IngredientInfo.name:null}var c="vendme-service/business/workplan",l="DD.MM.YYYY",m={PRODUCT:"com_nsn_startups_vendme_WorkplanProduct",INGREDIENT:"com_nsn_startups_vendme_WorkplanIngredient"};return{dateFormat:l,list:t,get:o,create:u,getWorkplanItemName:i}}]),function(){"use strict";function n(n){}angular.module("v4e.services").run(["$templateCache",n])}();