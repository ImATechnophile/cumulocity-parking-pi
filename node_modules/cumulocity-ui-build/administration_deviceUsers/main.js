/* administration_deviceUsers 8.21.0 2018-01-30T22:07:39+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
angular.module("c8y.parts.deviceUsers",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(e,n,s){"use strict";e.addNavigation({parent:s("Management"),name:s("Device credentials"),path:"deviceusers",icon:"c8y-device",showIfPermissions:{anyRole:["ROLE_USER_MANAGEMENT_ADMIN","ROLE_USER_MANAGEMENT_READ"]}}),n.when("/deviceusers",{templateUrl:"administration_deviceUsers/views/list.html"}),n.when("/deviceusers/:userId",{templateUrl:"administration_deviceUsers/views/detail.html"})}]),function(){"use strict";function e(e,n,s,t,a,r,i,l,o,c){function d(){v(F.filtering.filters).then(function(){F.filtering.applied=!0})}function u(){F.filtering.filters={},v(F.filtering.filters).then(function(){F.filtering.applied=!1})}function p(){g(),v()}function g(){return a.global.list({pageSize:1e3}).then(function(n){e.globalRoles=A=n})}function v(n){return e.refreshLoading=!0,t.list(_.assign({onlyDevices:!0},n)).then(m).finally(function(){e.refreshLoading=!1})}function m(n){return e.users&&!e.refreshLoading||(F.users=e.users=[]),n.forEach(function(n){e.users.push(n)}),e.paging=n.paging,e.users.length}function f(){return c.getPlural(e.users?e.users.length:0,"{{$count}} device credentials","{{$count}} device credentials",{})}function b(e){return e.enabled?"check-circle":"minus-circle"}function h(e){return e.enabled?"text-success":"text-danger"}function y(e){e.enabled=!0,t.save(e).then(function(){s.success(o("User successfully activated."))})}function w(e){e.enabled=!1,t.save(e).then(function(){s.success(o("User successfully deactivated."))})}function x(e){return e.enabled?"Enabled":"Disabled"}function P(n){r({title:o("Confirm delete?"),body:c.getString('Do you really want to remove user "{{userName}}"?',{userName:n.userName}),status:"danger",labels:{ok:o("Delete")}}).then(angular.bind(t,t.remove,n)).then(angular.bind(i,i.removeFromList,e.users,n)).then(function(){s.success(o("User successfully removed."))})}function k(e){n.path("/deviceusers/"+e.id)}function U(){e.refreshLoading=!0,e.paging.refresh().then(m).finally(function(){e.refreshLoading=!1})}function C(){e.paging.loading=!0,e.paging.next().then(m).finally(function(){e.paging.loading=!1})}function D(e){return _.map(e,"group")}function E(e){return _.get(e,"_owner._globalRoles",A)}function $(e,n){return a.global.updateGroups(e,_.map(n,"id")).then(_.partial(R,e))}function R(e){return t.detail(e).then(i.getResData).then(_.partial(_.assign,e))}var F=this,A=[];_.assign(F,{filtering:{applied:!1,filters:{}},applyFilters:d,clearFilters:u}),_.assign(e,{enabledIcon:b,enabledClass:h,enabledTooltip:x,activate:y,deactivate:w,groups:t.groups,navigateToDetail:k,onClickDelete:P,refresh:U,loadNext:C,mapRolesForUser:_.memoize(D),globalRolesAvailable:E,onChangeRoles:$,getSubtitle:f,getUsers:v}),p()}e.$inject=["$scope","$location","c8yAlert","c8yUser","c8yRoles","c8yModal","c8yBase","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.deviceUsers").controller("deviceUserListCtrl",e)}(),function(){"use strict";function e(e,n,s,t,a,r,i,l,o,c,d){function u(n){p(n),e.user=n,e._groups={},(n.groups&&n.groups.references||[]).forEach(function(n){var s=n.group.id;e._groups[s]=!0}),e.showPassword=!n.id,e.changePasswordBtn=!e.showPassword,delete e.confirmPassword}function p(n){a.checkIfCurrent(n).then(function(n){e.isCurrent=n})}function g(n){e.groups=n}function v(e){r.list(e).then(g)}function m(){x?a.detail(x).then(function(e){return e.data}).then(u):(e.isNew=!0,u({enabled:!0}))}function f(){s.path("/deviceusers")}function b(n){if(e.saving=!0,e.userForm.$valid){var s=_.keys(e._groups).filter(function(n){return e._groups[n]}).map(function(e){return parseInt(e,10)});try{var i=a.save(n,e.password.currentPassword).then(function(e){var n=e.data;return x=n.id=n.userName,n}).then(function(e){return r.updateGroups(e,s)}).then(angular.bind({},m)).then(_.partial(l.success,c("Device successfully updated.")));i.finally(function(){e.saving=!1}),i.then(function(){t.history.back()})}catch(n){l.danger(n.message),e.saving=!1}}}function h(n){e.userForm.confirmPassword.$setValidity(P.PASSWORD_MISSMATCH.type,n===e.user.password)}function y(e){e&&o.changeTitle({title:c(e)})}function w(n){var s=e.userForm[n]||{},t=[];return _.forEach(s.$error||{},function(e,n){e&&!s.$pristine&&t.push(d.getString(P[n.toUpperCase()].text))}),t.join(" ")}var x=n.userId,P={PATTERN:{type:"pattern",text:c("Password must have at least 6 characters.")},PASSWORD_MISSMATCH:{type:"password_missmatch",text:c("Password confirmation does not match.")},REQUIRED:{type:"required",text:c("This field is required.")},EMAIL:{type:"email",text:c("Invalid email address.")}};e.saving=!1,e.cancel=f,e.save=b,e.confirmPassword="",e.password={},e.invalid=angular.bind(i,i.invalid,e,"userForm"),e.changePasswordConfirm=h,e.$watch("user.userName",y),e.getErrorFeedback=w,m(),v()}e.$inject=["$scope","$routeParams","$location","$window","c8yUser","c8yUserGroup","c8yBase","c8yAlert","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.deviceUsers").controller("deviceUserDetailCtrl",e)}(),function(){"use strict";function e(e){var n;n='<c8y-breadcrumbs-set>\n  <c8y-breadcrumbs-item path="#deviceusers" label="{{\'Device credentials\' | translate}}" icon="c8y-device"></c8y-breadcrumbs-item>\n</c8y-breadcrumbs-set>\n\n<div data-ng-controller="deviceUserDetailCtrl">\n  <form name="userForm" role="form" ng-submit="save(user)" novalidate>\n    <div class="row">\n      <div class="col-md-6">\n        <div class="card">\n          <div class="card-header">\n            <h4 class="card-title" translate>Identification</h4>\n          </div>\n          <hr>\n          <div class="card-block">\n            <div class="form-group" ng-class="{\'has-error\': invalid(\'username\')}">\n          <label>{{\'Username\' | translate}} *</label>\n          <input class="form-control" name="username" ng-model="user.userName" required ng-disabled="user.id" uib-tooltip="{{getErrorFeedback(\'username\')}}" c8y-autocomplete="off">\n        </div>\n\n        <div class="form-group">\n          <label translate>Active</label>\n          <div>\n            <button type="button" class="btn btn-default" on ng-model="user.enabled" uib-btn-checkbox="user.enabled">\n              <i c8y-icon="minus-circle" class="text-danger" ng-show="!user.enabled"></i>\n              <i c8y-icon="check-circle" class="text-success" ng-show="user.enabled"></i>\n              <span ng-show="user.enabled" translate>Enabled</span>\n              <span ng-show="!user.enabled" translate>Disabled</span>\n            </button>\n          </div>\n        </div>\n\n        <div class="form-group" ng-show="changePasswordBtn">\n          <button type="button" class="btn btn-default" ng-click="showPassword=!showPassword">\n            <span ng-show="!showPassword" translate>Change password</span>\n            <span ng-show="showPassword" translate>Cancel password change</span>\n          </button>\n        </div>\n\n        <div class="form-group" ng-if="showPassword && isCurrent">\n          <label>{{\'Current password\' | translate}} *</label>\n          <input type="password" name="currentPassword" class="form-control" ng-model="password.currentPassword" required ng-pattern="passwordRegex" c8y-autocomplete="off">\n        </div>\n\n        <div class="form-group" ng-if="showPassword" ng-class="{\'has-error\': invalid(\'password\')}">\n          <label>{{\'Password\' | translate}} *</label>\n          <input type="password" name="password" class="form-control" ng-model="user.password" required ng-pattern="/.{6,}/" uib-tooltip="{{getErrorFeedback(\'password\')}}" c8y-autocomplete="off">\n        </div>\n\n        <div class="form-group" ng-if="showPassword" ng-class="{\'has-error\': invalid(\'confirmPassword\')}">\n          <label>{{\'Confirm password\' | translate}} *</label>\n          <input type="password" name="confirmPassword" class="form-control" ng-model="$parent.confirmPassword" required uib-tooltip="{{getErrorFeedback(\'confirmPassword\')}}" ng-change="changePasswordConfirm($parent.confirmPassword)" c8y-autocomplete="off">\n        </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-6">\n        <div class="card">\n          <div class="card-header">\n            <h4 class="card-title" translate>Global roles</h4>\n          </div>\n          <hr>\n          <ul class="list-group">\n            <li class="list-group-item item-list-row" ng-repeat="group in groups">\n              <label class="c8y-checkbox text-center" style="width:40px">\n                <input type="checkbox" id="{{\'groupcheckbox\' + $index}}" ng-model="_groups[group.id]">\n                  <span></span>\n              </label>\n              <label for="{{\'groupcheckbox\' + $index}}">\n                {{::group.name | translate}}\n                <br><small class="text-muted">{{::group.description | translate}}</small>\n              </label>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <div class="text-center page-footer">\n        <c8y-ui-button-footer changed="userForm.$dirty">\n          <button type="button" ng-click="cancel()" class="btn btn-default" translate>\n            Cancel\n          </button>\n          <button ng-class="{\'btn-save\': showPassword}" class="btn btn-primary" type="submit" ng-disabled="userForm.$invalid || userForm.$pristine || saving" translate>\n            Save\n          </button>\n        </c8y-ui-button-footer>\n      </div>\n  </form>\n</div>',e.put("administration_deviceUsers/views/detail.html",n),e.put("/apps/administration/deviceUsers/views/detail.html",n),n='<div ng-controller="deviceUserListCtrl as vm">\n  <c8y-ui-action-bar-set>\n    <li class="navbar-form" action-bar-position="left">\n      <div class="input-group input-group-search">\n        <input type="search" class="form-control" placeholder="{{\'Filter by username\' | translate}}&hellip;" ng-model="vm.filtering.filters.username">\n        <span class="input-group-addon">\n          <i c8y-icon="search"></i>\n        </span>\n      </div>\n    </li>\n\n    <li class="navbar-form" action-bar-position="left">\n      <button type="button" style="display: inline-block; width: auto" title="{{\'Apply filters\' | translate}}" class="btn btn-link" ng-click="vm.applyFilters()">\n        <i c8y-icon="filter"></i>\n        <translate>Filter</translate>\n      </button>\n\n      <button type="button" style="display: inline-block; width: auto" title="{{\'Clear filters\' | translate}}" class="btn btn-link" ng-click="vm.clearFilters()" ng-if="vm.filtering.applied">\n        <i c8y-icon="times"></i>\n      </button>\n    </li>\n\n    <c8y-refresh-btn></c8y-refresh-btn>\n  </c8y-ui-action-bar-set>\n\n  <div class="c8y-empty-state text-center" ng-show="!vm.filtering.applied && users.length === 0">\n    <h1 c8y-icon="key"></h1>\n    <h3 translate>There are no device credentials</h3>\n    <p translate>Start by registering a device</p>\n    <a href="/apps/devicemanagement/#/deviceregistration" class="btn btn-primary ng-scope">\n      <i c8y-icon="c8y-device-connect"></i>\n      <translate>Register device</translate>\n    </a>\n  </div>\n\n  <div class="user-list-header user-list-row" ng-show="users.length" style="margin-bottom: 15px">\n    <div class="col-expand"></div>\n    <label class="col-username" translate>Device user</label>\n    <label class="col-globalroles" translate>Global roles</label>\n    <div class="col-actions"></div>\n  </div>\n\n  <div class="user-list-row card" ng-if="vm.filtering.applied && users.length === 0">\n    <div class="c8y-empty-state text-left">\n      <h1 class="c8y-icon c8y-icon-device c8y-icon-duocolor"></h1>\n      <p translate>\n        Found no device users with names starting with <strong>{{::vm.filtering.filters.username}}</strong>.\n      </p>\n    </div>\n  </div>\n\n  <c8y-ui-title-set title="\'Device credentials\' | translate" subtitle="getSubtitle()"></c8y-ui-title-set>\n\n  <div class="user-list-row" ng-repeat="user in users" style="margin-top: 1px">\n    <div class="col-expand">\n      <i c8y-icon="c8y-device" style="font-size: 20px" ng-class="{\'text-gray-medium-dark\': user.enabled , \'text-muted\': !user.enabled }"></i>\n    </div>\n\n    <div class="col-username text-truncate" ng-click="navigateToDetail(user)">\n      <span class="username text-truncate">\n        <span title="{{::user.userName}}" class="h4" ng-class="{\'text-muted\': !user.enabled }">{{::user.userName}}</span>\n        <br ng-hide="user.enabled"><small class="disabled" ng-hide="user.enabled" translate>Disabled</small>\n      </span>\n    </div>\n\n    <div class="col-globalroles">\n      <c8y-item-selector items="globalRolesAvailable(user)" items-selected="mapRolesForUser(user.groups.references)" on-apply="onChangeRoles(user, items)" text-apply="{{\'Apply\' | translate}}" style-button="{background: \'transparent\', padding: 5, \'padding-right\': 40}">\n      </c8y-item-selector>\n    </div>\n\n    <div class="col-actions">\n      <div class="dropdown" uib-dropdown dropdown-append-to-body>\n        <a class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle ng-click="::$event.stopPropagation()">\n          <span><i c8y-icon="ellipsis-v"></i></span>\n        </a>\n        <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n          <li>\n            <a href="" ng-click="navigateToDetail(user)">\n              <i c8y-icon="edit"></i> <translate>Edit</translate>\n            </a>\n          </li>\n          <li ng-show="user.enabled">\n            <a href="" ng-click="deactivate(user)">\n              <i c8y-icon="ban"></i> <translate>Disable</translate>\n            </a>\n          </li>\n          <li ng-hide="user.enabled">\n            <a href="" ng-click="activate(user)">\n              <i c8y-icon="check-circle-o"></i> <translate>Enable</translate>\n            </a>\n          </li>\n          <li>\n            <a href="" ng-click="onClickDelete(user)">\n              <i c8y-icon="trash"></i> <translate>Delete</translate>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n\n  <c8y-load-more change-page-size></c8y-load-more>\n</div>\n',e.put("administration_deviceUsers/views/list.html",n),e.put("/apps/administration/deviceUsers/views/list.html",n)}angular.module("c8y.parts.deviceUsers").run(["$templateCache",e])}();